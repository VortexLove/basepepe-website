<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,viewport-fit=cover"
    />
    <title>Pepe Blackjack (PBJ) - DApp</title>
    <meta name="description" content="Presale + Blackjack + NFTs en Base. Pepe Blackjack (PBJ) token y juego Web3." />
    <meta http-equiv="x-ua-compatible" content="IE=edge" />

    <!-- Preconnect / Fonts (performance) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />

    <!-- CRITICAL: Se eliminaron scripts no usados (web3, WalletConnect v1) -->
    <!-- Todos con defer para no bloquear el parseo del HTML -->
    <script defer src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script defer src="./cdn.tailwindcss.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/tsparticles@2.12.0/tsparticles.bundle.min.js"></script>

    <!-- Estilos cr√≠ticos -->
    <style>
      :root {
        color-scheme: dark;
      }
      html, body {
        margin: 0;
        padding: 0;
        background:#000;
      }
      html, body, * {
        font-family: 'Press Start 2P', cursive !important;
      }
      body {
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
      }

      /* Evitar reflow por im√°genes (dimensiones) y usar lazy */
      img {
        max-width: 100%;
        height: auto;
        display: block;
      }

      /* Scroll snapping en listas NFT */
      #userNFTs, #stakedNFTs, #userNFTsStake { scroll-snap-type: x mandatory; }

      /* Particle canvas */
      #tsparticles {
        position: fixed;
        z-index: -1;
        inset: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
      }

      /* Blackjack cards */
      .card {
        position: relative;
        width: 120px;
        height: 160px;
        background: #fff;
        border: 2px solid #222;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        font-weight: bold;
        opacity: 0;
        transition: transform .4s ease, opacity .4s ease;
      }
      .card.deal { transform: translateY(0) scale(1); opacity: 1; }
      .card .corner { position: absolute; font-size: .8rem; }
      .card .top-left { top: 4px; left: 6px; }
      .card .bottom-right { bottom: 4px; right: 6px; transform: rotate(180deg); }
      .red-suit { color: red; }
      .black-suit { color: black; }

      .w-100 { width: 100%; }
      .top-45 { top: 10.5rem; }
      .bottom-45 { bottom: 10.5rem; }
      .image-pepe-preventa { height: 25rem; width: auto; margin-inline: auto; }

      @media (max-width: 500px) {
        .cartas-blackjack { height: 25rem !important; }
      }

      /* NFT secciones */
      .nft-section {
        display: flex;
        justify-content: center;
        gap: 40px;
        flex-wrap: nowrap;
        overflow-x: auto;
        padding: 20px;
        max-width: 100%;
        scroll-snap-type: x mandatory;
        scroll-behavior: smooth;
      }
      .nft-card {
        flex: 0 0 240px;
        padding: 10px;
        border-radius: 8px;
        background: transparent;
        display: flex;
        flex-direction: column;
        align-items: center;
        scroll-snap-align: start;
      }
      .nft-card h2,
      .nft-card p {
        color: #22c55e;
        font-size: 18px;
      }
      .nft-card p { font-size: 15px; }
      .nft-card img { width: 100%; max-width: 250px; margin-bottom: 25px; }

      .pixel-button {
        background: #00FF00;
        border: 2px solid #003300;
        color: #000;
        font-size: 10px;
        padding: 8px 12px;
        cursor: pointer;
        box-shadow: 2px 2px 0 #003300;
        transition: transform .1s;
      }
      .pixel-button:hover { transform: scale(1.05); }

      @media (max-width: 500px) {
        .nft-section { gap: 10px; padding: 8px; }
        .nft-card { flex: 0 0 170px; padding: 4px; }
        .nft-card img { max-width: 140px; }
      }

      /* Tokenomics */
      .tokenomics-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 16px;
        border-radius: 10px;
        color: #000;
        font-weight: 700;
        text-transform: uppercase;
        box-shadow: 3px 3px 0 #00000066;
        border: 3px solid #111;
      }
      .tokenomics-bar .pct {
        background: #000;
        color: #fff;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
      }
      .bar-purple { background:#B69CFF; }
      .bar-green  { background:#39FF14; }
      .bar-blue   { background:#76C7FF; }
      .bar-orange { background:#FFA726; }
      .bar-yellow { background:#FCD34D; }
      .pizza-box { position: relative; }
      .pizza-lid {
        background: #f0c27b;
        border: 4px solid #7a4e1b;
        border-bottom: 0;
        padding: 10px;
        border-top-left-radius: 6px;
        border-top-right-radius: 6px;
        text-shadow: 1px 1px 0 #00000033;
      }
      .pizza-base {
        background: #e2b47a;
        border: 4px solid #7a4e1b;
        border-top: 0;
        padding: 18px;
        border-bottom-left-radius: 6px;
        border-bottom-right-radius: 6px;
        display: flex;
        justify-content: center;
      }
      .pizza-chart {
        width: 260px;
        height: 260px;
        max-width: 80vw;
        max-height: 80vw;
        border-radius: 50%;
        position: relative;
        box-shadow: inset 0 0 0 8px #7a4e1b, 2px 2px 0 #00000055;
      }
      .pizza-chart::after {
        content: "";
        position: absolute;
        inset: 20%;
        background: #d9a36a;
        border-radius: 50%;
        box-shadow: inset 0 0 0 4px #7a4e1b;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 10px;
        background: #111827;
        border: 1px solid #1f2937;
        padding: 8px 10px;
        border-radius: 8px;
      }
      .legend-dot {
        width: 14px;
        height: 14px;
        border-radius: 3px;
        box-shadow: 1px 1px 0 #00000055;
      }

      /* Botones NFT en grids */
      #userNFTs > div, #stakedNFTs > div, #userNFTsStake > div {
        scroll-snap-align: start;
        flex: 0 0 220px;
        background: #111;
        border: 2px solid #22c55e;
        border-radius: 12px;
        padding: 12px;
        text-align: center;
        color: #a6f4a6;
        box-shadow: 0 0 8px #22c55e88;
      }
      #userNFTs button, #stakedNFTs button, #userNFTsStake button {
        margin-top: 10px;
        background-color: #00ff00;
        color: #000;
        font-size: 10px;
        padding: 6px 10px;
        border: 2px solid #003300;
        cursor: pointer;
        box-shadow: 2px 2px 0 #003300;
        border-radius: 4px;
        transition: transform .1s;
      }
      #userNFTs button:hover, #stakedNFTs button:hover, #userNFTsStake button:hover {
        transform: scale(1.05);
      }

      /* Content-visibility para secciones pesadas fuera del primer viewport */
      .defer-section {
        content-visibility: auto;
        contain-intrinsic-size: 800px 600px;
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          animation: none !important;
          transition: none !important;
        }
      }
    </style>
  </head>

  <body class="bg-gray-950 text-white min-h-screen">
    <div id="tsparticles" aria-hidden="true"></div>

    <div class="max-w-4xl mx-auto p-4 space-y-8">
      <!-- Header -->
      <header class="flex flex-col md:flex-row justify-between items-center py-4 border-b border-gray-700 gap-3">
        <h1 class="text-2xl sm:text-3xl font-bold text-green-400">Pepe Blackjack (PBJ)</h1>

        <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
          <button
            id="connectButton"
            class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded text-white w-full sm:w-auto text-center"
          >Conectar Billetera</button>

          <button
            id="wcButton"
            class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded text-white w-full sm:w-auto text-center"
            title="Usa WalletConnect (Trust Wallet, etc.)"
          >WalletConnect</button>
        </div>

        <div
          id="pbjDisplay"
          style="display:none; align-items:center; gap:8px; font-size:20px; color:#39ff14; background:transparent; padding:10px 20px;"
        >
          <img
            src="./Coin.png"
            alt="PBJ Coin"
            width="48" height="48"
            loading="lazy"
            decoding="async"
            style="image-rendering:pixelated;border-radius:50%;border:none;"
          >
          <span id="pbjBalanceHeader">0</span> PBJ
        </div>
      </header>

      <div id="status" class="text-center text-base sm:text-lg" aria-live="polite"></div>

      <!-- PRESALE BLOCK -->
      <div class="flex flex-col md:flex-row items-center md:items-stretch gap-6 my-8">
        <!-- Presale image (Hero) -->
        <div class="flex-shrink-0 flex justify-center items-center md:justify-start md:items-start">
          <picture>
            <source type="image/avif" srcset="./preventa.avif" />
            <source type="image/webp" srcset="./preventa.webp" />
            <img
              src="./preventa.png"
              alt="PBJ Presale"
              class="image-pepe-preventa rounded-lg border-0 shadow-inner max-h-80 md:max-h-none"
              style="height:28rem;width:auto;margin:0;"
              fetchpriority="high"
              decoding="async"
              width="896" height="448"
            />
          </picture>
        </div>

        <!-- Bars + voting -->
        <div class="flex flex-col gap-4 flex-1">
          <div id="presale-timer" class="w-full max-w-md mx-auto p-4 bg-gray-900 rounded-xl shadow flex flex-col items-center">
            <div class="w-full mb-2">
              <div class="h-4 w-full bg-gray-700 rounded-full overflow-hidden">
                <div id="presale-progress" class="h-4 bg-green-500 rounded-full transition-all duration-500" style="width:0%;"></div>
              </div>
            </div>
            <div class="text-green-400 font-semibold text-lg" id="presale-countdown">Loading...</div>
            <div class="text-xs text-gray-400 mt-1">Presale time left (7 days)</div>
          </div>

            <div id="eth-collected-bar" class="w-full max-w-md mx-auto p-4 bg-gray-900 rounded-xl shadow flex flex-col items-center">
              <div class="w-full mb-2">
                <div class="h-4 w-full bg-gray-700 rounded-full overflow-hidden">
                  <div id="eth-collected-progress" class="h-4 bg-blue-500 rounded-full transition-all duration-500" style="width:10%;"></div>
                </div>
              </div>
              <div class="text-blue-400 font-semibold text-lg" id="eth-collected-count">2 ETH collected of 20</div>
              <div class="text-xs text-gray-400 mt-1">Presale goal: 20 ETH</div>
            </div>

          <div id="presale-vote" class="w-full max-w-md mx-auto p-4 bg-gray-900 rounded-xl shadow flex flex-col items-center">
            <div class="font-semibold text-gray-200 mb-2">What do you think about the presale?</div>
            <div class="flex gap-4 mb-2">
              <button class="emoji-vote-btn text-2xl" data-emoji="üëç" aria-label="Vote üëç">üëç</button>
              <button class="emoji-vote-btn text-2xl" data-emoji="üî•" aria-label="Vote üî•">üî•</button>
              <button class="emoji-vote-btn text-2xl" data-emoji="ü§©" aria-label="Vote ü§©">ü§©</button>
              <button class="emoji-vote-btn text-2xl" data-emoji="üíé" aria-label="Vote üíé">üíé</button>
              <button class="emoji-vote-btn text-2xl" data-emoji="üòÇ" aria-label="Vote üòÇ">üòÇ</button>
            </div>
            <div id="vote-results" class="flex gap-3 mt-2 text-lg"></div>
          </div>
        </div>
      </div>
      <!-- END PRESALE BLOCK -->

      <!-- NFT Purchase Section -->
      <div class="nft-section defer-section">
        <div class="nft-card">
          <picture>
            <source type="image/avif" srcset="nft1.avif" />
            <source type="image/webp" srcset="nft1.webp" />
            <img src="nft1.png" alt="Common NFT" loading="lazy" decoding="async" width="250" height="250">
          </picture>
          <h2>üü¢ Common</h2>
          <p>5000 $PBJ - Reward: 200 $PBJ/day</p>
          <button class="pixel-button" onclick="buyNFT(0)">Buy NFT üü¢ Common</button>
        </div>

        <div class="nft-card">
          <picture>
            <source type="image/avif" srcset="nft2.avif" />
            <source type="image/webp" srcset="nft2.webp" />
            <img src="nft2.png" alt="Rare NFT" loading="lazy" decoding="async" width="250" height="250">
          </picture>
          <h2>üîµ Rare</h2>
          <p>10000 $PBJ - Reward: 500 $PBJ/day</p>
          <button class="pixel-button" onclick="buyNFT(1)">Buy NFT üîµ Rare</button>
        </div>

        <div class="nft-card">
          <picture>
            <source type="image/avif" srcset="nft3.avif" />
            <source type="image/webp" srcset="nft3.webp" />
            <img src="nft3.png" alt="Legendary NFT" loading="lazy" decoding="async" width="250" height="250">
          </picture>
          <h2>üü£ Legendary</h2>
          <p>25000 $PBJ - Reward: 1500 $PBJ/day</p>
          <button class="pixel-button" onclick="buyNFT(2)">Buy NFT üü£ Legendary</button>
        </div>
      </div>

      <section id="nftSection" class="defer-section" style="text-align:center;margin-top:40px;">
        <h2 style="font-family: monospace;font-size:24px;margin-bottom:20px;">Your PepeBlackjack NFTs</h2>
        <div id="userNFTs" style="display:flex;flex-wrap:wrap;justify-content:center;gap:20px;padding:20px;">
          <!-- Dynamic -->
        </div>
      </section>

      <section id="staking-section" class="bg-gray-900 p-6 rounded-xl shadow-xl mt-8 defer-section">
        <h2 class="text-xl sm:text-2xl font-bold text-green-400 mb-6">ü™ô Stake your PepeBlackjack NFTs</h2>

        <div>
          <h3 class="text-green-400 font-semibold mb-2">Your NFTs available for staking</h3>
          <div id="userNFTsStake" class="flex gap-6 overflow-x-auto py-2"></div>
        </div>

        <div class="mt-8">
          <h3 class="text-green-400 font-semibold mb-2">Your staked NFTs</h3>
          <div id="stakedNFTs" class="flex gap-6 overflow-x-auto py-2"></div>
        </div>
      </section>

      <!-- BUY COMPONENT -->
      <section class="bg-gray-800 rounded-2xl shadow-2xl p-6 w-full sm:max-w-md mx-auto defer-section">
        <h2 class="text-xl sm:text-2xl font-semibold text-green-400 mb-6">Token Purchase</h2>
        <div class="flex justify-between text-xs sm:text-sm text-gray-400 mb-4">
          <span>ETH Balance</span>
          <span id="ethBalance" class="font-mono text-white">0.0000 ETH</span>
        </div>
        <div class="space-y-4 mb-6 form-presale">
          <div class="flex items-center space-x-2">
            <input
              type="number"
              id="ethAmount"
              min="0.01"
              step="0.0001"
              value="0.01"
              class="flex-1 bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-400 text-sm"
              placeholder="0.0 ETH"
            />
            <span class="text-gray-300 font-medium text-sm">ETH</span>
          </div>
          <div class="flex justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </div>
          <div class="flex items-center space-x-2">
            <input
              type="number"
              id="pbjAmount"
              min="10000"
              step="10000"
              value="10000"
              class="flex-1 bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-400 text-sm"
              placeholder="0 PBJ"
            />
            <span class="text-gray-300 font-medium text-sm">PBJ</span>
          </div>
        </div>
        <button
          id="buyButton"
          disabled
          class="w-full py-2 sm:py-3 rounded-lg bg-gradient-to-r from-green-500 to-green-700 text-white font-semibold hover:from-green-600 hover:to-green-800 disabled:opacity-50 text-sm sm:text-base"
        >Buy</button>
      </section>

      <!-- Blackjack Game -->
      <section id="blackjackGame" class="bg-gray-900 p-4 sm:p-6 rounded-xl shadow-xl defer-section">
        <h2 class="text-xl sm:text-2xl font-bold text-green-400 mb-4">üÉè Blackjack Game</h2>
        <div class="mb-4 text-xs sm:text-sm flex flex-col sm:flex-row sm:items-center sm:space-x-8 space-y-2 sm:space-y-0">
          <div class="flex items-center space-x-2">
            <div class="text-xs text-green-400">
              Balance: <span id="pbjBalanceGame">0</span> PBJ
            </div>
            <label for="betAmount" class="text-sm ml-4">Bet:</label>
            <input
              type="number"
              id="betAmount"
              min="1"
              step="1"
              value="1000"
              class="w-20 px-2 py-1 rounded bg-gray-800 text-white text-sm"
            />
          </div>
        </div>

        <div class="relative h-64 sm:h-96 cartas-blackjack mb-4">
          <div id="dealerArea" class="absolute top-0 left-1/2 -translate-x-1/2 flex space-x-2 sm:space-x-3 overflow-x-auto"></div>
          <div class="absolute top-45 w-100 left-1/2 -translate-x-1/2 text-xs sm:text-sm text-center">
            Dealer Points: <span id="dealerScore">0</span>
          </div>

          <div id="playerArea" class="absolute bottom-0 left-1/2 -translate-x-1/2 flex space-x-2 sm:space-x-3 overflow-x-auto"></div>
          <div class="absolute bottom-45 w-100 left-1/2 -translate-x-1/2 text-xs sm:text-sm text-center">
            Player Points: <span id="playerScore">0</span>
          </div>
        </div>

        <div class="mt-4 flex flex-col sm:flex-row sm:space-x-2 space-y-2 sm:space-y-0">
          <button id="dealBtn" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded flex-1">Deal</button>
          <button id="hitBtn" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded flex-1" disabled>Hit</button>
          <button id="standBtn" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded flex-1" disabled>Stand</button>
        </div>

        <div id="resultMsg" class="mt-4 text-base sm:text-lg font-semibold text-center"></div>
      </section>

      <!-- Lore -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl flex flex-col md:flex-row items-center defer-section">
        <div class="w-full md:w-1/3 mb-4 md:mb-0">
          <picture>
            <source type="image/avif" srcset="./carta.avif" />
            <source type="image/webp" srcset="./carta.webp" />
            <img
              src="./carta.png"
              alt="BasePepe Card"
              class="w-full h-auto rounded-lg border-0 shadow-inner"
              loading="lazy"
              decoding="async"
              width="800" height="600"
            />
          </picture>
        </div>
        <div class="w-full md:w-2/3 md:pl-6">
          <h2 class="text-2xl font-bold text-green-400 mb-4">üìñ Lore</h2>
          <p class="text-gray-300 leading-relaxed text-sm sm:text-base">
            Pepe Blackjack (PBJ) arises from the legendary frog table of the cyber-casino.
            This token mixes meme humor with the thrill of blackjack, offering a
            unique risk and reward experience on the Base Blockchain.
          </p>
        </div>
      </section>

      <!-- Roadmap -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl flex flex-col md:flex-row items-center defer-section">
        <div class="w-full md:w-1/3 mb-4 md:mb-0">
          <picture>
            <source type="image/avif" srcset="./logo.avif" />
            <source type="image/webp" srcset="./logo.webp" />
            <img
              src="./logo.png"
              alt="Logo PBJ"
              class="w-full h-auto rounded-lg border-2 border-gray-700 shadow-inner"
              loading="lazy"
              decoding="async"
              width="512" height="512"
            />
          </picture>
        </div>
        <div class="w-full md:w-2/3 md:pl-6">
          <h2 class="text-2xl font-bold text-green-400 mb-4">üìñ Roadmap</h2>
          <ul class="text-gray-300 leading-relaxed text-sm sm:text-base">
            <li><strong>Q2 2025:</strong> PBJ presale on Base and official launch.</li>
            <li><strong>Q3 2025:</strong> Listed on DEX, staking features.</li>
            <li><strong>Q4 2025:</strong> Web3 Blackjack platform with NFT integration.</li>
            <li><strong>Q1 2026:</strong> Metaverse expansion and rewards for holders.</li>
          </ul>
        </div>
      </section>

      <!-- Tokenomics -->
      <section id="tokenomics" class="bg-gray-900 p-6 rounded-xl shadow-xl flex flex-col md:flex-row items-start gap-8 defer-section">
        <div class="w-full md:w-1/2">
          <h2 class="text-2xl font-bold text-green-400 mb-4">TOKENOMICS</h2>
          <div id="tokenomics-bars" class="space-y-3"></div>
          <div class="mt-6 bg-gray-800 rounded-lg p-4 text-xs sm:text-sm space-y-1">
            <div><span class="text-green-400">Symbol:</span> PBJ</div>
            <div><span class="text-green-400">Network:</span> Base</div>
            <div><span class="text-green-400">Total Supply:</span> 1,000,000,000 PBJ</div>
            <div><span class="text-green-400">Presale Price:</span> 1 ETH = 1,000,000 PBJ</div>
            <div><span class="text-green-400">Contract:</span> <a href="https://basescan.org/address/0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5" class="text-blue-400 underline" target="_blank" rel="noopener">0xff4b4f...E5</a></div>
          </div>
        </div>
        <div class="w-full md:w-1/2 flex flex-col items-center gap-4">
          <div class="pizza-box w-full max-w-xs sm:max-w-sm">
            <div class="pizza-lid text-center">
              <div class="font-bold text-yellow-300 text-lg">$PBJ UTILITY</div>
            </div>
            <div class="pizza-base">
              <div class="pizza-chart" id="pizzaChart"></div>
            </div>
          </div>
          <div id="tokenomics-legend" class="grid grid-cols-1 gap-2 w-full"></div>
          <ul class="bg-gray-800 w-full rounded-lg p-4 space-y-2 text-sm">
            <li class="text-gray-200">‚Ä¢ Staking ‚Äì pool de recompensas PBJ con distribuci√≥n autom√°tica por smart contract.</li>
            <li class="text-gray-200">‚Ä¢ Blackjack ‚Äì premios del juego, rakeback para stakers y jackpots tem√°ticos.</li>
            <li class="text-gray-200">‚Ä¢ Activaciones de comunidad ‚Äì concursos, torneos y leaderboards semanales.</li>
            <li class="text-gray-200">‚Ä¢ Alianzas ‚Äì integraciones con plataformas y eventos gamificados.</li>
          </ul>
        </div>
      </section>

      <!-- Team and Links -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl defer-section">
        <h2 class="text-2xl font-bold text-green-400 mb-4">üë• Team and Links</h2>
        <ul class="text-gray-300 space-y-2">
          <li><strong>Team:</strong> Vortex (Development), John Smith (Marketing), CryptoFrogDAO (Community)</li>
          <li><strong>Official website:</strong> <a href="#" class="text-blue-400 underline">www.pepeblackjack.online</a></li>
          <li><strong>Twitter:</strong> <a href="https://twitter.com/pepeblackjack21" class="text-blue-400 underline" rel="noopener" target="_blank">@pepeblackjack21</a></li>
            <li><strong>Telegram:</strong> <a href="https://t.me/pepeblackjack21" class="text-blue-400 underline" rel="noopener" target="_blank">@pepeblackjack21</a></li>
        </ul>
      </section>

      <!-- FAQ -->
      <section class="bg-gray-900 p-6 rounded-xl shadow-xl defer-section">
        <h2 class="text-2xl font-bold text-green-400 mb-4">‚ùì FAQ</h2>
        <div class="text-gray-300 space-y-4">
          <div>
            <h3 class="font-semibold">How do I buy PBJ?</h3>
            <p>Connect your wallet (MetaMask, Trust Wallet via WalletConnect), enter the amount in ETH or PBJ and press "Buy".</p>
          </div>
          <div>
            <h3 class="font-semibold">What happens when the presale ends?</h3>
            <p>The <code>endPresale()</code> function disables purchases; you will only be able to trade on DEX afterwards.</p>
          </div>
        </div>
      </section>
    </div>

    <!-- tsParticles (idle/delayed init) -->
    <script defer>
      function initParticles() {
        if (typeof tsParticles === 'undefined') return;
        tsParticles.load("tsparticles", {
          background: { color: { value: "#000" } },
          fpsLimit: 60,
          interactivity: {
            events: { onHover: { enable: true, mode: "repulse" }, resize: true },
            modes: { repulse: { distance: 100, duration: 0.4 } }
          },
          particles: {
            color: { value: "#00ff99" },
            links: { enable: true, color: "#00ff99", distance: 150 },
            move: { enable: true, speed: 2 },
            number: { value: window.matchMedia('(max-width:600px)').matches ? 25 : 40 },
            opacity: { value: 0.45 },
            shape: { type: "circle" },
            size: { value: { min: 1, max: 2 } }
          },
          detectRetina: true
        });
      }
      window.addEventListener('load', () => {
        if ('requestIdleCallback' in window) {
          requestIdleCallback(initParticles, { timeout: 1200 });
        } else {
          setTimeout(initParticles, 500);
        }
      });
    </script>

    <!-- App Logic -->
    <script defer>
      // Global web3 vars
      let provider, signer, userAddress;
      let pbjContract, casinoContract, contract;

      const rate = 1000000;

      // Addresses
      const contractAddress     = '0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5'; // Presale / Token (placeholder)
      const pbjContractAddress  = '0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5';
      const pbjTokenAddress     = '0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5';
      const casinoAddress       = '0x79e617b64eae98bda7f8Cd4b1EdC05dE696E4B74';
      const nftAddress          = '0x4AabC024D719240e98e82930EAC04bD49CB86E31';

      // ABIs
      const pbjAbi = [
        'function balanceOf(address) view returns (uint256)',
        'function decimals() view returns (uint8)',
        'function approve(address spender, uint256 amount) returns (bool)',
        'function allowance(address owner, address spender) view returns (uint256)'
      ];
      const nftAbi = [
        {
          "inputs":[{"internalType":"enum PepeBlackjackNFT.Rarity","name":"_rarity","type":"uint8"}],
          "name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"
        },
        {"inputs":[],"name":"pbjToken","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},
        {
          "inputs":[{"internalType":"enum PepeBlackjackNFT.Rarity","name":"","type":"uint8"}],
          "name":"nftTypes",
          "outputs":[
            {"internalType":"uint256","name":"pricePBJ","type":"uint256"},
            {"internalType":"uint256","name":"totalSupply","type":"uint256"},
            {"internalType":"uint256","name":"minted","type":"uint256"}
          ],
          "stateMutability":"view","type":"function"
        }
      ];
      const casinoAbi = [
        'function placeBet(uint256 amount) external',
        'function finishGame(bool playerWon) external',
        'function cancelBet() external'
      ];
      const abi = ['function buyTokens() payable'];

      const isMobile = () => /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

      function showStatus(msg, ok = true) {
        const el = document.getElementById('status');
        if (!el) return;
        el.textContent = msg;
        el.style.color = ok ? '#22c55e' : '#f87171';
      }

      async function ensureBaseNetwork() {
        try {
          const net = await provider.getNetwork();
          if (net.chainId === 8453) return true;
          if (provider.provider && provider.provider.request) {
            try {
              await provider.provider.request({
                method: 'wallet_switchEthereumChain',
                params: [{ chainId: '0x2105' }]
              });
              return true;
            } catch (switchErr) {
              try {
                await provider.provider.request({
                  method: 'wallet_addEthereumChain',
                  params: [{
                    chainId: '0x2105',
                    chainName: 'Base',
                    nativeCurrency: { name: 'Ether', symbol: 'ETH', decimals: 18 },
                    rpcUrls: ['https://mainnet.base.org'],
                    blockExplorerUrls: ['https://basescan.org']
                  }]
                });
                return true;
              } catch (addErr) {
                showStatus('Cambia a la red Base (8453) en tu wallet.', false);
                alert('Cambia a la red Base (8453) en tu wallet.');
                return false;
              }
            }
          } else {
            alert('Cambia a la red Base (8453) en tu wallet.');
            return false;
          }
        } catch (e) {
          console.error(e);
          return false;
        }
      }

      function bindProviderEvents(eip1193Provider) {
        if (!eip1193Provider || !eip1193Provider.on) return;
        eip1193Provider.on('accountsChanged', async (accounts) => {
          if (accounts && accounts.length) {
            userAddress = accounts[0];
            window.userAddress = userAddress;
            await afterConnected();
          } else {
            showStatus('Wallet desconectada', false);
          }
        });
        eip1193Provider.on('chainChanged', async () => {
          await ensureBaseNetwork();
          await afterConnected();
        });
        eip1193Provider.on('disconnect', () => {
          showStatus('Wallet desconectada', false);
        });
      }

      async function connectInjected() {
        if (!window.ethereum) return null;
        const injected = window.ethereum;
        await injected.request({ method: 'eth_requestAccounts' });
        const ethProvider = new ethers.providers.Web3Provider(injected, 'any');
        bindProviderEvents(injected);
        return ethProvider;
      }

      async function connectWalletConnect() {
        try {
          const { default: EthereumProvider } = await import("https://esm.sh/@walletconnect/ethereum-provider@2.11.1");
          const projectId = "06606e3b978574fe1fe67024c91c5aa3"; // Replace with your real WC projectId
          const wcProvider = await EthereumProvider.init({
            projectId,
            chains: [8453],
            showQrModal: true,
            optionalChains: [8453],
            methods: ["eth_sendTransaction","personal_sign","eth_sign","eth_signTypedData","eth_signTransaction"],
            events: ["chainChanged","accountsChanged"],
            rpcMap: { 8453:"https://mainnet.base.org" },
            metadata: {
              name: "Pepe Blackjack (PBJ)",
              description: "PBJ Presale + Blackjack",
              url: window.location.origin,
              icons: [window.location.origin + "/logo.png"]
            }
          });
          await wcProvider.connect();
          bindProviderEvents(wcProvider);
          return new ethers.providers.Web3Provider(wcProvider, "any");
        } catch (err) {
          console.error("WalletConnect v2 error:", err);
          alert("No se pudo conectar con WalletConnect v2.");
          return null;
        }
      }

      async function connectFlow(preferWC = false) {
        try {
          if (preferWC) {
            provider = await connectWalletConnect();
            if (!provider && window.ethereum) provider = await connectInjected();
          } else {
            if (window.ethereum) {
              provider = await connectInjected();
            } else {
              provider = await connectWalletConnect();
            }
          }
          if (!provider) {
            showStatus('No se pudo conectar con una billetera.', false);
            return;
          }
          signer = provider.getSigner();
          userAddress = await signer.getAddress();
          window.userAddress = userAddress;

            const ok = await ensureBaseNetwork();
          if (!ok) return;

          await afterConnected();
        } catch (err) {
          console.error(err);
          showStatus('Error conectando la billetera.', false);
          alert('Error conectando la billetera.');
        }
      }

      async function afterConnected() {
        pbjContract   = new ethers.Contract(pbjContractAddress, pbjAbi, signer);
        casinoContract= new ethers.Contract(casinoAddress, casinoAbi, signer);
        contract      = new ethers.Contract(contractAddress, abi, signer);

        const balance = await provider.getBalance(userAddress);
        const ethEl = document.getElementById('ethBalance');
        if (ethEl) ethEl.textContent = `${parseFloat(ethers.utils.formatEther(balance)).toFixed(4)} ETH`;

        showStatus('‚úÖ Wallet conectada');
        const buyBtn = document.getElementById('buyButton');
        if (buyBtn) buyBtn.disabled = false;
        const pbjDisp = document.getElementById('pbjDisplay');
        if (pbjDisp) pbjDisp.style.display = 'flex';

        await updatePBJBalance();
        await loadUserNFTs();
      }

      function setupPresaleInputs() {
        const ethInput = document.getElementById('ethAmount');
        const pbjInput = document.getElementById('pbjAmount');
        if (!ethInput || !pbjInput) return;
        let lock = false;
        ethInput.addEventListener('input', () => {
          if (lock) return;
          lock = true;
          const eth = parseFloat(ethInput.value || '0');
          pbjInput.value = isFinite(eth) ? Math.floor(eth * rate) : 0;
          lock = false;
        });
        pbjInput.addEventListener('input', () => {
          if (lock) return;
          lock = true;
          const pbj = parseFloat(pbjInput.value || '0');
          ethInput.value = isFinite(pbj) ? (pbj / rate).toFixed(4) : '0.0000';
          lock = false;
        });
      }

      async function updatePBJBalance() {
        if (!pbjContract || !userAddress) return;
        try {
          const raw = await pbjContract.balanceOf(userAddress);
          const dec = await pbjContract.decimals();
          const balance = ethers.utils.formatUnits(raw, dec);
          const formatted = parseFloat(balance).toFixed(2);
          const header = document.getElementById('pbjBalanceHeader');
          const game   = document.getElementById('pbjBalanceGame');
          if (header) header.textContent = formatted;
          if (game)   game.textContent = formatted;
        } catch (err) {
          console.error("Error al obtener PBJ balance:", err);
        }
      }

      async function loadUserNFTs() {
        const ownedContainer = document.getElementById("userNFTs");
        const stakeContainer = document.getElementById("userNFTsStake");
        if (ownedContainer) ownedContainer.innerHTML = "";
        if (stakeContainer) stakeContainer.innerHTML = "";
        if (!provider || !userAddress) return;

        const nft = new ethers.Contract(
          nftAddress,
          [
            "function balanceOf(address owner) view returns (uint256)",
            "function tokenOfOwnerByIndex(address owner, uint256 index) view returns (uint256)",
            "function tokenURI(uint256 tokenId) view returns (string)"
          ],
          provider
        );

        try {
          const balance = await nft.balanceOf(userAddress);
          const count = parseInt(balance.toString(), 10);
          if (count === 0) {
            if (ownedContainer) ownedContainer.innerHTML = `<p class="text-gray-400">No tienes NFTs disponibles.</p>`;
            return;
          }
          for (let i = 0; i < count; i++) {
            const tokenId = await nft.tokenOfOwnerByIndex(userAddress, i);
            const card = document.createElement("div");
            card.innerHTML = `
              <div class="text-white font-semibold text-lg mb-2">NFT #${tokenId}</div>
              <button onclick="stakeNFT(${tokenId})" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded">Stake</button>
            `;
            if (ownedContainer) ownedContainer.appendChild(card);

            const card2 = document.createElement("div");
            card2.innerHTML = `
              <div class="text-white font-semibold text-lg mb-2">NFT #${tokenId}</div>
              <button onclick="stakeNFT(${tokenId})" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded">Stake</button>
            `;
            if (stakeContainer) stakeContainer.appendChild(card2);
          }
        } catch (err) {
          console.error("Error al cargar NFTs:", err);
          if (ownedContainer) ownedContainer.innerHTML = `<p class="text-red-500">Error al cargar tus NFTs.</p>`;
        }
      }

      window.buyNFT = async function(rarity) {
        try {
          if (!provider || !signer) {
            await connectFlow(isMobile());
          }
          if (!provider || !signer) return;
          const nftContract = new ethers.Contract(nftAddress, nftAbi, signer);
          const pbjErc20 = new ethers.Contract(pbjTokenAddress, pbjAbi, signer);
          const nftInfo = await nftContract.nftTypes(rarity);
          const price = nftInfo.pricePBJ;
          const allowance = await pbjErc20.allowance(userAddress, nftAddress);
          if (allowance.lt(price)) {
            const txApprove = await pbjErc20.approve(nftAddress, price);
            await txApprove.wait();
          }
          const txMint = await nftContract.mint(rarity);
          await txMint.wait();
          alert("‚úÖ NFT comprado con √©xito");
          await loadUserNFTs();
        } catch (e) {
          console.error(e);
          alert("No se pudo comprar el NFT.");
        }
      };

      // Placeholder staking functions (to implement real logic later)
      window.stakeNFT = async function(tokenId) {
        alert(`Stake NFT #${tokenId} (funci√≥n placeholder).`);
      };

      // Voting (simple in-memory)
      const votes = {};
      function renderVotes() {
        const wrap = document.getElementById('vote-results');
        if (!wrap) return;
        wrap.innerHTML = '';
        Object.entries(votes).forEach(([emoji, count]) => {
          const span = document.createElement('span');
          span.textContent = `${emoji} ${count}`;
          wrap.appendChild(span);
        });
      }

      function setupVoting() {
        document.querySelectorAll('.emoji-vote-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const e = btn.dataset.emoji;
            votes[e] = (votes[e] || 0) + 1;
            renderVotes();
          });
        });
      }

      // Presale countdown (dummy logic)
      function initPresaleCountdown() {
        const countdownEl = document.getElementById('presale-countdown');
        const progressEl  = document.getElementById('presale-progress');
        if (!countdownEl || !progressEl) return;
        const totalMs = 7 * 24 * 60 * 60 * 1000;
        const start = Date.now();
        function tick() {
          const elapsed = Date.now() - start;
          const remaining = Math.max(totalMs - elapsed, 0);
          const pct = Math.min((elapsed / totalMs) * 100, 100);
          progressEl.style.width = pct.toFixed(2) + '%';
          const d = Math.floor(remaining / (24*60*60*1000));
          const h = Math.floor((remaining % (24*60*60*1000))/(60*60*1000));
          const m = Math.floor((remaining % (60*60*1000))/(60*1000));
          const s = Math.floor((remaining % (60*1000))/1000);
          countdownEl.textContent = `${d}d ${h}h ${m}m ${s}s`;
          if (remaining > 0) requestAnimationFrame(tick);
        }
        tick();
      }

      // Tokenomics example data
      const tokenomicsData = [
        { label: 'Presale', pct: 25, colorClass: 'bar-green' },
        { label: 'Liquidity', pct: 20, colorClass: 'bar-blue' },
        { label: 'Staking', pct: 30, colorClass: 'bar-purple' },
        { label: 'Team', pct: 10, colorClass: 'bar-orange' },
        { label: 'Community', pct: 15, colorClass: 'bar-yellow' }
      ];
      function renderTokenomics() {
        const barsContainer = document.getElementById('tokenomics-bars');
        const legendContainer = document.getElementById('tokenomics-legend');
        if (!barsContainer || !legendContainer) return;
        tokenomicsData.forEach(item => {
          const div = document.createElement('div');
          div.className = `tokenomics-bar ${item.colorClass}`;
          div.innerHTML = `
            <span class="label">${item.label}</span>
            <span class="pct">${item.pct}%</span>
          `;
          barsContainer.appendChild(div);

          const leg = document.createElement('div');
          leg.className = 'legend-item';
          leg.innerHTML = `
            <span class="legend-dot" style="background:${div.style.background || window.getComputedStyle(div).backgroundColor};"></span>
            <span>${item.label}: ${item.pct}%</span>
          `;
          legendContainer.appendChild(leg);
        });
        // Simple pizza chart segments by CSS conic-gradient
        const total = tokenomicsData.reduce((a,c)=>a+c.pct,0);
        let acc = 0;
        const stops = tokenomicsData.map(d => {
          const start = acc / total * 360;
            acc += d.pct;
          const end = acc / total * 360;
          const color = window.getComputedStyle(document.querySelector(`.${d.colorClass}`)).backgroundColor;
          return `${color} ${start}deg ${end}deg`;
        }).join(', ');
        const chart = document.getElementById('pizzaChart');
        if (chart) chart.style.background = `conic-gradient(${stops})`;
      }

      function setupButtons() {
        const connectBtn = document.getElementById('connectButton');
        const wcBtn = document.getElementById('wcButton');
        if (connectBtn) connectBtn.addEventListener('click', () => connectFlow(false));
        if (wcBtn) wcBtn.addEventListener('click', () => connectFlow(true));

        const buyBtn = document.getElementById('buyButton');
        if (buyBtn) {
          buyBtn.addEventListener('click', async () => {
            if (!provider || !signer) {
              await connectFlow(isMobile());
            }
            if (!provider || !signer) return;
            try {
              const ethInput = document.getElementById('ethAmount');
              const valueEth = parseFloat(ethInput.value || '0');
              if (valueEth <= 0) return alert('Valor ETH inv√°lido.');
              const tx = await contract.buyTokens({ value: ethers.utils.parseEther(valueEth.toString()) });
              showStatus('‚è≥ Procesando compra...');
              await tx.wait();
              showStatus('‚úÖ Compra realizada');
              await updatePBJBalance();
            } catch (e) {
              console.error(e);
              showStatus('Error en compra', false);
              alert('Error realizando la compra.');
            }
          });
        }

        // Blackjack simple logic (placeholder)
        const dealBtn = document.getElementById('dealBtn');
        const hitBtn  = document.getElementById('hitBtn');
        const standBtn= document.getElementById('standBtn');
        if (dealBtn && hitBtn && standBtn) {
          dealBtn.addEventListener('click', startGame);
          hitBtn.addEventListener('click', playerHit);
          standBtn.addEventListener('click', playerStand);
        }
      }

      // Blackjack placeholder implementation
      let deck = [];
      let playerHand = [];
      let dealerHand = [];

      function buildDeck() {
        const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
        const values = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
        deck = [];
        for (const s of suits) {
          for (const v of values) {
            deck.push({s,v});
          }
        }
        deck.sort(()=>Math.random()-0.5);
      }
      function cardValue(c) {
        if (c.v === 'A') return 11;
        if (['J','Q','K'].includes(c.v)) return 10;
        return parseInt(c.v,10);
      }
      function handScore(hand) {
        let total = 0;
        let aces = 0;
        hand.forEach(c => {
          total += cardValue(c);
          if (c.v === 'A') aces++;
        });
        while (total > 21 && aces > 0) {
          total -= 10;
          aces--;
        }
        return total;
      }
      function drawCard() { return deck.pop(); }

      function renderHands() {
        const dealerArea = document.getElementById('dealerArea');
        const playerArea = document.getElementById('playerArea');
        const dealerScoreEl = document.getElementById('dealerScore');
        const playerScoreEl = document.getElementById('playerScore');
        if (!dealerArea || !playerArea || !dealerScoreEl || !playerScoreEl) return;

        dealerArea.innerHTML = '';
        playerArea.innerHTML = '';
        dealerHand.forEach(c => {
          const div = document.createElement('div');
          div.className = 'card deal';
          div.textContent = c.v + c.s;
          dealerArea.appendChild(div);
        });
        playerHand.forEach(c => {
          const div = document.createElement('div');
          div.className = 'card deal';
          div.textContent = c.v + c.s;
          playerArea.appendChild(div);
        });

        dealerScoreEl.textContent = handScore(dealerHand);
        playerScoreEl.textContent = handScore(playerHand);
      }

      function startGame() {
        buildDeck();
        playerHand = [drawCard(), drawCard()];
        dealerHand = [drawCard(), drawCard()];
        renderHands();
        document.getElementById('resultMsg').textContent = '';
        document.getElementById('hitBtn').disabled = false;
        document.getElementById('standBtn').disabled = false;
      }

      function playerHit() {
        playerHand.push(drawCard());
        renderHands();
        const score = handScore(playerHand);
        if (score > 21) endGame();
      }
      function dealerPlay() {
        while (handScore(dealerHand) < 17) {
          dealerHand.push(drawCard());
        }
      }
      function playerStand() {
        dealerPlay();
        renderHands();
        endGame();
      }
      function endGame() {
        const dealerScore = handScore(dealerHand);
        const playerScore = handScore(playerHand);
        const msgEl = document.getElementById('resultMsg');
        let msg = '';
        if (playerScore > 21) msg = 'Player Busts! Dealer Wins.';
        else if (dealerScore > 21) msg = 'Dealer Busts! Player Wins.';
        else if (playerScore === dealerScore) msg = 'Push!';
        else if (playerScore > dealerScore) msg = 'Player Wins!';
        else msg = 'Dealer Wins!';
        if (msgEl) msgEl.textContent = msg;
        document.getElementById('hitBtn').disabled = true;
        document.getElementById('standBtn').disabled = true;
      }

      // INIT
      document.addEventListener('DOMContentLoaded', () => {
        setupPresaleInputs();
        setupVoting();
        initPresaleCountdown();
        renderTokenomics();
        setupButtons();
      });
    </script>
  </body>
</html>

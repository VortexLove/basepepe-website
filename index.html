<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
  <title>PBJ - The Pepe Miner Casino</title>
  <meta name="description" content="The #1 DeFi Mining Casino on Base." />

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Rajdhani:wght@600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- External Libs -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['"Inter"', 'sans-serif'],
            mono: ['"Rajdhani"', 'monospace'],
          },
          colors: {
            bg: '#020202',
            sidebar: '#080808',
            surface: '#101010',
            primary: '#39FF14',  /* Pepe Neon Green */
            primaryDim: '#2eb312',
            gold: '#FFD700',     
            danger: '#FF4949',
          },
          animation: {
            'marquee': 'marquee 30s linear infinite',
            'slide-in': 'slideIn 0.3s ease-out forwards',
          },
          keyframes: {
            marquee: { '0%': { transform: 'translateX(0%)' }, '100%': { transform: 'translateX(-100%)' } },
            slideIn: { '0%': { opacity: 0, transform: 'translateY(-10px)' }, '100%': { opacity: 1, transform: 'translateY(0)' } }
          }
        }
      }
    }
  </script>

  <style>
    /* --- CORE THEME --- */
    body { 
        background-color: #020202; 
        color: #e2e8f0; 
        overflow: hidden; /* Main scroll handled by inner containers */
        background-image: url('https://www.transparenttextures.com/patterns/dark-matter.png'); 
        background-attachment: fixed;
    }

    .cave-vignette { position: fixed; inset: 0; pointer-events: none; z-index: 5; background: radial-gradient(circle at center, transparent 30%, #000 100%); }
    .scanlines { position: fixed; inset: 0; pointer-events: none; z-index: 6; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 2px, 3px 100%; opacity: 0.4; }
    .torch-effect { position: fixed; inset: 0; pointer-events: none; z-index: 4; background: radial-gradient(800px circle at var(--x, 50%) var(--y, 50%), rgba(57, 255, 20, 0.15), transparent 50%); mix-blend-mode: screen; }
    
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: #050505; }
    ::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #39FF14; }

    /* UI Components */
    .btn-primary { 
        background: linear-gradient(180deg, #39FF14 0%, #228b22 100%); 
        color: #000; font-weight: 800; text-transform: uppercase;
        transition: all 0.2s; border-radius: 4px; border: 1px solid #39FF14;
    }
    .btn-primary:hover { filter: brightness(1.2); box-shadow: 0 0 15px rgba(57,255,20,0.4); }
    
    .btn-secondary {
        background: #1a1a1a; color: #fff; font-weight: 700; border: 1px solid #333;
        transition: all 0.2s; border-radius: 4px;
    }
    .btn-secondary:hover { border-color: #fff; background: #222; }

    .glass-panel { background: rgba(5, 5, 5, 0.9); backdrop-filter: blur(10px); border: 1px solid #333; }
    
    /* Live Feed Table */
    .live-table tr { border-bottom: 1px solid #111; transition: background 0.2s; }
    .live-table tr:hover { background: rgba(57, 255, 20, 0.05); }
    .live-table th { font-family: 'Rajdhani'; color: #666; font-size: 10px; text-transform: uppercase; padding: 10px; text-align: left; }
    .live-table td { font-family: 'Inter'; font-size: 12px; padding: 10px; color: #ccc; }
    .win-text { color: #39FF14; text-shadow: 0 0 5px rgba(57,255,20,0.3); font-weight: bold; }
    
    /* Chat System */
    .chat-msg { margin-bottom: 8px; font-size: 12px; line-height: 1.4; animation: slideIn 0.2s ease-out; }
    .chat-user { font-weight: 700; color: #888; cursor: pointer; transition: color 0.2s; font-family: 'Rajdhani'; }
    .chat-user:hover { color: white; }
    .chat-user.mod { color: #39FF14; text-shadow: 0 0 5px rgba(57,255,20,0.5); }
    .chat-user.whale { color: #FFD700; }
    .chat-bubble { background: #111; padding: 6px 10px; border-radius: 4px; border-left: 2px solid #333; display: inline-block; max-width: 100%; word-wrap: break-word; }
    
    /* Input Fields */
    .dark-input { background: #080808; border: 1px solid #222; color: white; padding: 10px; border-radius: 4px; outline: none; transition: 0.3s; width: 100%; }
    .dark-input:focus { border-color: #39FF14; }

    /* Modal Animation */
    .modal-enter { animation: modalPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @keyframes modalPop { 0% { opacity: 0; transform: scale(0.9); } 100% { opacity: 1; transform: scale(1); } }

    /* Auth Tabs */
    .auth-tab { color: #666; border-bottom: 2px solid transparent; cursor: pointer; padding-bottom: 5px; }
    .auth-tab.active { color: white; border-color: #39FF14; }

  </style>
</head>
<body class="flex h-screen text-sm antialiased font-sans selection:bg-primary selection:text-black">

  <!-- EFFECTS -->
  <div class="cave-vignette"></div>
  <div class="scanlines"></div>
  <div class="torch-effect" id="torch"></div>
  <div id="toast-container" class="fixed bottom-5 left-5 z-[10000] flex flex-col gap-2"></div>

  <!-- AUTH MODAL -->
  <div id="authModal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-[10000] hidden items-center justify-center p-4">
      <div class="glass-panel w-full max-w-md rounded-lg p-0 overflow-hidden modal-enter relative shadow-[0_0_50px_rgba(57,255,20,0.1)]">
          <button onclick="toggleAuthModal()" class="absolute top-4 right-4 text-gray-500 hover:text-white"><i class="fas fa-times"></i></button>
          
          <div class="flex bg-[#050505] border-b border-[#222]">
              <div onclick="switchAuthTab('login')" id="tabLogin" class="flex-1 text-center py-4 font-bold font-mono uppercase auth-tab active">Log In</div>
              <div onclick="switchAuthTab('register')" id="tabRegister" class="flex-1 text-center py-4 font-bold font-mono uppercase auth-tab">Register</div>
          </div>

          <div class="p-8">
              <div class="text-center mb-6">
                  <div class="w-12 h-12 bg-primary rounded mx-auto flex items-center justify-center text-black font-bold text-2xl mb-2">P</div>
                  <h3 class="text-white font-bold text-xl">WELCOME MINER</h3>
              </div>

              <form id="authForm" onsubmit="handleAuth(event)">
                  <div class="space-y-4">
                      <div id="registerField" class="hidden">
                          <label class="text-[10px] uppercase font-bold text-gray-500">Username</label>
                          <input type="text" id="usernameInput" class="dark-input" placeholder="PepeMiner69">
                      </div>
                      <div>
                          <label class="text-[10px] uppercase font-bold text-gray-500">Email</label>
                          <input type="email" class="dark-input" placeholder="pepe@mine.com" required>
                      </div>
                      <div>
                          <label class="text-[10px] uppercase font-bold text-gray-500">Password</label>
                          <input type="password" class="dark-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                      </div>
                      
                      <button type="submit" class="btn-primary w-full py-3 mt-4 text-sm font-bold shadow-[0_0_15px_rgba(57,255,20,0.2)]">
                          <span id="authBtnText">ENTER MINE</span>
                      </button>

                      <div class="relative flex py-2 items-center">
                          <div class="flex-grow border-t border-[#222]"></div>
                          <span class="flex-shrink-0 mx-4 text-gray-600 text-xs">OR</span>
                          <div class="flex-grow border-t border-[#222]"></div>
                      </div>

                      <button type="button" id="walletAuthBtn" class="w-full bg-[#111] hover:bg-[#222] border border-[#333] text-white py-3 rounded flex items-center justify-center gap-2 transition">
                          <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" class="w-5 h-5">
                          Continue with Wallet
                      </button>
                  </div>
              </form>
          </div>
      </div>
  </div>

  <!-- LEFT SIDEBAR -->
  <aside id="sidebar" class="hidden md:flex w-60 flex-col bg-sidebar border-r border-[#222] flex-shrink-0 z-20 relative h-full glass-panel">
    <div class="h-16 flex items-center px-5 border-b border-[#222]">
      <div class="w-8 h-8 bg-primary rounded flex items-center justify-center mr-3 text-black font-bold text-lg shadow-[0_0_10px_#39FF14]">P</div>
      <span class="text-white font-bold text-lg tracking-tight font-mono">PEPE<span class="text-primary">.BET</span></span>
    </div>
    <div class="flex-1 overflow-y-auto py-4 px-2 space-y-1">
      <div class="px-3 mb-2 text-[10px] font-bold text-gray-600 uppercase tracking-wider">Casino</div>
      <a href="#" class="flex items-center px-3 py-2 bg-[#111] text-white rounded border-l-2 border-primary"><i class="fas fa-home w-6 text-primary"></i> <span class="font-medium">Lobby</span></a>
      <a href="#games" class="flex items-center px-3 py-2 text-gray-400 hover:text-white hover:bg-[#111] rounded transition"><i class="fas fa-gamepad w-6"></i> <span class="font-medium">Originals</span></a>
      <a href="#slots" class="flex items-center px-3 py-2 text-gray-400 hover:text-white hover:bg-[#111] rounded transition"><i class="fas fa-gem w-6"></i> <span class="font-medium">Slots</span></a>
      
      <div class="px-3 mt-6 mb-2 text-[10px] font-bold text-gray-600 uppercase tracking-wider">Finance</div>
      <a href="#presale" class="flex items-center px-3 py-2 text-gray-400 hover:text-white hover:bg-[#111] rounded transition"><i class="fas fa-coins w-6 text-gold"></i> <span class="font-medium">Buy $PBJ</span> <span class="ml-auto bg-primary text-black text-[9px] font-bold px-1 rounded">SALE</span></a>
      <a href="#staking" class="flex items-center px-3 py-2 text-gray-400 hover:text-white hover:bg-[#111] rounded transition"><i class="fas fa-vault w-6"></i> <span class="font-medium">Vault</span></a>
    </div>
    <div class="p-4 border-t border-[#222]">
        <div class="bg-[#111] rounded p-3 text-center border border-[#222]">
            <p class="text-xs text-gray-500 mb-1">Jackpot Pool</p>
            <p class="text-primary font-mono font-bold text-lg glow">$420,069.00</p>
        </div>
    </div>
  </aside>

  <!-- MAIN CONTENT WRAPPER -->
  <div class="flex-1 flex flex-col h-screen overflow-hidden relative z-10">
    
    <!-- NAVBAR -->
    <header class="h-16 bg-black/80 backdrop-blur border-b border-[#222] flex items-center justify-between px-4 sticky top-0 z-30">
      <div class="flex items-center gap-4">
          <button class="md:hidden text-gray-300"><i class="fas fa-bars"></i></button>
          
          <!-- Search -->
          <div class="hidden md:flex items-center bg-[#111] border border-[#222] rounded-full px-4 py-1.5 w-64 focus-within:border-primary transition">
              <i class="fas fa-search text-gray-500 text-xs mr-2"></i>
              <input type="text" placeholder="Search game..." class="bg-transparent border-none outline-none text-xs text-white w-full font-mono">
          </div>
      </div>

      <div class="flex items-center gap-3">
         <!-- Wallet Balance (Hidden until login) -->
         <div id="userBalanceDisplay" class="hidden items-center bg-[#111] border border-[#333] rounded px-3 py-1.5">
            <span class="text-primary font-bold text-sm mr-2 font-mono">1,420.00</span>
            <span class="text-[10px] text-gray-500 font-bold">PBJ</span>
            <button class="ml-3 bg-primary text-black text-[10px] font-bold px-2 py-0.5 rounded">DEPOSIT</button>
         </div>

         <!-- Auth Buttons -->
         <div id="authButtons" class="flex gap-2">
             <button onclick="toggleAuthModal('login')" class="text-white font-bold text-xs hover:text-primary px-2">Log In</button>
             <button onclick="toggleAuthModal('register')" class="btn-primary px-4 py-2 text-xs shadow-none">Register</button>
         </div>

         <!-- Profile (Hidden) -->
         <div id="userProfile" class="hidden items-center gap-2 cursor-pointer">
             <div class="w-8 h-8 rounded bg-gray-800 border border-gray-600 overflow-hidden">
                 <img src="https://api.dicebear.com/7.x/pixel-art/svg?seed=Pepe" alt="Avatar">
             </div>
         </div>
         
         <!-- Chat Toggle -->
         <button onclick="toggleChat()" class="ml-2 w-8 h-8 rounded bg-[#111] border border-[#222] text-gray-400 hover:text-white flex items-center justify-center transition">
            <i class="fas fa-comments"></i>
         </button>
      </div>
    </header>

    <!-- CENTER SCROLLABLE -->
    <div class="flex-1 overflow-hidden relative flex">
        
        <main class="flex-1 overflow-y-auto scroll-smooth pb-20">
            
            <!-- LIVE FEED (ROLLBIT STYLE) -->
            <div id="liveFeedSection" class="border-b border-[#222] bg-[#050505]">
                <div class="flex items-center justify-between px-4 py-2 border-b border-[#111]">
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 bg-primary rounded-full animate-pulse"></div>
                        <span class="text-[10px] font-bold text-gray-400 font-mono uppercase">Live Mining Operations</span>
                    </div>
                    <div class="flex gap-2 text-[10px] font-bold text-gray-600">
                        <span class="text-white cursor-pointer">All Bets</span>
                        <span class="hover:text-white cursor-pointer">High Rollers</span>
                    </div>
                </div>
                <div class="overflow-hidden h-[180px] relative">
                     <!-- Fade overlay at bottom -->
                     <div class="absolute bottom-0 left-0 w-full h-8 bg-gradient-to-t from-[#050505] to-transparent z-10 pointer-events-none"></div>
                     <table class="w-full live-table">
                         <thead>
                             <tr>
                                 <th>Game</th>
                                 <th>Miner</th>
                                 <th>Bet Amount</th>
                                 <th>Multiplier</th>
                                 <th>Payout</th>
                             </tr>
                         </thead>
                         <tbody id="liveFeedBody">
                             <!-- JS will inject rows here -->
                         </tbody>
                     </table>
                </div>
            </div>

            <!-- HERO AREA -->
            <div class="p-6">
                <div class="rounded-xl overflow-hidden glass-panel border border-[#333] relative min-h-[300px] flex items-center p-8">
                     <div class="absolute inset-0 z-0">
                        <img src="assets/img/hero-pepe.png" class="w-full h-full object-cover opacity-20" onerror="this.style.display='none'">
                        <div class="absolute inset-0 bg-gradient-to-r from-black via-black/80 to-transparent"></div>
                    </div>
                    <div class="relative z-10 max-w-lg">
                        <h1 class="text-4xl md:text-5xl font-bold text-white mb-4 font-mono">THE #1 CASINO ON BASE</h1>
                        <p class="text-gray-400 mb-6">Experience the first deflationary mining casino. Earn PBJ tokens for every bet placed. 100% Provably Fair.</p>
                        <div class="flex gap-3">
                            <button onclick="document.getElementById('games').scrollIntoView()" class="btn-primary px-6 py-3 text-sm">START MINING</button>
                            <button onclick="toggleAuthModal('register')" class="bg-[#222] text-white px-6 py-3 rounded text-sm font-bold border border-[#444] hover:bg-[#333]">GET BONUS</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GAMES GRID -->
            <section id="games" class="p-6 pt-0">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-bold text-white font-mono flex items-center gap-2"><i class="fas fa-fire text-danger"></i> POPULAR SHAFTS</h2>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    <!-- Cards -->
                    <div class="cursor-pointer group relative rounded-lg overflow-hidden aspect-[3/4] bg-[#111] border border-[#222] hover:border-primary transition hover:-translate-y-1">
                        <img src="https://placehold.co/300x400/111/333?text=CRASH" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 transition">
                        <div class="absolute bottom-0 inset-x-0 bg-gradient-to-t from-black p-3">
                            <h4 class="text-white font-bold font-mono">CRASH</h4>
                            <p class="text-[10px] text-gray-500">Rocket Cart</p>
                        </div>
                    </div>
                    <div class="cursor-pointer group relative rounded-lg overflow-hidden aspect-[3/4] bg-[#111] border border-[#222] hover:border-primary transition hover:-translate-y-1">
                        <img src="https://placehold.co/300x400/111/333?text=MINES" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 transition">
                        <div class="absolute bottom-0 inset-x-0 bg-gradient-to-t from-black p-3">
                            <h4 class="text-white font-bold font-mono">MINES</h4>
                            <p class="text-[10px] text-gray-500">Gem Hunt</p>
                        </div>
                    </div>
                    <div class="cursor-pointer group relative rounded-lg overflow-hidden aspect-[3/4] bg-[#111] border border-[#222] hover:border-primary transition hover:-translate-y-1">
                        <img src="https://placehold.co/300x400/111/333?text=PLINKO" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 transition">
                        <div class="absolute bottom-0 inset-x-0 bg-gradient-to-t from-black p-3">
                            <h4 class="text-white font-bold font-mono">PLINKO</h4>
                            <p class="text-[10px] text-gray-500">Ball Drop</p>
                        </div>
                    </div>
                    <div class="cursor-pointer group relative rounded-lg overflow-hidden aspect-[3/4] bg-[#111] border border-[#222] hover:border-primary transition hover:-translate-y-1">
                        <img src="https://placehold.co/300x400/111/333?text=SLOTS" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 transition">
                        <div class="absolute bottom-0 inset-x-0 bg-gradient-to-t from-black p-3">
                            <h4 class="text-white font-bold font-mono">SLOTS</h4>
                            <p class="text-[10px] text-gray-500">Gem Slots</p>
                        </div>
                    </div>
                     <div class="cursor-pointer group relative rounded-lg overflow-hidden aspect-[3/4] bg-[#111] border border-[#222] hover:border-primary transition hover:-translate-y-1">
                        <img src="https://placehold.co/300x400/111/333?text=BLACKJACK" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 transition">
                        <div class="absolute bottom-0 inset-x-0 bg-gradient-to-t from-black p-3">
                            <h4 class="text-white font-bold font-mono">BLACKJACK</h4>
                            <p class="text-[10px] text-gray-500">Cave Tables</p>
                        </div>
                    </div>
                    <div class="cursor-pointer group relative rounded-lg overflow-hidden aspect-[3/4] bg-[#111] border border-[#222] hover:border-primary transition hover:-translate-y-1">
                        <img src="https://placehold.co/300x400/111/333?text=ROULETTE" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 transition">
                        <div class="absolute bottom-0 inset-x-0 bg-gradient-to-t from-black p-3">
                            <h4 class="text-white font-bold font-mono">ROULETTE</h4>
                            <p class="text-[10px] text-gray-500">Spin It</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- RIGHT SIDEBAR (CHAT) -->
        <aside id="chatSidebar" class="w-72 bg-sidebar border-l border-[#222] flex flex-col z-20 transition-all duration-300 transform translate-x-0">
            <!-- Chat Header -->
            <div class="h-12 border-b border-[#222] flex items-center justify-between px-3 bg-[#0a0a0a]">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-green-500"></div>
                    <span class="text-xs font-bold text-gray-300 font-mono">MINE CHAT (420)</span>
                </div>
                <div class="flex gap-2">
                    <button class="text-gray-500 hover:text-white"><i class="fas fa-flag"></i></button>
                    <button onclick="toggleChat()" class="text-gray-500 hover:text-white md:hidden"><i class="fas fa-times"></i></button>
                </div>
            </div>

            <!-- Chat Area -->
            <div id="chatContainer" class="flex-1 overflow-y-auto p-3 space-y-2 relative">
                <!-- Messages Injected via JS -->
                <div class="text-center text-[10px] text-gray-600 my-4">--- Welcome to the Cave ---</div>
            </div>

            <!-- Chat Input -->
            <div class="p-3 bg-[#0a0a0a] border-t border-[#222]">
                 <div class="relative">
                     <input type="text" id="chatInput" class="bg-[#151515] border border-[#333] text-gray-200 text-xs rounded w-full py-2.5 px-3 pr-8 outline-none focus:border-primary transition" placeholder="Say something..." onkeypress="handleChatKey(event)">
                     <button onclick="sendChat()" class="absolute right-2 top-2 text-gray-500 hover:text-primary"><i class="fas fa-paper-plane"></i></button>
                 </div>
                 <div class="flex justify-between mt-2 px-1">
                     <button class="text-[10px] text-gray-500 font-bold hover:text-white">RULES</button>
                     <button class="text-[10px] text-gold font-bold hover:text-yellow-300"><i class="fas fa-gift mr-1"></i>RAIN</button>
                 </div>
            </div>
        </aside>

    </div>
  </div>

  <script>
    // --- GLOBAL UTILS ---
    const getEl = (id) => document.getElementById(id);
    const createEl = (tag) => document.createElement(tag);
    
    // --- AUTH SYSTEM ---
    let isLoggedIn = false;

    function toggleAuthModal(tab = 'login') {
        const modal = getEl('authModal');
        if (modal.classList.contains('hidden')) {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            switchAuthTab(tab);
        } else {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }
    }

    function switchAuthTab(tab) {
        const tLogin = getEl('tabLogin');
        const tReg = getEl('tabRegister');
        const regField = getEl('registerField');
        const btnText = getEl('authBtnText');
        const usernameInput = getEl('usernameInput');

        if (tab === 'login') {
            tLogin.classList.add('active');
            tReg.classList.remove('active');
            regField.classList.add('hidden');
            btnText.innerText = "ENTER MINE";
            usernameInput.removeAttribute('required');
        } else {
            tReg.classList.add('active');
            tLogin.classList.remove('active');
            regField.classList.remove('hidden');
            btnText.innerText = "CREATE ID";
            usernameInput.setAttribute('required', 'true');
        }
    }

    function handleAuth(e) {
        e.preventDefault();
        // Simulate API Call
        const btn = e.target.querySelector('button[type="submit"]');
        const originalText = btn.innerText;
        btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i>';
        
        setTimeout(() => {
            isLoggedIn = true;
            toggleAuthModal();
            updateAuthUI();
            btn.innerText = originalText;
            
            // Add system welcome message
            addChatMessage('SYSTEM', 'Welcome to the mine, new digger!', 'mod');
            
            // Show toast
            const toast = createEl('div');
            toast.className = 'bg-primary text-black font-bold px-4 py-2 rounded shadow-lg animate-slide-in';
            toast.innerText = "ACCESS GRANTED: WALLET LINKED";
            getEl('toast-container').appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }, 1500);
    }
    
    // Also handle wallet button
    getEl('walletAuthBtn').addEventListener('click', (e) => {
        handleAuth({ preventDefault: () => {}, target: { querySelector: () => e.target } });
    });

    function updateAuthUI() {
        if(isLoggedIn) {
            getEl('authButtons').classList.add('hidden');
            getEl('userBalanceDisplay').classList.remove('hidden');
            getEl('userBalanceDisplay').classList.add('flex');
            getEl('userProfile').classList.remove('hidden');
            getEl('userProfile').classList.add('flex');
        }
    }

    // --- CHAT SYSTEM ---
    const chatUsers = ['PepeKing', 'ElonMuskrat', 'Digger88', 'GoldFever', 'SatoshiN', 'WAGMI_Boy', 'DiamondHands'];
    const chatContainer = getEl('chatContainer');
    const userColors = ['text-blue-400', 'text-red-400', 'text-purple-400', 'text-yellow-400', 'text-green-400'];

    function toggleChat() {
        const sidebar = getEl('chatSidebar');
        if (sidebar.classList.contains('translate-x-full') || sidebar.style.display === 'none') {
            sidebar.classList.remove('translate-x-full', 'hidden');
        } else {
            // Check screen size
            if(window.innerWidth < 768) {
                sidebar.classList.add('hidden');
            } else {
                sidebar.classList.add('translate-x-full'); // Or width 0
                sidebar.style.marginRight = "-18rem"; // Manual hide for simplicity in this demo structure
            }
        }
        
        // Simpler toggle for demo layout:
        if(sidebar.style.width === '0px') {
            sidebar.style.width = '18rem';
            sidebar.style.padding = '';
        } else {
            // sidebar.style.width = '0px';
            // sidebar.style.padding = '0';
        }
    }

    function addChatMessage(user, msg, type = 'user') {
        const div = createEl('div');
        div.className = 'chat-msg';
        
        let userClass = 'chat-user ' + (type === 'user' ? userColors[Math.floor(Math.random() * userColors.length)] : type);
        let badge = '';
        if(type === 'mod') badge = '<i class="fas fa-shield-alt text-[10px] mr-1"></i>';
        if(type === 'whale') badge = '<i class="fas fa-crown text-[10px] mr-1"></i>';
        
        div.innerHTML = `
            <div>
                <span class="${userClass}">${badge}${user}:</span>
                <span class="text-gray-300 ml-1 bg-[#151515] px-2 py-0.5 rounded text-xs">${msg}</span>
            </div>
        `;
        chatContainer.appendChild(div);
        chatContainer.scrollTop = chatContainer.scrollHeight;
        
        // Limit messages
        if(chatContainer.children.length > 50) chatContainer.removeChild(chatContainer.children[0]);
    }

    function sendChat() {
        const input = getEl('chatInput');
        const text = input.value.trim();
        if(!text) return;
        
        if(!isLoggedIn) {
            toggleAuthModal();
            return;
        }

        addChatMessage('You', text, 'user');
        input.value = '';
    }
    
    function handleChatKey(e) { if(e.key === 'Enter') sendChat(); }

    // Simulation Bot
    setInterval(() => {
        const msgs = ['LFG!!!', 'Just hit 100x on Crash', 'Plinko is draining me lol', 'Anyone mining BTC?', 'Pepe to the moon', 'Rigged?', 'Green rain soon?'];
        const u = chatUsers[Math.floor(Math.random() * chatUsers.length)];
        const m = msgs[Math.floor(Math.random() * msgs.length)];
        const isWhale = Math.random() > 0.9;
        addChatMessage(u, m, isWhale ? 'whale' : 'user');
    }, 3500);

    // --- LIVE FEED SYSTEM ---
    const liveBody = getEl('liveFeedBody');
    const games = [
        { name: 'Crash', icon: 'ðŸš€' },
        { name: 'Mines', icon: 'ðŸ’£' },
        { name: 'Slots', icon: 'ðŸŽ°' },
        { name: 'Plinko', icon: 'ðŸŽ¯' },
        { name: 'Roulette', icon: 'ðŸŽ¡' }
    ];

    function addLiveBet() {
        const game = games[Math.floor(Math.random() * games.length)];
        const user = '0x' + Math.random().toString(16).substr(2, 4) + '...' + Math.random().toString(16).substr(2, 4);
        const bet = (Math.random() * 1000).toFixed(0);
        const won = Math.random() > 0.6; // 40% win rate sim
        let mult = 0;
        let payout = 0;
        
        if(won) {
            mult = (Math.random() * 5 + 1).toFixed(2);
            payout = (bet * mult).toFixed(0);
        } else {
            mult = 0.00;
        }

        const tr = createEl('tr');
        tr.className = 'animate-slide-in';
        tr.innerHTML = `
            <td class="flex items-center gap-2"><span class="text-lg">${game.icon}</span> <span class="hidden md:inline">${game.name}</span></td>
            <td><span class="text-xs text-primary font-mono">${user}</span></td>
            <td><span class="text-white font-bold">${bet}</span> <i class="fas fa-cookie text-[10px] text-gray-500"></i></td>
            <td><span class="${won ? 'text-white' : 'text-gray-600'}">${mult}x</span></td>
            <td>${won ? `<span class="win-text">+${payout}</span>` : '<span class="text-gray-700">-</span>'}</td>
        `;

        // Add to top
        liveBody.insertBefore(tr, liveBody.firstChild);
        
        // Remove last if too many
        if(liveBody.children.length > 8) {
            liveBody.removeChild(liveBody.lastChild);
        }
    }

    // Start Simulation
    setInterval(addLiveBet, 1200);
    // Init with some data
    for(let i=0; i<5; i++) addLiveBet();

    // --- AUDIO ---
    document.addEventListener('mousemove', (e) => {
        const x = (e.clientX / window.innerWidth) * 100;
        const y = (e.clientY / window.innerHeight) * 100;
        getEl('torch').style.setProperty('--x', x + '%');
        getEl('torch').style.setProperty('--y', y + '%');
    });

  </script>
</body>
</html>

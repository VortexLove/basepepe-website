<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
  <title>Pepe Blackjack (PBJ) - Premier Crypto Casino</title>
  <meta name="description" content="The #1 Meme Casino on Base. Play Blackjack, Slots, Plinko. Stake NFTs." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Press+Start+2P&display=swap" rel="stylesheet" />

  <!-- Frameworks -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    :root {
      --neon-green: #39ff14;
      --panel-bg: rgba(8, 12, 10, 0.95);
      --glass-border: rgba(57, 255, 20, 0.25);
    }

    /* Typography */
    h1, h2, h3, .nav-btn, .pixel-font { font-family: 'Press Start 2P', cursive; }
    body { font-family: 'Inter', sans-serif; background-color: #020202; color: #e0e0e0; overflow-x: hidden; }

    /* Backgrounds */
    body::before {
      content: ""; position: fixed; inset: 0; pointer-events: none; z-index: -2;
      background: radial-gradient(circle at 20% 50%, rgba(34, 197, 94, 0.08), transparent 40%),
                  radial-gradient(circle at 80% 20%, rgba(37, 99, 235, 0.08), transparent 40%);
    }
    body::after {
      content: ""; position: fixed; inset: 0; pointer-events: none; z-index: -2;
      background-image: linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    /* Glass Panels (TUS ESTILOS ORIGINALES) */
    .glass-panel {
      background: var(--panel-bg);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
      transition: transform 0.3s ease, border-color 0.3s ease;
    }
    .glass-panel:hover { border-color: rgba(57, 255, 20, 0.6); }

    /* Buttons */
    .nav-btn { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; transition: all 0.2s; cursor: pointer; }
    .nav-btn:hover { color: var(--neon-green); text-shadow: 0 0 8px var(--neon-green); transform: translateY(-2px); }
    
    .action-btn {
      background: linear-gradient(135deg, #22c55e 0%, #166534 100%);
      box-shadow: 0 4px 0 #064e3b; transition: all 0.1s; text-shadow: 1px 1px 0 #000;
      border: none; cursor: pointer;
    }
    .action-btn:active { transform: translateY(4px); box-shadow: 0 0 0 transparent; }
    .action-btn:disabled { background: #333; box-shadow: none; cursor: not-allowed; opacity: 0.6; filter: grayscale(1); }

    /* Game Cards */
    .game-card {
      position: relative; overflow: hidden; border-radius: 12px; cursor: pointer;
      border: 1px solid #222; transition: all 0.3s; display: block;
    }
    .game-card:hover { transform: translateY(-5px); border-color: var(--neon-green); box-shadow: 0 0 15px rgba(57, 255, 20, 0.2); }
    .game-card img { width: 100%; height: 160px; object-fit: cover; transition: transform 0.3s; }
    .game-card:hover img { transform: scale(1.05); }
    .play-overlay {
      position: absolute; inset: 0; background: rgba(0,0,0,0.7);
      display: flex; align-items: center; justify-content: center;
      opacity: 0; transition: opacity 0.2s;
    }
    .game-card:hover .play-overlay { opacity: 1; }

    /* MODALS (ADAPTADO A TUS ESTILOS) */
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); z-index: 9990; display: none; align-items: center; justify-content: center; }
    .modal-content { background: #080c0a; border: 2px solid var(--neon-green); padding: 2rem; border-radius: 1rem; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; position: relative; box-shadow: 0 0 50px rgba(57,255,20,0.1); }

    /* Animations & Extras */
    @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(57, 255, 20, 0.7); } 70% { box-shadow: 0 0 0 6px rgba(57, 255, 20, 0); } 100% { box-shadow: 0 0 0 0 rgba(57, 255, 20, 0); } }
    .live-dot { animation: pulse-green 2s infinite; }
    @keyframes flash-border { 0%, 100% { border-color: #eab308; } 50% { border-color: #ffffff; } }
    .flash-sale-active { animation: flash-border 1.5s infinite; border-width: 2px; }

    /* ANIMACIONES DE JUEGO */
@keyframes shake { 
    0% { transform: translate(1px, 1px) rotate(0deg); }
    10% { transform: translate(-1px, -2px) rotate(-1deg); }
    20% { transform: translate(-3px, 0px) rotate(1deg); }
    30% { transform: translate(3px, 2px) rotate(0deg); }
    40% { transform: translate(1px, -1px) rotate(1deg); }
    50% { transform: translate(-1px, 2px) rotate(-1deg); }
    60% { transform: translate(-3px, 1px) rotate(0deg); }
    70% { transform: translate(3px, 1px) rotate(-1deg); }
    80% { transform: translate(-1px, -1px) rotate(1deg); }
    90% { transform: translate(1px, 2px) rotate(0deg); }
    100% { transform: translate(1px, -2px) rotate(-1deg); }
}
.shaking { animation: shake 0.5s infinite; }
.blur-anim { filter: blur(2px); transition: filter 0.1s; }

    /* Timer Boxes */
    .timer-box { background: #111; border: 1px solid #333; padding: 5px 10px; border-radius: 5px; text-align: center; }
    .timer-val { font-family: 'Press Start 2P'; color: var(--neon-green); font-size: 12px; }
    .timer-label { font-size: 8px; color: #666; display: block; }
  </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

  <div id="toast-container" class="fixed bottom-5 right-5 z-50 flex flex-col gap-2"></div>

  <!-- UNIVERSAL GAME MODAL -->
  <div id="gameModal" class="modal-backdrop">
    <div class="modal-content relative">
        <button onclick="closeGame()" class="absolute top-4 right-4 text-gray-500 hover:text-white text-xl">‚úï</button>
        
        <div class="flex items-center gap-4 mb-6 border-b border-gray-800 pb-4">
            <div class="text-4xl" id="modalIcon">üé∞</div>
            <div>
                <h2 id="modalTitle" class="text-xl text-white pixel-font text-green-400">GAME TITLE</h2>
                <p class="text-xs text-gray-400 font-mono">Provably Fair ‚Ä¢ On-Chain</p>
            </div>
        </div>

        <!-- Game Content Area -->
        <div id="gameContent" class="min-h-[150px] flex flex-col items-center justify-center text-center mb-6 py-4 border border-gray-800 rounded bg-black/40">
            <!-- JS Injects game interface here -->
        </div>

        <!-- Controls -->
        <div class="bg-gray-900/50 p-4 rounded-xl border border-gray-800">
            <div class="flex justify-between text-xs text-gray-400 mb-2 font-mono">
                <span>BET AMOUNT</span>
                <span>Balance: <span id="modalBalance" class="text-green-400">0</span> PBJ</span>
            </div>
            <div class="flex gap-2">
                <input type="number" id="gameBetInput" value="1000" class="bg-black border border-gray-700 rounded px-4 py-3 w-full text-white font-mono focus:border-green-500 outline-none text-center font-bold" placeholder="Bet Amount">
                <button id="gameActionBtn" class="action-btn text-white px-8 py-3 rounded font-bold pixel-font text-xs whitespace-nowrap">PLAY</button>
            </div>
            <!-- Extra controls for Roulette/Crash -->
            <div id="gameExtraControls" class="mt-3 flex gap-2 justify-center hidden"></div>
        </div>
        
        <div id="gameStatus" class="text-center mt-4 text-xs text-yellow-500 font-mono h-4 uppercase tracking-wider"></div>
    </div>
  </div>

  <!-- HEADER -->
  <nav class="sticky top-0 z-50 bg-black/90 backdrop-blur-md border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 py-3 flex flex-wrap items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 bg-green-500 rounded-full shadow-[0_0_15px_#22c55e]"></div>
        <span class="text-green-400 text-sm md:text-lg pixel-font">PBJ CASINO</span>
      </div>
      
      <div class="hidden lg:flex gap-6">
        <a href="#presale" class="nav-btn text-green-400 font-bold">BUY PBJ</a>
        <a href="#games" class="nav-btn text-gray-400">Lobby</a>
        <a href="#staking" class="nav-btn text-gray-400">Staking</a>
        <a href="#partners" class="nav-btn text-gray-400">Partners</a>
      </div>

      <div class="flex items-center gap-3 ml-auto md:ml-0">
        <div class="hidden md:flex items-center gap-2 px-3 py-1 rounded-full bg-gray-900 border border-gray-700 text-[10px] text-gray-300">
            <span class="w-2 h-2 bg-green-500 rounded-full live-dot"></span>
            <span id="ticker" class="font-mono text-gray-400 w-40 truncate">Live Wins...</span>
        </div>

        <div id="walletDisplay" class="hidden flex-col text-right mr-2">
            <span class="text-[9px] text-gray-500">BALANCE</span>
            <span class="text-xs text-green-400 font-bold font-mono"><span id="headerBalance">0</span> PBJ</span>
        </div>
        <button id="connectBtn" class="pixel-font bg-green-600 hover:bg-green-500 text-black text-[10px] px-4 py-2 rounded shadow-[0_0_10px_rgba(34,197,94,0.4)] transition-all">
          CONNECT
        </button>
      </div>
    </div>
  </nav>

  <main class="flex-grow max-w-6xl mx-auto w-full px-4 py-8 space-y-20">

    <!-- HERO & BUY SECTION (PRESALE) -->
    <section id="presale" class="grid md:grid-cols-2 gap-12 items-center pt-4">
      <div class="space-y-6 text-center md:text-left">
        
        <!-- Countdown -->
        <div class="flex flex-col md:flex-row items-center gap-4 mb-2">
            <div class="inline-block px-3 py-1 rounded-full border border-green-500/30 bg-green-500/10 text-green-400 text-[10px] font-bold tracking-widest">
                PRESALE ENDING SOON
            </div>
            <div class="flex gap-2">
                <div class="timer-box"><span id="d" class="timer-val">00</span><span class="timer-label">D</span></div>
                <div class="timer-box"><span id="h" class="timer-val">00</span><span class="timer-label">H</span></div>
                <div class="timer-box"><span id="m" class="timer-val">00</span><span class="timer-label">M</span></div>
                <div class="timer-box"><span id="s" class="timer-val">00</span><span class="timer-label">S</span></div>
            </div>
        </div>

        <h1 class="text-3xl md:text-5xl leading-tight text-white">
          Get <span class="text-green-500">PBJ</span> Tokens
        </h1>
        <p class="text-gray-400 leading-relaxed text-xs md:text-sm">
          The fuel for the entire Pepe Blackjack ecosystem.<br>
          <span class="text-yellow-400 font-bold">‚ö° FLASH OFFER: +50% BONUS ACTIVE</span>
        </p>

        <!-- Swap UI -->
        <div class="glass-panel p-6 space-y-4 relative overflow-hidden max-w-md mx-auto md:mx-0 flash-sale-active">
          <div id="flashBadge" class="absolute top-0 right-0 bg-yellow-500 text-black font-bold text-[10px] px-3 py-1 rounded-bl-xl z-20 animate-pulse">
             üî• BONUS: 01:59:59
          </div>

          <div class="bg-black/60 rounded-xl p-3 border border-gray-700">
             <div class="flex justify-between text-[10px] text-gray-400 mb-1"><span>PAY (ETH)</span><span>Bal: --</span></div>
             <div class="flex items-center gap-2">
                <input type="number" id="buyInput" class="bg-transparent text-white text-lg w-full outline-none font-mono" placeholder="0.1">
                <span class="font-bold text-gray-300 text-sm">ETH</span>
             </div>
          </div>

          <div class="flex justify-center -my-2"><span class="text-gray-500 text-xs">‚Üì</span></div>

          <div class="bg-black/60 rounded-xl p-3 border border-gray-700">
             <div class="flex justify-between text-[10px] text-gray-400 mb-1"><span>RECEIVE (PBJ)</span><span class="text-yellow-400">Rate: 1.5M/ETH</span></div>
             <div class="flex items-center gap-2">
                <input type="number" id="receiveInput" class="bg-transparent text-white text-lg w-full outline-none font-mono" readonly placeholder="0">
                <span class="font-bold text-green-500 text-sm">PBJ</span>
             </div>
          </div>

          <button id="buyBtn" class="w-full action-btn text-white font-bold py-3 rounded-xl pixel-font text-xs tracking-widest shadow-lg">
            BUY NOW
          </button>
        </div>
      </div>
      
      <div class="hidden md:block">
        <img src="/prevent.png" alt="Pepe Swap" class="rounded-2xl shadow-2xl border border-gray-800 opacity-90">
      </div>
    </section>

    <!-- PARTNERS PROGRAM -->
    <section id="partners" class="border-t border-gray-800 pt-10">
        <div class="text-center mb-10">
            <h2 class="text-2xl md:text-3xl text-white pixel-font mb-2">PARTNER PROGRAM</h2>
            <p class="text-sm text-gray-400">Earn up to <span class="text-green-500 font-bold">50% RevShare</span>.</p>
        </div>

        <div class="glass-panel p-6">
            <div id="partner-locked" class="text-center py-6">
                <p class="text-gray-400 text-xs mb-4">Connect wallet to access your dashboard.</p>
            </div>
            <div id="partner-unlocked" class="hidden">
                <label class="text-[10px] text-gray-500 font-bold">YOUR REFERRAL LINK</label>
                <div class="flex gap-2 mt-2 mb-4">
                    <input type="text" id="refLinkInput" readonly class="w-full bg-black border border-gray-700 rounded p-2 text-white font-mono text-xs">
                    <button onclick="copyRefLink()" class="bg-gray-800 text-white px-4 rounded text-xs border border-gray-600">COPY</button>
                </div>
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div class="bg-black/40 p-2 rounded border border-gray-800"><p class="text-[9px] text-gray-500">Tier</p><p class="text-white font-bold">Scout</p></div>
                    <div class="bg-black/40 p-2 rounded border border-gray-800"><p class="text-[9px] text-gray-500">Refs</p><p class="text-white font-bold">0</p></div>
                    <div class="bg-black/40 p-2 rounded border border-gray-800"><p class="text-[9px] text-gray-500">Earned</p><p class="text-green-400 font-bold">0.00</p></div>
                </div>
            </div>
        </div>
    </section>

    <!-- GAMES LOBBY (Updated with onClick events) -->
    <section id="games">
      <h2 class="text-xl md:text-2xl text-white mb-6 flex items-center gap-2">
        <span class="text-green-500 pixel-font">GAMES LOBBY</span>
      </h2>
      
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        
        <!-- Blackjack -->
        <div onclick="openGame('blackjack')" class="game-card group">
          <img src="games/media/blackjack.jpg" alt="Blackjack" onerror="this.src='https://placehold.co/400x300/064e3b/39ff14?text=Blackjack'">
          <div class="p-3 bg-gray-900 border-t border-gray-800">
            <h3 class="text-xs text-white font-bold pixel-font">Blackjack</h3>
            <p class="text-[10px] text-gray-500">Live Dealer</p>
          </div>
          <div class="play-overlay"><span class="action-btn px-4 py-2 rounded text-xs font-bold text-white">PLAY</span></div>
        </div>

        <!-- Slots -->
        <div onclick="openGame('slots')" class="game-card group">
          <img src="games/media/slots.jpg" alt="Slots" onerror="this.src='https://placehold.co/400x300/581c87/d8b4fe?text=Slots'">
          <div class="p-3 bg-gray-900 border-t border-gray-800">
            <h3 class="text-xs text-white font-bold pixel-font">Pepe Slots</h3>
            <p class="text-[10px] text-gray-500">Jackpot 10x</p>
          </div>
          <div class="play-overlay"><span class="action-btn px-4 py-2 rounded text-xs font-bold text-white">SPIN</span></div>
        </div>

        <!-- Roulette -->
        <div onclick="openGame('roulette')" class="game-card group">
          <img src="games/media/ruleta.jpg" alt="Roulette" onerror="this.src='https://placehold.co/400x300/7f1d1d/fca5a5?text=Roulette'">
          <div class="p-3 bg-gray-900 border-t border-gray-800">
            <h3 class="text-xs text-white font-bold pixel-font">Roulette</h3>
            <p class="text-[10px] text-gray-500">Red or Black</p>
          </div>
          <div class="play-overlay"><span class="action-btn px-4 py-2 rounded text-xs font-bold text-white">BET</span></div>
        </div>

        <!-- Crash -->
        <div onclick="openGame('crash')" class="game-card group">
          <img src="games/media/crash.jpg" alt="Crash" onerror="this.src='https://placehold.co/400x300/b45309/fcd34d?text=Crash'">
          <div class="p-3 bg-gray-900 border-t border-gray-800">
            <h3 class="text-xs text-white font-bold pixel-font">Crash</h3>
            <p class="text-[10px] text-gray-500">To The Moon</p>
          </div>
          <div class="play-overlay"><span class="action-btn px-4 py-2 rounded text-xs font-bold text-white">FLY</span></div>
        </div>

        <!-- Plinko -->
        <div onclick="openGame('plinko')" class="game-card group">
          <img src="games/media/plinko.jpg" alt="Plinko" onerror="this.src='https://placehold.co/400x300/be185d/f9a8d4?text=Plinko'">
          <div class="p-3 bg-gray-900 border-t border-gray-800">
            <h3 class="text-xs text-white font-bold pixel-font">Plinko</h3>
            <p class="text-[10px] text-gray-500">High Volatility</p>
          </div>
          <div class="play-overlay"><span class="action-btn px-4 py-2 rounded text-xs font-bold text-white">DROP</span></div>
        </div>

        <!-- Mines -->
        <div onclick="openGame('mines')" class="game-card group">
          <img src="games/media/minas.jpg" alt="Mines" onerror="this.src='https://placehold.co/400x300/374151/9ca3af?text=Mines'">
          <div class="p-3 bg-gray-900 border-t border-gray-800">
            <h3 class="text-xs text-white font-bold pixel-font">Mines</h3>
            <p class="text-[10px] text-gray-500">Don't Explode</p>
          </div>
          <div class="play-overlay"><span class="action-btn px-4 py-2 rounded text-xs font-bold text-white">DIG</span></div>
        </div>

        <!-- Dice -->
        <div onclick="openGame('dice')" class="game-card group">
          <img src="games/media/dados.jpg" alt="Dice" onerror="this.src='https://placehold.co/400x300/1e3a8a/93c5fd?text=Dice'">
          <div class="p-3 bg-gray-900 border-t border-gray-800">
            <h3 class="text-xs text-white font-bold pixel-font">Dice</h3>
            <p class="text-[10px] text-gray-500">Roll Under</p>
          </div>
          <div class="play-overlay"><span class="action-btn px-4 py-2 rounded text-xs font-bold text-white">ROLL</span></div>
        </div>

        <!-- Keno -->
        <div onclick="openGame('keno')" class="game-card group">
          <img src="games/media/keno.jpg" alt="Keno" onerror="this.src='https://placehold.co/400x300/a855f7/111?text=Keno'">
          <div class="p-3 bg-gray-900 border-t border-gray-800">
            <h3 class="text-xs text-white font-bold pixel-font">Keno</h3>
            <p class="text-[10px] text-gray-500">Lottery</p>
          </div>
          <div class="play-overlay"><span class="action-btn px-4 py-2 rounded text-xs font-bold text-white">PICK</span></div>
        </div>

      </div>
    </section>

    <!-- NFT SHOP -->
    <section id="shop" class="space-y-6 pt-10 border-t border-gray-800">
      <div class="text-center">
        <h2 class="text-2xl text-white pixel-font mb-2">MINT & STAKE</h2>
        <p class="text-xs text-gray-400">Buy NFTs with $PBJ. Stake them to earn passive income.</p>
      </div>

      <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
        <!-- Simple Cards for NFTs -->
        <div class="glass-panel p-3 text-center"><img src="nft1.jpg" class="w-full rounded mb-2 opacity-80" onerror="this.src='https://placehold.co/150'"><h3 class="text-xs text-white">COMMON</h3><button onclick="mintNFT(0)" class="action-btn text-[10px] text-white px-4 py-1 rounded mt-2">MINT</button></div>
        <div class="glass-panel p-3 text-center"><img src="nft2.jpg" class="w-full rounded mb-2 opacity-80" onerror="this.src='https://placehold.co/150'"><h3 class="text-xs text-blue-300">UNCOMMON</h3><button onclick="mintNFT(1)" class="action-btn text-[10px] text-white px-4 py-1 rounded mt-2">MINT</button></div>
        <div class="glass-panel p-3 text-center"><img src="nft3.jpg" class="w-full rounded mb-2 opacity-80" onerror="this.src='https://placehold.co/150'"><h3 class="text-xs text-purple-300">RARE</h3><button onclick="mintNFT(2)" class="action-btn text-[10px] text-white px-4 py-1 rounded mt-2">MINT</button></div>
        <div class="glass-panel p-3 text-center"><img src="nft4.jpg" class="w-full rounded mb-2 opacity-80" onerror="this.src='https://placehold.co/150'"><h3 class="text-xs text-yellow-300">EPIC</h3><button onclick="mintNFT(3)" class="action-btn text-[10px] text-white px-4 py-1 rounded mt-2">MINT</button></div>
        <div class="glass-panel p-3 text-center"><img src="nft5.png" class="w-full rounded mb-2 opacity-80" onerror="this.src='https://placehold.co/150'"><h3 class="text-xs text-red-400">LEGEND</h3><button onclick="mintNFT(4)" class="action-btn text-[10px] text-white px-4 py-1 rounded mt-2">MINT</button></div>
      </div>
    </section>

    <!-- STAKING -->
    <section id="staking" class="grid md:grid-cols-2 gap-8">
      <div class="glass-panel p-6 border-t-4 border-t-green-500">
        <h2 class="text-lg text-white pixel-font mb-6">YOUR VAULT</h2>
        <div class="flex justify-between items-center bg-black/40 p-4 rounded-lg mb-4 border border-gray-800">
          <div><p class="text-xs text-gray-400">Staked</p><p id="total-staked" class="text-xl text-white font-mono">0 NFT</p></div>
          <div><p class="text-xs text-gray-400">Yield</p><p id="daily-yield" class="text-xl text-green-400 font-mono">0 PBJ</p></div>
        </div>
        <div class="text-center mb-6">
          <p class="text-xs text-gray-500">Rewards</p>
          <p id="pending-rewards" class="text-3xl font-mono text-green-400 animate-pulse">0.0000</p>
        </div>
        <button onclick="claimRewards()" class="w-full action-btn text-white font-bold py-3 rounded pixel-font text-xs tracking-widest">CLAIM REWARDS</button>
      </div>

      <div class="glass-panel p-6 flex flex-col">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg text-white pixel-font">INVENTORY</h2>
          <button onclick="loadUserData()" class="text-[10px] text-green-400 hover:text-white">‚Üª</button>
        </div>
        <div id="inventory-list" class="space-y-2 max-h-[300px] overflow-y-auto pr-2">
          <p class="text-xs text-gray-500 text-center mt-10">Connect wallet.</p>
        </div>
      </div>
    </section>

    <!-- TOKENOMICS & ROADMAP -->
    <section id="tokenomics" class="grid md:grid-cols-2 gap-12 pt-10 pb-10 border-t border-gray-800">
      <div class="flex flex-col items-center justify-center">
        <h2 class="text-xl text-white mb-6 pixel-font">DISTRIBUTION</h2>
        <div class="pie-chart"></div>
      </div>
      <div class="space-y-4">
        <h2 class="text-xl text-white mb-4 pixel-font">ROADMAP</h2>
        <div class="roadmap-card"><h4 class="text-green-400 text-xs font-bold">PHASE 1</h4><p class="text-[10px] text-gray-500">Launch & Presale</p></div>
        <div class="roadmap-card"><h4 class="text-blue-400 text-xs font-bold">PHASE 2</h4><p class="text-[10px] text-gray-500">Staking & Slots</p></div>
        <div class="roadmap-card"><h4 class="text-purple-400 text-xs font-bold">PHASE 3</h4><p class="text-[10px] text-gray-500">CEX Listing</p></div>
      </div>
    </section>

  </main>

  <footer class="border-t border-white/10 bg-black/80 py-8 mt-12">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <p class="text-[10px] text-gray-700 font-mono">¬© 2025 PBJ CASINO. Not financial advice.</p>
    </div>
  </footer>

  <script type="module">
    import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js";

    // --- CONFIGURACI√ìN ---
    const ADDR = {
        TOKEN: "0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5",
        PRESALE: "0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5", 
        BLACKJACK: "0xbe0b8099B707e3c0bA278583C6b5561D82E77f3E",
        INSTANT: "0xbcF9DFfcDaDeC818F7B653aF1a7Ff287F3e7011f",
        NFT: "0xDE05dAf2cbF59ce9094979d639393ADED494e920"
    };

    const ABIS = {
        TOKEN: ["function approve(address,uint)","function balanceOf(address) view returns(uint)","function allowance(address,address) view returns(uint)"],
        PRESALE: ["function buyTokens() payable"],
        BLACKJACK: ["function placeBet(uint256) external", "event GameFinished(address indexed player, bool won, uint256 payout, uint256 dealerScore, uint256 playerScore)"],
        INSTANT: [
            "function playSlots(uint256) external", "function playRoulette(uint256, uint256) external", "function playDice(uint256, uint256) external",
            "function playPlinko(uint256) external", "function playCrash(uint256, uint256) external", "function playMines(uint256, uint256) external",
            "function playKeno(uint256) external", "function playTower(uint256, uint256) external"
        ],
        NFT: ["function mint(uint256,uint) external", "function tierInfo(uint256) view returns(uint,uint,bool)", "function balanceOf(address,uint) view returns(uint)", "function getStakedBalance(address,uint) view returns(uint)", "function getPendingRewards(address) view returns(uint)", "function claim() external", "function stake(uint256,uint) external", "function unstake(uint256,uint) external", "function setApprovalForAll(address,bool) external", "function isApprovedForAll(address,address) view returns(bool)"]
    };

    let provider, signer, address;
    let contracts = {};
    let animInterval = null; // Variable para guardar la animaci√≥n

    // --- WALLET ---
    document.getElementById('connectBtn').addEventListener('click', async () => {
        if(!window.ethereum) return alert("Install Metamask");
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        address = await signer.getAddress();
        
        contracts.token = new ethers.Contract(ADDR.TOKEN, ABIS.TOKEN, signer);
        contracts.presale = new ethers.Contract(ADDR.PRESALE, ABIS.PRESALE, signer);
        contracts.blackjack = new ethers.Contract(ADDR.BLACKJACK, ABIS.BLACKJACK, signer);
        contracts.instant = new ethers.Contract(ADDR.INSTANT, ABIS.INSTANT, signer);
        contracts.nft = new ethers.Contract(ADDR.NFT, ABIS.NFT, signer);

        updateUI();
        loadUserData();
        unlockPartners();
        listenForWins();
    });

    async function updateUI() {
        document.getElementById('connectBtn').innerText = address.substring(0,6)+"...";
        const bal = await contracts.token.balanceOf(address);
        const fmt = Math.floor(parseFloat(ethers.utils.formatUnits(bal, 18)));
        document.getElementById('headerBalance').innerText = fmt.toLocaleString();
        document.getElementById('modalBalance').innerText = fmt.toLocaleString();
        document.getElementById('walletDisplay').style.display = 'flex';
    }

    // --- PARTNERS ---
    function unlockPartners() {
        document.getElementById('partner-locked').classList.add('hidden');
        document.getElementById('partner-unlocked').classList.remove('hidden');
        const url = window.location.origin + window.location.pathname;
        document.getElementById('refLinkInput').value = `${url}?ref=${address}`;
    }
    window.copyRefLink = () => {
        const t = document.getElementById("refLinkInput"); t.select();
        navigator.clipboard.writeText(t.value); alert("Link Copied!");
    };

    // --- ANIMATION ENGINE (LO NUEVO) ---
    function startAnimation(game) {
        if(animInterval) clearInterval(animInterval); // Limpiar anterior
        
        const content = document.getElementById('gameContent');
        const status = document.getElementById('gameStatus');
        status.innerText = "SPINNING...";
        status.className = "text-center mt-4 text-xs text-yellow-400 font-mono h-4 animate-pulse";

        if (game === 'slots') {
            const emojis = ['üçí','üçã','üçá','üçâ','üîî','üíé','7Ô∏è‚É£'];
            const el = document.getElementById('slotRes');
            el.classList.add('blur-anim');
            animInterval = setInterval(() => {
                el.innerText = `${emojis[Math.floor(Math.random()*7)]} ${emojis[Math.floor(Math.random()*7)]} ${emojis[Math.floor(Math.random()*7)]}`;
            }, 100);
        }
        else if (game === 'dice') {
            const el = document.getElementById('diceRes');
            el.classList.add('shaking');
            animInterval = setInterval(() => { el.innerText = Math.floor(Math.random() * 100); }, 50);
        }
        else if (game === 'crash') {
            const el = document.getElementById('crashRes');
            let val = 1.00;
            animInterval = setInterval(() => { 
                val += 0.05; 
                el.innerText = val.toFixed(2) + "x"; 
                el.style.color = "#39ff14"; // Green
            }, 100);
        }
        else if (game === 'roulette') {
            const el = document.getElementById('rouletteRes');
            const colors = ['text-red-500', 'text-white']; // Red / Black (White)
            el.classList.add('shaking');
            animInterval = setInterval(() => { 
                el.innerText = Math.floor(Math.random() * 37); 
                el.className = `text-6xl font-bold mb-2 ${colors[Math.floor(Math.random()*2)]}`;
            }, 80);
        }
    }

    function stopAnimation() {
        if(animInterval) clearInterval(animInterval);
        const els = document.querySelectorAll('.blur-anim, .shaking');
        els.forEach(e => e.classList.remove('blur-anim', 'shaking'));
    }

    // --- GAME EXECUTION ---
    window.openGame = (game) => {
        const m = document.getElementById('gameModal');
        const c = document.getElementById('gameContent');
        const t = document.getElementById('modalTitle');
        const i = document.getElementById('modalIcon');
        const btn = document.getElementById('gameActionBtn');
        const extra = document.getElementById('gameExtraControls');
        const status = document.getElementById('gameStatus');

        m.style.display = 'flex';
        extra.innerHTML = ''; 
        extra.classList.add('hidden');
        status.innerText = "READY TO PLAY";
        status.className = "text-center mt-4 text-xs text-yellow-500 font-mono h-4 uppercase tracking-wider";
        btn.onclick = () => executeGame(game);

        // UI SETUP
        if (game === 'slots') {
            t.innerText = "PEPE SLOTS"; i.innerText = "üé∞";
            c.innerHTML = `<div class="text-6xl font-mono tracking-widest" id="slotRes">üçí üçã üçá</div>`;
        } 
        else if (game === 'dice') {
            t.innerText = "DICE"; i.innerText = "üé≤";
            c.innerHTML = `<div class="text-6xl font-bold text-white" id="diceRes">50</div><div class="text-xs text-gray-500 mt-2">Under 50 to Win</div>`;
        }
        else if (game === 'blackjack') {
            t.innerText = "BLACKJACK"; i.innerText = "‚ô†Ô∏è";
            c.innerHTML = `<div class="text-center"><div id="bjDealer" class="text-gray-500 mb-2">Dealer: ?</div><div class="flex gap-2 justify-center text-4xl mb-4">üÉè üÇ†</div><div id="bjPlayer" class="text-white">You: ?</div></div>`;
        }
        else if (game === 'roulette') {
            t.innerText = "ROULETTE"; i.innerText = "üé°";
            c.innerHTML = `<div class="text-6xl font-bold mb-2" id="rouletteRes">0</div>`;
            extra.classList.remove('hidden');
            extra.innerHTML = `
                <button onclick="window.rouletteChoice=0" class="bg-red-600 text-white p-2 rounded text-xs font-bold flex-1 border border-transparent focus:border-white">RED</button>
                <button onclick="window.rouletteChoice=1" class="bg-gray-800 text-white p-2 rounded text-xs font-bold flex-1 border border-transparent focus:border-white">BLACK</button>
            `;
            window.rouletteChoice = 0; 
        }
        else if (game === 'crash') {
            t.innerText = "CRASH"; i.innerText = "üöÄ";
            c.innerHTML = `<div class="text-6xl font-bold text-green-400 font-mono" id="crashRes">1.00x</div>`;
            extra.classList.remove('hidden');
            extra.innerHTML = `<input type="number" id="crashOut" value="2.00" step="0.1" class="bg-black border border-gray-600 rounded p-2 w-24 text-center text-white outline-none" placeholder="Cashout">`;
        }
        else {
            t.innerText = game.toUpperCase(); i.innerText = "üéÆ";
            c.innerHTML = `<div class="text-4xl text-gray-500">Game Ready</div>`;
        }
    };

    window.closeGame = () => {
        document.getElementById('gameModal').style.display = 'none';
        stopAnimation();
    };

    async function executeGame(game) {
        if(!signer) return alert("Connect Wallet first!");
        const betInput = document.getElementById('gameBetInput').value;
        const bet = ethers.utils.parseUnits(betInput, 18);
        const status = document.getElementById('gameStatus');
        const btn = document.getElementById('gameActionBtn');

        btn.disabled = true; btn.innerText = "APPROVING...";
        status.innerText = "Check wallet...";

        try {
            const spender = game === 'blackjack' ? ADDR.BLACKJACK : ADDR.INSTANT;
            const allow = await contracts.token.allowance(address, spender);
            if(allow.lt(bet)) {
                const tx = await contracts.token.approve(spender, ethers.constants.MaxUint256);
                await tx.wait();
            }

            btn.innerText = "SENDING...";
            let tx;

            // ENVIAR TRANSACCION
            if (game === 'slots') tx = await contracts.instant.playSlots(bet);
            else if (game === 'blackjack') tx = await contracts.blackjack.placeBet(bet);
            else if (game === 'roulette') tx = await contracts.instant.playRoulette(bet, window.rouletteChoice || 0);
            else if (game === 'dice') tx = await contracts.instant.playDice(bet, 50); 
            else if (game === 'plinko') tx = await contracts.instant.playPlinko(bet);
            else if (game === 'mines') tx = await contracts.instant.playMines(bet, 3); 
            else if (game === 'crash') {
                const out = document.getElementById('crashOut').value;
                const mult = Math.floor(parseFloat(out) * 100);
                tx = await contracts.instant.playCrash(bet, mult);
            }
            else if (game === 'keno') tx = await contracts.instant.playKeno(bet);

            // *** AQUI EMPIEZA LA ANIMACION MIENTRAS ESPERAMOS ***
            if (game !== 'blackjack') startAnimation(game);
            
            status.innerText = "WAITING FOR BLOCKCHAIN...";
            const receipt = await tx.wait(); 
            
            // *** AQUI SE DETIENE Y MUESTRA RESULTADO ***
            stopAnimation();

            if(game !== 'blackjack') {
                // Buscar evento en logs
                // Los ABIs son strings simplificados en este ejemplo, para leer logs complejos necesitamos el ABI completo o
                // simplemente parsear los topics. Para simplificar en frontend puro sin ABI json completo:
                // Vamos a usar un "truco" de recargar UI y asumir victoria si sube el balance, o usar los listeners.
                // PERO, para que sea instantaneo visualmente, usaremos el Listener que ya tenemos configurado abajo.
                // El listener se dispara casi al mismo tiempo que tx.wait() termina.
                status.innerText = "RESULT CONFIRMED!";
            } else {
                status.innerText = "WAITING FOR DEALER...";
            }

        } catch(e) {
            console.error(e);
            stopAnimation();
            status.innerText = "ERROR: " + (e.reason || "Tx Failed");
            status.className = "text-center mt-4 text-xs text-red-500 font-mono h-4 uppercase tracking-wider";
            btn.disabled = false; btn.innerText = "PLAY";
        }
    }

    // --- LISTENERS (MUESTRAN EL RESULTADO FINAL) ---
    function listenForWins() {
        // Se usan los topics de eventos para filtrar
        // NOTA: Ethers v5 permite filtrar eventos f√°cilmente
        
        contracts.instant.on("SlotsPlayed", (p,b,pay,out) => { 
            if(p==address) showRes(pay, `SYMBOLS: ${out.join('-')}`, 'slotRes', `${emoji(out[0])} ${emoji(out[1])} ${emoji(out[2])}`); 
        });
        
        contracts.instant.on("RoulettePlayed", (p,b,pay,r,c) => { 
            if(p==address) showRes(pay, `RESULT: ${r} (${c})`, 'rouletteRes', r); 
        });
        
        contracts.instant.on("CrashPlayed", (p,b,pay,crash,target) => { 
            if(p==address) {
                const crashVal = (crash/100).toFixed(2);
                showRes(pay, `CRASHED @ ${crashVal}x`, 'crashRes', crashVal+"x");
                if(pay.eq(0)) document.getElementById('crashRes').style.color = "red";
            }
        });

        contracts.instant.on("DicePlayed", (p,b,pay,roll,pred) => { 
            if(p==address) showRes(pay, `ROLLED: ${roll}`, 'diceRes', roll); 
        });

        contracts.instant.on("PlinkoPlayed", (p,b,pay,slot) => { if(p==address) showRes(pay, `BUCKET: ${slot}`); });
        contracts.instant.on("MinesPlayed", (p,b,pay,boom) => { if(p==address) showRes(pay, boom ? "BOOM!" : "SAFE"); });
        
        contracts.blackjack.on("GameFinished", (p, won, pay, dScore, pScore) => {
            if(p == address) {
                document.getElementById('bjDealer').innerText = `Dealer: ${dScore}`;
                document.getElementById('bjPlayer').innerText = `You: ${pScore}`;
                showRes(pay, won ? "YOU WON!" : "DEALER WINS");
            }
        });
    }

    function emoji(num) {
        const map = ['üçí','üçã','üçá','üçâ','üîî','üíé','7Ô∏è‚É£','üé±','üëë','ü™ô'];
        return map[num] || num;
    }

    function showRes(payout, text, elemId = null, elemVal = null) {
        stopAnimation(); // Asegurar que para
        const btn = document.getElementById('gameActionBtn');
        const status = document.getElementById('gameStatus');
        btn.disabled = false; btn.innerText = "PLAY AGAIN";
        
        const won = payout.gt(0);
        const profit = ethers.utils.formatUnits(payout, 18);
        
        status.innerText = text + (won ? ` (+${parseFloat(profit).toFixed(0)} PBJ)` : "");
        status.className = "text-center mt-4 text-xs font-mono h-4 uppercase tracking-wider " + (won ? "text-green-400" : "text-red-500");

        if(elemId && elemVal) document.getElementById(elemId).innerText = elemVal;

        if(won) {
            confetti();
            updateUI(); 
        }
    }

    // --- NFT & STAKING (Funciones Auxiliares) ---
    window.mintNFT = async (id) => {
        if(!signer) return alert("Connect Wallet");
        try {
            const info = await contracts.nft.tierInfo(id);
            const allow = await contracts.token.allowance(address, ADDR.NFT);
            if(allow.lt(info.price)) await (await contracts.token.approve(ADDR.NFT, ethers.constants.MaxUint256)).wait();
            await (await contracts.nft.mint(id, 1)).wait();
            alert("Minted!"); loadUserData();
        } catch(e) { console.error(e); }
    };
    window.stakeNFT = async (id) => { try { await (await contracts.nft.stake(id, 1)).wait(); loadUserData(); } catch(e){} };
    window.unstakeNFT = async (id) => { try { await (await contracts.nft.unstake(id, 1)).wait(); loadUserData(); } catch(e){} };
    window.claimRewards = async () => { try { await (await contracts.nft.claim()).wait(); loadUserData(); } catch(e){} };

    window.loadUserData = async () => {
        if(!signer) return;
        const list = document.getElementById('inventory-list');
        list.innerHTML = '';
        let totalStaked = 0, dailyYield = 0;
        const tiers = ["COMMON", "UNCOMMON", "RARE", "EPIC", "LEGEND"];
        const rates = [50, 120, 350, 800, 2000];

        for(let i=0; i<5; i++) {
            const bal = await contracts.nft.balanceOf(address, i);
            const staked = await contracts.nft.getStakedBalance(address, i);
            totalStaked += parseInt(staked);
            dailyYield += parseInt(staked) * rates[i];

            if(bal > 0) list.innerHTML += `<div class="flex justify-between bg-gray-900 p-2 rounded mb-1"><span class="text-xs text-white">${tiers[i]}</span><button onclick="stakeNFT(${i})" class="text-[10px] text-green-400">STAKE</button></div>`;
            if(staked > 0) list.innerHTML += `<div class="flex justify-between bg-green-900/20 p-2 rounded mb-1"><span class="text-xs text-green-400">${tiers[i]} (Staked)</span><button onclick="unstakeNFT(${i})" class="text-[10px] text-white">UNSTAKE</button></div>`;
        }
        document.getElementById('total-staked').innerText = totalStaked + " NFT";
        document.getElementById('daily-yield').innerText = dailyYield + " PBJ/d";
        const rew = await contracts.nft.getPendingRewards(address);
        document.getElementById('pending-rewards').innerText = parseFloat(ethers.utils.formatUnits(rew, 18)).toFixed(2);
    };

    // --- PRESALE & TIMERS ---
    document.getElementById('buyInput').addEventListener('input', (e) => {
        const v = e.target.value;
        if(v) document.getElementById('receiveInput').value = (v * 1000000).toFixed(0);
    });
    document.getElementById('buyBtn').addEventListener('click', async () => {
        if(!signer) return alert("Connect");
        try { await (await contracts.presale.buyTokens({value:ethers.utils.parseEther(document.getElementById('buyInput').value)})).wait(); alert("Bought!"); updateUI(); } catch(e){}
    });

    // Timers
    let target = localStorage.getItem('pEnd');
    if(!target || new Date(target) < new Date()) { target = Date.now() + 172800000; localStorage.setItem('pEnd', target); }
    setInterval(() => {
        const d = target - Date.now();
        if(d>0) {
            document.getElementById('d').innerText = Math.floor(d/86400000);
            document.getElementById('h').innerText = Math.floor((d%86400000)/3600000);
            document.getElementById('m').innerText = Math.floor((d%3600000)/60000);
            document.getElementById('s').innerText = Math.floor((d%60000)/1000);
        }
    }, 1000);
</script>

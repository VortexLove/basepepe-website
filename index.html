<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Pepe Blackjack (PBJ) - DApp</title>
  <meta name="description" content="Presale + Blackjack + NFTs on Base. Pepe Blackjack (PBJ) token and Web3 casino." />
  <meta http-equiv="x-ua-compatible" content="IE=edge" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />

  <!-- Scripts (Removed particles library) -->
  <script defer src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script defer src="./cdn.tailwindcss.js"></script>

  <style>
    :root { color-scheme: dark; }
    html, body { margin:0; padding:0; background:#000; }
    html, body, * { font-family:'Press Start 2P', cursive !important; }
    body { -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility; }
    img { max-width:100%; height:auto; display:block; }

    /* REMOVED: Particles background */

    /* Navigation */
    .nav-wrap { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; }
    .nav-btn {
      background:#0f2b1c; color:#a9ffcf; border:2px solid #1e5a3c;
      padding:6px 10px; border-radius:8px; font-size:10px; cursor:pointer;
      box-shadow:0 0 8px #39ff1433, 2px 2px 0 #001c0d;
      transition:background .3s;
      text-decoration:none;
      position:relative;
      overflow:hidden;
    }
    .nav-btn::after{
      content:""; position:absolute; inset:0;
      background:radial-gradient(circle at 30% 20%,#39ff1411,transparent 60%);
      opacity:0;
    }
    /* Removed hover transform (zoom / acercar) */
    .nav-btn:hover { background:#143e2a; }
    .nav-btn.active {
      background:#39ff14; color:#042414; border-color:#0d4d31;
      box-shadow:0 0 16px #39ff1499, 2px 2px 0 #042414;
    }

    /* Panels */
    .pixel-panel, .content-panel {
      position:relative; background:#0a1114; border-radius:20px;
      padding:28px 24px; box-shadow:0 0 0 3px #0d1e15 inset, 0 14px 30px rgba(0,0,0,.6), 0 0 42px #39ff1428;
      border:3px solid #123b27;
      backdrop-filter:blur(6px);
    }
    .pixel-panel::before, .content-panel::before {
      content:""; position:absolute; inset:-3px; border-radius:22px; z-index:-1;
      background:conic-gradient(from 0deg,#39ff14,#00ffa5,#39ff14);
      filter:blur(18px); opacity:.18;
    }

    .section-title {
      margin-top:0; margin-bottom:18px; font-size:20px;
      color:#39ff14; text-shadow:0 0 6px #39ff14;
      display:flex; align-items:center; gap:10px; justify-content:flex-start;
      position:relative;
    }
    .section-title .neon-underline {
      position:absolute; left:0; bottom:-6px; height:2px; width:140px;
      background:linear-gradient(90deg,transparent,#39ff14,transparent);
      filter:drop-shadow(0 0 6px #39ff14);
    }
    .content-panel p, .content-panel li { font-size:12px; line-height:1.55; }

    /* Hero (Buy + Timers + Promo Image) */
    .hero-grid {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:32px;
    }
    @media (max-width:900px){
      .hero-grid { grid-template-columns:1fr; }
    }
    .hero-subpanels {
      display:flex;
      flex-direction:column;
      gap:18px;
    }

    .hero-promo {
      background:#071610;
      border:2px solid #164a33;
      border-radius:16px;
      padding:12px;
      box-shadow:0 0 0 3px #0d1e15 inset, 0 0 22px #39ff1426;
    }
    .hero-promo img {
      width:100%; height:auto; border-radius:12px; border:2px solid #1e5a3c;
      box-shadow:inset 0 0 16px #0c2d20, 0 10px 30px #000000aa, 0 0 24px #39ff1422;
    }

    .mini-box {
      background:#091a15;
      border:2px solid #164a33;
      border-radius:16px;
      padding:18px 20px;
      box-shadow:0 0 0 3px #0d1e15 inset, 0 0 18px #39ff1433;
      position:relative;
      overflow:hidden;
    }
    .progress-rail {
      width:100%; height:14px; background:#2c3840; border-radius:10px; overflow:hidden;
      box-shadow:inset 0 0 4px #000;
      position:relative;
    }
    .progress-bar {
      height:100%; width:0%; background:linear-gradient(90deg,#39ff14,#00ffa5);
      box-shadow:0 0 6px #39ff14;
      transition:width .6s ease;
      position:relative;
    }
    .progress-bar::after {
      content:""; position:absolute; top:0; bottom:0; width:80px;
      background:linear-gradient(90deg,transparent,#ffffff33 60%,transparent);
    }
    .countdown-text {
      font-size:20px; color:#39ff14; text-align:center; margin-top:10px;
      text-shadow:0 0 6px #39ff14;
    }

    .collected-text {
      font-size:20px; color:#60a5ff; text-align:center; margin-top:10px;
      text-shadow:0 0 6px #60a5ff;
    }

    .vote-emojis button {
      background:none; border:none; cursor:pointer; font-size:26px;
      filter:drop-shadow(0 0 3px #39ff14);
      transition:filter .2s;
    }
    .vote-emojis button:hover { filter:brightness(1.3); }

    /* Tokenomics bars + legend */
    .tokenomics-bar {
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 16px; border-radius:10px; color:#000; font-weight:700; text-transform:uppercase;
      box-shadow:3px 3px 0 #00000066; border:3px solid #111;
    }
    .tokenomics-bar .pct { background:#000; color:#fff; padding:4px 8px; border-radius:6px; font-size:12px; }
    .bar-purple{background:#B69CFF;} .bar-green{background:#39FF14;} .bar-blue{background:#76C7FF;}
    .bar-orange{background:#FFA726;} .bar-yellow{background:#FCD34D;}

    .pizza-box { position:relative; }
    .pizza-lid {
      background:#f0c27b; border:4px solid #7a4e1b; border-bottom:0; padding:10px;
      border-top-left-radius:6px; border-top-right-radius:6px; text-shadow:1px 1px 0 #00000033;
    }
    .pizza-base {
      background:#e2b47a; border:4px solid #7a4e1b; border-top:0; padding:18px;
      border-bottom-left-radius:6px; border-bottom-right-radius:6px; display:flex; justify-content:center;
    }
    .pizza-chart {
      width:260px; height:260px; max-width:80vw; max-height:80vw; border-radius:50%; position:relative;
      box-shadow:inset 0 0 0 8px #7a4e1b, 2px 2px 0 #00000055;
    }
    .pizza-chart::after {
      content:""; position:absolute; inset:20%; background:#d9a36a; border-radius:50%; box-shadow:inset 0 0 0 4px #7a4e1b;
    }
    .legend-item {
      display:flex; align-items:center; gap:10px; background:#111827; border:1px solid #1f2937; padding:8px 10px; border-radius:8px;
      font-size:11px;
    }
    .legend-dot { width:14px; height:14px; border-radius:3px; box-shadow:1px 1px 0 #00000055; }

    /* NFT cards */
    .nft-section {
      display:flex; justify-content:center; gap:24px; flex-wrap:nowrap; overflow-x:auto;
      padding:20px; max-width:100%; scroll-snap-type:x mandatory;
    }
    .nft-card { flex:0 0 260px; padding:14px; border-radius:10px; background:transparent; display:flex; flex-direction:column; align-items:center; scroll-snap-align:start; }
    .pixel-frame {
      position:relative; width:100%; padding:14px; background:#0b0f12;
      border:3px solid #0f2b1c;
      box-shadow:0 0 0 3px #0c1e14 inset, 0 0 22px #39ff1499, 4px 4px 0 #001c0d;
      border-radius:10px;
    }
    .nft-badge {
      display:inline-flex; align-items:center; gap:8px;
      background:#072818; border:2px solid #1e5a3c; color:#a9ffcf; padding:6px 8px; border-radius:8px; font-size:12px; margin-bottom:10px;
      box-shadow:0 0 8px #39ff1433;
    }
    .nft-card h2, .nft-card p { color:#22c55e; font-size:16px; text-align:center; }
    .nft-card p { font-size:13px; color:#b8ffda; }
    .nft-card img {
      width:100%; max-width:220px; margin:10px auto 16px; image-rendering:pixelated;
      border-radius:8px; border:2px solid #173d2b; background:#04130c;
      box-shadow:inset 0 0 20px #093b25, 0 10px 20px rgba(0,0,0,.6);
    }
    .pixel-button {
      background:#00FF00; border:2px solid #003300; color:#000; font-size:11px; padding:10px 14px; cursor:pointer;
      box-shadow:2px 2px 0 #003300; width:100%;
      transition:filter .3s;
    }
    .pixel-button:hover { filter:brightness(1.15); }
    @media (max-width:500px){
      .nft-section{gap:12px;padding:12px;}
      .nft-card{flex:0 0 200px;padding:6px;}
      .nft-card img{max-width:180px;}
    }

    /* Price overlay added */
    .price-overlay {
      position:absolute;
      top:8px;
      right:8px;
      background:#39ff14;
      color:#052515;
      font-size:11px;
      padding:4px 6px;
      border:2px solid #0e3e28;
      border-radius:6px;
      box-shadow:0 0 6px #39ff1499;
      z-index:5;
    }

    /* Staking lists */
    #userNFTs, #stakedNFTs, #userNFTsStake { scroll-snap-type:x mandatory; }
    #userNFTs > div, #stakedNFTs > div, #userNFTsStake > div {
      scroll-snap-align:start; flex:0 0 220px; background:#111; border:2px solid #22c55e; border-radius:12px; padding:12px;
      text-align:center; color:#a6f4a6; box-shadow:0 0 8px #22c55e88; font-size:11px;
    }

    #userNFTs button, #stakedNFTs button, #userNFTsStake button {
      margin-top:10px; background-color:#00ff00; color:#000; font-size:10px; padding:6px 10px; border:2px solid #003300; cursor:pointer;
      box-shadow:2px 2px 0 #003300; border-radius:4px;
    }

    /* Blackjack reused styles */
    .card {
      position:relative; width:90px; height:130px; background:#fff; border:3px solid #111; border-radius:10px;
      box-shadow:0 6px 10px rgba(0,0,0,.55), inset 0 0 0 2px #eee;
      display:flex; align-items:center; justify-content:center;
      font-size:1.9rem; font-weight:700;
    }
    .card .corner { position:absolute; font-size:.75rem; line-height:1; font-weight:700; }
    .card .top-left { top:6px; left:6px; }
    .card .bottom-right { bottom:6px; right:6px; transform:rotate(180deg); }
    .red { color:#d60000; } .black { color:#111; }
    @media (min-width:640px){ .card { width:110px; height:155px; font-size:2.3rem; } }

    .blackjack-wrapper {
      background:radial-gradient(circle at 50% 35%, #0f3d26 0%, #062014 55%, #02120b 100%);
      border:4px solid #0a4d31; border-radius:24px; padding:18px 14px 26px;
      box-shadow:0 10px 30px rgba(0,0,0,.7), 0 0 0 3px #113d28, inset 0 0 30px #0c5134;
      position:relative; overflow:hidden;
    }
    .blackjack-wrapper::before {
      content:"PBJ BLACKJACK"; position:absolute; top:8px; left:50%; transform:translateX(-50%);
      font-size:.65rem; letter-spacing:3px; color:#39ff14cc; text-shadow:0 0 6px #39ff14, 0 0 14px #39ff1480;
      pointer-events:none;
    }

    .hand-row { display:flex; justify-content:center; align-items:flex-end; gap:8px; flex-wrap:nowrap; overflow-x:auto; padding:8px 4px; min-height:142px; }
    .score-badge {
      background:#072818; border:2px solid #39ff14; color:#39ff14; padding:6px 10px; border-radius:12px; font-size:.65rem;
      display:inline-flex; align-items:center; gap:6px; box-shadow:0 0 8px #39ff14;
    }
    .score-badge .chip { width:18px; height:18px; background:conic-gradient(#39ff14,#072818,#39ff14); border:2px solid #39ff14; border-radius:50%; box-shadow:0 0 4px #39ff1480; }
    .divider-line { height:2px; background:linear-gradient(90deg,#39ff1400,#39ff14 35%,#39ff14 65%,#39ff1400); margin:12px 0; filter:drop-shadow(0 0 6px #39ff14); }

    .bet-panel {
      display:flex; flex-direction:column; gap:6px; background:#0a2f1e; border:3px solid #124c31; padding:12px; border-radius:14px;
      box-shadow:0 4px 12px #00000080, inset 0 0 12px #0f5135;
    }
    .bet-panel label { font-size:.7rem; color:#a3ffce; }
    .bet-panel input {
      background:#143e2a; border:2px solid #206246; color:#e8ffe8; padding:6px 8px; border-radius:8px; font-size:.8rem; width:100%;
      transition:border-color .2s, box-shadow .2s;
    }
    .bet-panel input:focus { outline:none; border-color:#39ff14; box-shadow:0 0 0 2px #39ff1420; }
    .bet-status { font-size:.65rem; min-height:1.2em; color:#39ff14; }
    .bet-status.error { color:#ff5151; }

    .btn-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(110px,1fr)); gap:8px; margin-top:10px; }
    .bj-btn {
      background:linear-gradient(180deg,#1c7f55,#14573b); border:2px solid #39ff14; color:#eafff1; padding:10px 8px; font-size:.75rem; border-radius:12px;
      cursor:pointer; position:relative; overflow:hidden; transition:background .25s;
    }
    .bj-btn:hover:not([disabled]) { background:#1fa562; }
    .bj-btn:disabled { opacity:.45; cursor:not-allowed; }
    .bj-btn.secondary { background:linear-gradient(180deg,#173d2b,#0b2317); border-color:#206246; color:#9dddbd; }
    .bj-btn.secondary:hover:not([disabled]) { background:#20573b; }
    .bj-btn.cancel { background:linear-gradient(180deg,#5d1313,#3b0b0b); border-color:#ff5858; color:#ffe5e5; }
    .bj-btn.cancel:hover:not([disabled]) { background:#7a1e1e; }

    .result-banner { margin-top:14px; background:#072818; border:2px solid #206246; padding:10px 14px; border-radius:14px;
      font-size:.8rem; color:#e8ffe8; text-align:center; min-height:52px; }
    .result-banner.win { border-color:#39ff14; box-shadow:0 0 10px #39ff14; color:#39ff14; }
    .result-banner.lose { border-color:#ff5151; box-shadow:0 0 10px #ff5151; color:#ff9090; }
    .result-banner.push { border-color:#00aaff; box-shadow:0 0 10px #00aaff; color:#7fd7ff; }

    /* Buy panel extras */
    .panel-sub { display:flex; justify-content:space-between; font-size:.7rem; color:#a8ffcf; margin-bottom:8px; }
    .rate-badge {
      display:inline-flex; gap:6px; align-items:center; background:#072818; border:2px solid #1e5a3c; color:#a9ffcf; padding:6px 8px; border-radius:8px; font-size:.7rem;
    }
    .quick-row { display:flex; flex-wrap:wrap; gap:8px; margin:10px 0 6px; }
    .quick-chip {
      background:#0f2b1c; color:#a8ffcf; border:2px solid #1e5a3c; padding:6px 8px; border-radius:8px; font-size:.7rem; cursor:pointer;
      box-shadow:0 0 8px #39ff1433; transition:background .2s;
    }
    .quick-chip:hover { background:#143e2a; }
    .max-btn {
      margin-left:auto; background:#39ff14; color:#07140e; border:2px solid #0e3e28; padding:6px 10px; border-radius:8px; font-size:.7rem; cursor:pointer; box-shadow:2px 2px 0 #003300;
    }
    .max-btn:hover { background:#4dff32; }

    .cta-btn {
      width:100%; padding:14px 12px; border-radius:14px;
      background:linear-gradient(180deg,#2aff5a,#1aa746);
      color:#03130b; border:2px solid #103e29; font-weight:700; letter-spacing:1px;
      box-shadow:0 8px 0 #0a3a24, 0 0 18px #39ff1499; cursor:pointer; transition:background .25s;
    }
    .cta-btn:hover { background:linear-gradient(180deg,#47ff72,#24c35a); }
    .cta-btn:disabled { filter:grayscale(.6); opacity:.55; cursor:not-allowed; }

    .mini-note { font-size:.65rem; color:#b8ffda; opacity:.9; text-align:center; margin-top:6px; }
    .mini-sep { height:2px; margin:12px 0; background:linear-gradient(90deg,transparent,#39ff14,transparent); filter:drop-shadow(0 0 4px #39ff14); }

    /* Footer */
    footer.site-footer {
      margin-top:60px; padding:30px 20px; background:#050b0d;
      border-top:3px solid #123b27; position:relative;
      box-shadow:0 -4px 20px #000000aa, 0 0 30px #39ff1411;
    }
    footer.site-footer::before {
      content:""; position:absolute; inset:0;
      background:
        radial-gradient(circle at 10% 80%, #39ff1415, transparent 60%),
        radial-gradient(circle at 90% 20%, #39ff1415, transparent 55%);
      pointer-events:none;
    }
    .footer-grid { display:grid; gap:24px; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); }
    .footer-col h3 { font-size:14px; margin:0 0 10px; color:#39ff14; text-shadow:0 0 6px #39ff14; }
    .footer-col p, .footer-col a, .footer-col li { font-size:10px; color:#c9ffe4; text-decoration:none; line-height:1.5; }
    .disclaimer-box {
      background:#091712; border:2px solid #123b27; padding:14px 16px; border-radius:12px; font-size:9px;
      color:#9ef7c7; box-shadow:0 0 12px #39ff1422, inset 0 0 14px #0f2b1c;
    }
    .social-links a {
      display:inline-block; margin-right:8px; margin-bottom:6px; background:#0f2b1c; padding:6px 10px;
      border:2px solid #1e5a3c; border-radius:8px; font-size:9px; color:#a9ffcf;
      box-shadow:0 0 8px #39ff1433; transition:background .2s;
    }
    .social-links a:hover { background:#143e2a; }
    .copyright { margin-top:28px; font-size:9px; text-align:center; color:#68ffb3; opacity:.8; }

    /* Utility classes */
    .fade-reveal { opacity:1; transform:none; }

    .defer-section { content-visibility:auto; contain-intrinsic-size:800px 600px; }

    /* Typewriter */
    .typewriter { display:inline-block; white-space:nowrap; overflow:hidden; }

    /* Roadmap enhancements */
    .timeline-year {
      display:flex; align-items:center; gap:10px; margin:8px 0 6px; color:#9dfcc8; font-size:12px;
      text-shadow:0 0 6px #39ff1499;
    }
    .timeline-year .bar {
      height:2px; flex:1; background:linear-gradient(90deg,#39ff1400,#39ff14,#39ff1400);
      filter:drop-shadow(0 0 6px #39ff14);
    }
    .pixel-timeline { position:relative; padding-left:26px; }
    .pixel-timeline::before {
      content:""; position:absolute; left:8px; top:0; bottom:0; width:4px;
      background:linear-gradient(#07331f,#39ff14,#07331f);
      box-shadow:0 0 8px #39ff14aa; border-radius:4px;
    }
    .milestone {
      position:relative; margin:14px 0; padding:12px 12px 12px 14px;
      border:2px solid #1e5a3c; border-radius:12px; background:#0a1512;
      box-shadow:0 0 10px #39ff1422, inset 0 0 14px #0f2b1c;
    }
    .milestone::before {
      content:""; position:absolute; left:-19px; top:14px; width:14px; height:14px; border-radius:4px;
      background:#39ff14; border:2px solid #0f2b1c; box-shadow:0 0 10px #39ff14cc;
    }
    .milestone-title { color:#a9ffcf; font-size:12px; margin:0 0 6px; display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
    .quarter-badge {
      font-size:10px; color:#052515; background:#39ff14; border:2px solid #0e3e28; border-radius:999px; padding:2px 8px;
      text-transform:uppercase; letter-spacing:.5px; box-shadow:0 0 8px #39ff1480;
    }
    .milestone-desc { color:#d7ffe9; font-size:11px; margin:0; line-height:1.6; }
  </style>
</head>
<body class="bg-gray-950 text-white min-h-screen">

  <div class="max-w-6xl mx-auto p-4 space-y-12">

    <!-- HEADER -->
    <header class="flex flex-col gap-4 py-4 border-b border-gray-800 fade-reveal" id="top">
      <div class="flex flex-col md:flex-row justify-between items-center gap:3 md:gap-3">
        <h1 class="text-2xl sm:text-3xl font-bold text-green-400">Pepe Blackjack (PBJ)</h1>
        <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
          <button id="connectButton" class="nav-btn" style="font-size:11px;">Connect</button>
          <button id="wcButton" class="nav-btn" style="font-size:11px;" title="WalletConnect">WalletConnect</button>
        </div>
        <div id="pbjDisplay" style="display:none;align-items:center;gap:8px;font-size:14px;color:#39ff14;padding:6px 14px;border:2px solid #1e5a3c;border-radius:12px;background:#072818;box-shadow:0 0 8px #39ff1433;">
          <img src="./Coin.avif" alt="PBJ Coin" width="40" height="40" loading="lazy" decoding="async" style="image-rendering:pixelated;border-radius:50%;border:2px solid #1d5a3b;">
          <span id="pbjBalanceHeader">0</span> PBJ
        </div>
      </div>
      <nav class="nav-wrap">
        <a href="#presale" class="nav-btn">Presale</a>
        <a href="#nfts" class="nav-btn">NFTs</a>
        <a href="#staking" class="nav-btn">Staking</a>
        <a href="#blackjack" class="nav-btn">Blackjack</a>
        <a href="#lore" class="nav-btn">Lore</a>
        <a href="#roadmap" class="nav-btn">Roadmap</a>
        <a href="#tokenomics" class="nav-btn">Tokenomics</a>
        <a href="#team" class="nav-btn">Team</a>
        <a href="#faq" class="nav-btn">FAQ</a>
      </nav>
    </header>

    <div id="status" class="text-center text-base sm:text-lg fade-reveal" aria-live="polite"></div>

    <!-- HERO: PRESALE + BUY -->
    <section id="presale" class="content-panel hero-grid fade-reveal">
      <!-- BUY PANEL -->
      <div class="pixel-panel" style="padding:24px;">
        <div class="panel-header" style="margin-bottom:14px; display:flex; align-items:center; gap:10px;">
          <img src="./Coin.avif" alt="PBJ Coin" class="coin" width="40" height="40" />
          <h2 style="color:#39ff14;font-size:18px;letter-spacing:1px;">Buy $PBJ (Presale)</h2>
        </div>

        <!-- Internal countdown + progress -->
        <div class="mini-box" id="heroCountdownBox">
          <div class="progress-rail">
            <div id="presale-progress" class="progress-bar"></div>
          </div>
            <div class="countdown-text" id="presale-countdown">Loading...</div>
          <div style="font-size:10px;color:#b1c9c0;text-align:center;margin-top:6px;">Presale time left (7 days)</div>
        </div>

        <div class="mini-box">
          <div class="progress-rail">
            <div id="eth-collected-progress" class="progress-bar" style="background:linear-gradient(90deg,#60a5ff,#2563eb);"></div>
          </div>
          <div class="collected-text" id="eth-collected-count">2 ETH collected of 20</div>
          <div style="font-size:10px;color:#b1c9c0;text-align:center;margin-top:6px;">Goal: 20 ETH</div>
        </div>

        <div class="mini-box">
          <div style="font-size:14px;color:#e8fdf2;margin-bottom:10px;line-height:1.4;">What do you think about the presale?</div>
          <div class="vote-emojis" style="display:flex;gap:22px;justify-content:center;">
            <button class="emoji-vote-btn" data-emoji="üëç" aria-label="Vote üëç">üëç</button>
            <button class="emoji-vote-btn" data-emoji="üî•" aria-label="Vote üî•">üî•</button>
            <button class="emoji-vote-btn" data-emoji="ü§©" aria-label="Vote ü§©">ü§©</button>
            <button class="emoji-vote-btn" data-emoji="üíé" aria-label="Vote üíé">üíé</button>
            <button class="emoji-vote-btn" data-emoji="üòÇ" aria-label="Vote üòÇ">üòÇ</button>
          </div>
          <div id="vote-results" style="display:flex;gap:16px;justify-content:center;margin-top:14px;font-size:16px;color:#39ff14;"></div>
        </div>

        <!-- Rate / Balance -->
        <div class="panel-sub">
          <span>ETH Balance</span>
          <span id="ethBalance" class="font-mono text-white">0.0000 ETH</span>
        </div>
        <div class="rate-badge mb-2">
          <span>Rate</span>
          <span class="text-green-400 font-bold">1 ETH = 1,000,000 PBJ</span>
        </div>

        <!-- Quick Chips -->
        <div class="quick-row">
          <button class="quick-chip" data-eth="0.01">0.01</button>
          <button class="quick-chip" data-eth="0.05">0.05</button>
          <button class="quick-chip" data-eth="0.1">0.1</button>
          <button class="quick-chip" data-eth="0.25">0.25</button>
            <button class="quick-chip" data-eth="0.5">0.5</button>
          <button id="maxEthBtn" class="max-btn">MAX</button>
        </div>

        <!-- Form -->
        <div class="space-y-4 mb-4 form-presale">
          <div class="flex items-center space-x-2">
            <input type="number" id="ethAmount" min="0.01" step="0.0001" value="0.01"
              class="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-3 py-3 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-400 text-sm"
              placeholder="0.0 ETH" />
            <span class="text-gray-300 font-medium text-sm">ETH</span>
          </div>
          <div class="flex justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </div>
          <div class="flex items-center space-x-2">
            <input type="number" id="pbjAmount" min="10000" step="10000" value="10000"
              class="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-3 py-3 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-400 text-sm"
              placeholder="0 PBJ" />
            <span class="text-gray-300 font-medium text-sm">PBJ</span>
          </div>
        </div>

        <button id="buyButton" disabled class="cta-btn">Buy</button>
        <div class="mini-sep"></div>
        <div class="mini-note">Connect wallet to enable purchase ‚Ä¢ Base Network</div>
      </div>

      <!-- Right column panels -->
      <div class="hero-subpanels">
        <div class="hero-promo">
          <img src="./preventa.avif" alt="PBJ Presale Poster" width="896" height="448" decoding="async" loading="lazy" />
        </div>

        <div class="pixel-panel fade-reveal">
          <h3 style="color:#39ff14;font-size:14px;margin:0 0 12px;">Why Base?</h3>
          <p style="font-size:11px;color:#b8ffda;line-height:1.6;">
            Ultra-low fees, rapid finality and an expanding ecosystem let PBJ scale a multi‚Äëgame crypto casino.
            Your tokens fuel gameplay, NFTs amplify rewards and cross‚Äëgame jackpots keep the adrenaline high.
          </p>
        </div>
        <div class="pixel-panel fade-reveal">
          <h3 style="color:#39ff14;font-size:14px;margin:0 0 12px;">Presale Mechanics</h3>
          <ul style="font-size:11px;color:#c2ffe5;list-style:none;padding:0;margin:0;line-height:1.6;">
            <li>‚Ä¢ Fixed rate: 1 ETH = 1,000,000 PBJ</li>
            <li>‚Ä¢ Duration: 7 days countdown</li>
            <li>‚Ä¢ Goal: 20 ETH target raise</li>
            <li>‚Ä¢ Post-presale: DEX listing + staking</li>
          </ul>
        </div>
        <div class="pixel-panel fade-reveal">
          <h3 style="color:#39ff14;font-size:14px;margin:0 0 12px;">Vote Sentiment</h3>
          <p style="font-size:11px;color:#b8ffda;">Help signal hype by reacting above. Purely social, no on-chain cost.</p>
        </div>
      </div>
    </section>

    <!-- NFTs -->
    <section id="nfts" class="content-panel fade-reveal">
      <h2 class="section-title">üé¥ PepeBlackjack NFTs <span class="neon-underline" aria-hidden="true"></span></h2>
      <div class="nft-section defer-section">
        <div class="nft-card">
          <div class="pixel-frame">
            <div class="price-overlay">5,000 PBJ</div>
            <div class="nft-badge">üü¢ Common ‚Ä¢ 5,000 PBJ</div>
            <img src="nft1.avif" alt="Common NFT" width="250" height="250" loading="lazy" decoding="async">
            <h2>üü¢ Common</h2>
            <p>Reward: 200 PBJ / day</p>
            <button class="pixel-button mt-3" onclick="buyNFT(0)">Buy üü¢ Common</button>
          </div>
        </div>
        <div class="nft-card">
          <div class="pixel-frame">
            <div class="price-overlay">10,000 PBJ</div>
            <div class="nft-badge">üîµ Rare ‚Ä¢ 10,000 PBJ</div>
            <img src="nft2.avif" alt="Rare NFT" width="250" height="250" loading="lazy" decoding="async">
            <h2>üîµ Rare</h2>
            <p>Reward: 500 PBJ / day</p>
            <button class="pixel-button mt-3" onclick="buyNFT(1)">Buy üîµ Rare</button>
          </div>
        </div>
        <div class="nft-card">
          <div class="pixel-frame">
            <div class="price-overlay">25,000 PBJ</div>
            <div class="nft-badge">üü£ Legendary ‚Ä¢ 25,000 PBJ</div>
            <img src="nft3.avif" alt="Legendary NFT" width="250" height="250" loading="lazy" decoding="async">
            <h2>üü£ Legendary</h2>
            <p>Reward: 1,500 PBJ / day</p>
            <button class="pixel-button mt-3" onclick="buyNFT(2)">Buy üü£ Legendary</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Your NFTs -->
    <section id="nftSection" class="content-panel defer-section fade-reveal" style="text-align:center;">
      <h2 class="section-title">üßæ Your NFTs <span class="neon-underline" aria-hidden="true"></span></h2>
      <div id="userNFTs" style="display:flex;flex-wrap:wrap;justify-content:center;gap:20px;padding:20px;"></div>
    </section>

    <!-- Staking -->
    <section id="staking" class="content-panel defer-section fade-reveal">
      <h2 class="section-title">ü™ô NFT Staking <span class="neon-underline" aria-hidden="true"></span></h2>
      <div>
        <h3 class="text-green-400 font-semibold mb-2" style="font-size:12px;">Your NFTs available</h3>
        <div id="userNFTsStake" class="flex gap-6 overflow-x-auto py-2"></div>
      </div>
      <div class="mt-8">
        <h3 class="text-green-400 font-semibold mb-2" style="font-size:12px;">Your staked NFTs</h3>
        <div id="stakedNFTs" class="flex gap-6 overflow-x-auto py-2"></div>
      </div>
    </section>

    <!-- Blackjack -->
    <section id="blackjack" class="content-panel defer-section fade-reveal">
      <h2 class="section-title">üÉè PBJ Blackjack (On-Chain) <span class="neon-underline" aria-hidden="true"></span></h2>
      <div class="blackjack-wrapper">
        <div class="bet-panel">
          <label for="betAmountPBJ">Bet (PBJ tokens):</label>
          <input id="betAmountPBJ" type="number" min="10" step="10" value="1000" placeholder="PBJ amount" />
          <div class="bet-status" id="betStatus"></div>
          <div class="score-badge" id="pbjBalanceGameWrap">
            <span class="chip"></span>
            Balance: <span id="pbjBalanceGame">0</span> PBJ
          </div>
        </div>
        <div class="divider-line"></div>
        <div class="flex items-center justify-between mb-2 px-2">
          <div class="score-badge">Dealer <span id="dealerScore">0</span></div>
          <div class="score-badge" style="background:#091d13;border-color:#206246;color:#9fdcb8;">State: <span id="gameState">Idle</span></div>
        </div>
        <div id="dealerArea" class="hand-row" aria-label="Dealer cards"></div>
        <div class="divider-line"></div>
        <div class="flex items-center justify-between mb-2 px-2">
          <div class="score-badge">Player <span id="playerScore">0</span></div>
          <div class="score-badge" style="background:#072818;">Active Bet: <span id="activeBetDisplay">0</span> PBJ</div>
        </div>
        <div id="playerArea" class="hand-row" aria-label="Player cards"></div>
        <div class="btn-grid">
          <button id="dealBtn" class="bj-btn">DEAL</button>
          <button id="hitBtn" class="bj-btn secondary" disabled>HIT</button>
          <button id="standBtn" class="bj-btn secondary" disabled>STAND</button>
          <button id="doubleBtn" class="bj-btn secondary" disabled>DOUBLE</button>
          <button id="cancelBtn" class="bj-btn cancel" disabled>CANCEL BET</button>
        </div>
        <div id="resultMsg" class="result-banner"></div>
      </div>
    </section>

    <!-- Lore -->
    <section id="lore" class="content-panel defer-section flex flex-col md:flex-row items-center gap-6 scanline fade-reveal">
      <div class="w-full md:w-1/3">
        <img src="./carta.avif" alt="PBJ Card Art" class="w-full h-auto rounded-lg border-2 border-green-800 shadow-inner" loading="lazy" decoding="async" width="800" height="600" />
      </div>
      <div class="w-full md:w-2/3">
        <h2 class="section-title">üìñ Lore <span class="neon-underline" aria-hidden="true"></span></h2>
        <p class="text-gray-300 leading-relaxed" id="loreIntro">
          In the cyber casino of the Base network, Pepe deals cards with a clear objective:
          become the best crypto casino on Base... and ultimately the best globally.
        </p>
        <p class="text-gray-300 leading-relaxed" id="loreBody" style="margin-top:10px;">
          PBJ fuses meme energy, responsible gaming and high-performance tech. Base provides low fees and fast
          finality for agile, fair, community-centric gameplay: blackjack, slots, dice, crash, plinko, roulette,
          poker and more incoming. NFTs amplify yields while cross‚Äëgame jackpots ignite action.
        </p>
        <p class="text-green-400 leading-relaxed" style="margin-top:12px;">
          Vision: <span id="loreType" class="typewriter" aria-live="polite"></span>
        </p>
      </div>
    </section>

    <!-- Roadmap -->
    <section id="roadmap" class="content-panel defer-section fade-reveal">
      <h2 class="section-title">üó∫Ô∏è Roadmap <span class="neon-underline" aria-hidden="true"></span></h2>
      <div class="flex flex-col md:flex-row items-start gap-6">
        <div class="w-full md:w-1/3">
          <img src="./logo.avif" alt="PBJ Logo" class="w-full h-auto rounded-lg border-2 border-green-800 shadow-inner" loading="lazy" decoding="async" width="512" height="512" />
        </div>
        <div class="w-full md:w-2/3">
          <div class="timeline-year"><span>2025</span><span class="bar"></span></div>
          <div class="pixel-timeline">
            <div class="milestone">
              <div class="milestone-title"><span class="quarter-badge">Q2 2025</span> üöÄ Base Launch</div>
              <p class="milestone-desc">PBJ presale, contract deployment, Blackjack MVP, security focus & initial audits.</p>
            </div>
            <div class="milestone">
              <div class="milestone-title"><span class="quarter-badge">Q3 2025</span> üß™ On-Chain Economies</div>
              <p class="milestone-desc">DEX listing, PBJ staking, utility NFTs, rakeback, leaderboards & weekly challenges.</p>
            </div>
            <div class="milestone">
              <div class="milestone-title"><span class="quarter-badge">Q4 2025</span> üé∞ Base Arcade</div>
              <p class="milestone-desc">Crash, Dice, Plinko, Slots & Roulette. Provably-fair engine, mobile PWA & gamer profiles.</p>
            </div>
          </div>

          <div class="timeline-year" style="margin-top:18px;"><span>2026</span><span class="bar"></span></div>
          <div class="pixel-timeline">
            <div class="milestone">
              <div class="milestone-title"><span class="quarter-badge">Q1 2026</span> üèÜ Global Jackpots</div>
              <p class="milestone-desc">Cross‚Äëgame jackpots, missions, NFT achievements, affiliate program & multilingual rollout.</p>
            </div>
            <div class="milestone">
              <div class="milestone-title"><span class="quarter-badge">Q2 2026</span> üåé Path to #1</div>
              <p class="milestone-desc">Alliances, international tournaments, regional compliance expansion & brand dominance.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Tokenomics -->
    <section id="tokenomics" class="content-panel defer-section flex flex-col md:flex-row items-start gap-8 fade-reveal">
      <div class="w-full md:w-1/2">
        <h2 class="section-title">üìä Tokenomics <span class="neon-underline" aria-hidden="true"></span></h2>
        <div id="tokenomics-bars" class="space-y-3"></div>
        <div class="mt-6 bg-gray-800 rounded-lg p-4 text-xs space-y-1 border border-green-900">
          <div><span class="text-green-400">Symbol:</span> PBJ</div>
          <div><span class="text-green-400">Network:</span> Base</div>
          <div><span class="text-green-400">Total Supply:</span> 1,000,000,000 PBJ</div>
          <div><span class="text-green-400">Presale Price:</span> 1 ETH = 1,000,000 PBJ</div>
          <div><span class="text-green-400">Contract:</span>
            <a href="https://basescan.org/address/0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5" class="text-blue-400 underline" target="_blank" rel="noopener">0xff4b4f2076F3...06B944E5</a>
          </div>
        </div>
      </div>
      <div class="w-full md:w-1/2 flex flex-col items-center gap-4">
        <div class="pizza-box w-full max-w-xs sm:max-w-sm">
          <div class="pizza-lid text-center">
            <div class="font-bold text-yellow-300 text-lg">$PBJ UTILITY</div>
          </div>
          <div class="pizza-base">
            <div class="pizza-chart" id="pizzaChart"></div>
          </div>
        </div>
        <div id="tokenomics-legend" class="grid grid-cols-1 gap-2 w-full"></div>
        <ul class="bg-gray-800 w-full rounded-lg p-4 space-y-2 text-xs border border-green-900">
          <li>Staking ‚Äì automatic reward pool distribution.</li>
          <li>Blackjack ‚Äì game rewards, rakeback & themed jackpots.</li>
          <li>Community ‚Äì tournaments, contests & leaderboards.</li>
          <li>Alliances ‚Äì integrations & gamified events.</li>
        </ul>
      </div>
    </section>

    <!-- Team -->
    <section id="team" class="content-panel defer-section fade-reveal">
      <h2 class="section-title">üë• Team & Links <span class="neon-underline" aria-hidden="true"></span></h2>
      <ul class="text-gray-300 space-y-2 text-xs">
        <li><strong>Team:</strong> Vortex (Dev), John Smith (Marketing), CryptoFrogDAO (Community)</li>
        <li><strong>Website:</strong> <a href="#" class="text-blue-400 underline">www.pepeblackjack.online</a></li>
        <li><strong>Twitter:</strong> <a href="https://twitter.com/pepeblackjack21" class="text-blue-400 underline" rel="noopener" target="_blank">@pepeblackjack21</a></li>
        <li><strong>Telegram:</strong> <a href="https://t.me/pepeblackjack21" class="text-blue-400 underline" rel="noopener" target="_blank">@pepeblackjack21</a></li>
      </ul>
    </section>

    <!-- FAQ -->
    <section id="faq" class="content-panel defer-section fade-reveal">
      <h2 class="section-title">‚ùì FAQ <span class="neon-underline" aria-hidden="true"></span></h2>
      <div class="text-gray-300 space-y-4 text-xs">
        <div>
          <h3 class="font-semibold" style="font-size:12px;">How do I buy PBJ?</h3>
          <p>Connect your wallet (MetaMask / WalletConnect), set ETH or PBJ amount and press "Buy".</p>
        </div>
        <div>
          <h3 class="font-semibold" style="font-size:12px;">What happens when the presale ends?</h3>
          <p><code>endPresale()</code> halts purchases; tokens become tradable on DEX and staking & casino utilities expand.</p>
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer id="footer" class="site-footer fade-reveal">
      <div class="footer-grid">
        <div class="footer-col">
          <h3>Navigation</h3>
          <p><a href="#top">Top</a><br><a href="#presale">Presale</a><br><a href="#nfts">NFTs</a><br><a href="#blackjack">Blackjack</a></p>
        </div>
        <div class="footer-col">
          <h3>Social</h3>
          <div class="social-links">
            <a href="https://twitter.com/pepeblackjack21" target="_blank" rel="noopener">Twitter</a>
            <a href="https://t.me/pepeblackjack21" target="_blank" rel="noopener">Telegram</a>
          </div>
        </div>
        <div class="footer-col">
          <h3>Disclaimer</h3>
          <div class="disclaimer-box">
            This project is experimental and DOES NOT constitute financial, legal or tax advice.
            Using the DApp involves risk of total fund loss. Do your own research.
            The team does not guarantee profits, token price stability, or service continuity.
            By interacting you accept full responsibility for your actions.
          </div>
        </div>
        <div class="footer-col">
          <h3>Contract</h3>
          <p><a href="https://basescan.org/address/0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5" target="_blank" rel="noopener">BaseScan</a></p>
          <p style="margin-top:6px;">1 ETH = 1,000,000 PBJ (Presale)</p>
        </div>
      </div>
      <div class="copyright">
        ¬© 2025 Pepe Blackjack (PBJ). All rights reserved. Use at your own risk.
      </div>
    </footer>
  </div>

  <!-- APP LOGIC -->
  <script defer>
    /* ================== Config ================== */
    let provider, signer, userAddress;
    let pbjContract, casinoContract, presaleContract;

    const rate = 1000000;
    const PRESALE_DURATION_MS = 7 * 24 * 60 * 60 * 1000;
    const presaleStart = Date.now(); // Replace with actual start timestamp if needed.

    const contractAddress     = '0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5';
    const pbjContractAddress  = '0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5';
    const pbjTokenAddress     = '0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5';
    const casinoAddress       = '0x79e617b64eae98bda7f8Cd4b1EdC05dE696E4B74';
    const nftAddress          = '0x4AabC024D719240e98e82930EAC04bD49CB86E31';

    const pbjAbi = [
      'function balanceOf(address) view returns (uint256)',
      'function decimals() view returns (uint8)',
      'function approve(address spender, uint256 amount) returns (bool)',
      'function allowance(address owner, address spender) view returns (uint256)'
    ];
    const casinoAbi = [
      'function placeBet(uint256 amount) external',
      'function finishGame(bool playerWon) external',
      'function cancelBet() external'
    ];
    const presaleAbi = ['function buyTokens() payable'];
    const nftAbi = [
      {"inputs":[{"internalType":"enum PepeBlackjackNFT.Rarity","name":"_rarity","type":"uint8"}],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"pbjToken","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"enum PepeBlackjackNFT.Rarity","name":"","type":"uint8"}],"name":"nftTypes","outputs":[
        {"internalType":"uint256","name":"pricePBJ","type":"uint256"},
        {"internalType":"uint256","name":"totalSupply","type":"uint256"},
        {"internalType":"uint256","name":"minted","type":"uint256"}
      ],"stateMutability":"view","type":"function"}
    ];

    function showStatus(msg, ok = true) {
      const el = document.getElementById('status');
      if (!el) return;
      el.textContent = msg;
      el.style.color = ok ? '#39ff14' : '#ff5151';
    }

    async function ensureBaseNetwork() {
      if(!provider) return false;
      try {
        const net = await provider.getNetwork();
        if (net.chainId === 8453) return true;
        if (provider.provider && provider.provider.request) {
          try {
            await provider.provider.request({ method:'wallet_switchEthereumChain', params:[{ chainId:'0x2105' }] });
            return true;
          } catch(e){
            try {
              await provider.provider.request({
                method:'wallet_addEthereumChain',
                params:[{
                  chainId:'0x2105',
                  chainName:'Base',
                  nativeCurrency:{ name:'Ether', symbol:'ETH', decimals:18 },
                  rpcUrls:['https://mainnet.base.org'],
                  blockExplorerUrls:['https://basescan.org']
                }]
              });
              return true;
            } catch(e2){
              showStatus('Switch to Base (8453).', false);
              return false;
            }
          }
        }
        return false;
      } catch(e){ return false; }
    }

    function bindProviderEvents(eip1193Provider){
      if(!eip1193Provider?.on) return;
      eip1193Provider.on('accountsChanged', async (acc)=>{
        if(acc.length){
          userAddress = acc[0];
          await afterConnected();
        } else {
          showStatus('Wallet disconnected', false);
        }
      });
      eip1193Provider.on('chainChanged', async ()=>{
        await ensureBaseNetwork();
        await afterConnected();
      });
      eip1193Provider.on('disconnect', ()=> showStatus('Wallet disconnected', false));
    }

    async function connectInjected(){
      if(!window.ethereum) return null;
      await window.ethereum.request({ method:'eth_requestAccounts' });
      const ethProvider = new ethers.providers.Web3Provider(window.ethereum, 'any');
      bindProviderEvents(window.ethereum);
      return ethProvider;
    }

    async function connectWalletConnect(){
      try {
        const { default: EthereumProvider } = await import("https://esm.sh/@walletconnect/ethereum-provider@2.11.1");
        const projectId = "06606e3b978574fe1fe67024c91c5aa3";
        const wcProvider = await EthereumProvider.init({
          projectId,
          chains:[8453],
          showQrModal:true,
          optionalChains:[8453],
          methods:["eth_sendTransaction","personal_sign","eth_sign","eth_signTypedData","eth_signTransaction"],
          events:["chainChanged","accountsChanged"],
          rpcMap:{8453:"https://mainnet.base.org"},
          metadata:{
            name:"Pepe Blackjack (PBJ)",
            description:"PBJ Presale + Blackjack",
            url:window.location.origin,
            icons:[window.location.origin + "/logo.avif"]
          }
        });
        await wcProvider.connect();
        bindProviderEvents(wcProvider);
        const ethProvider = new ethers.providers.Web3Provider(wcProvider, 'any');
        return ethProvider;
      } catch(err){
        showStatus('WalletConnect failed', false);
        return null;
      }
    }

    async function afterConnected(){
      try {
        signer = provider.getSigner();
        userAddress = await signer.getAddress();
        showStatus('Connected: ' + userAddress.slice(0,6) + '...' + userAddress.slice(-4));
        initContracts();
        await refreshBalances();
        document.getElementById('buyButton').disabled = false;
        document.getElementById('pbjDisplay').style.display='flex';
      } catch(e){
        showStatus('Connection error', false);
      }
    }

    function initContracts(){
      pbjContract = new ethers.Contract(pbjTokenAddress, pbjAbi, signer);
      presaleContract = new ethers.Contract(contractAddress, presaleAbi, signer);
      casinoContract = new ethers.Contract(casinoAddress, casinoAbi, signer);
    }

    async function refreshBalances(){
      try {
        const ethBal = await provider.getBalance(userAddress);
        const ethFmt = ethers.utils.formatEther(ethBal);
        document.getElementById('ethBalance').textContent = parseFloat(ethFmt).toFixed(4) + ' ETH';
        const pbjBal = await pbjContract.balanceOf(userAddress);
        const decimals = await pbjContract.decimals();
        const pbjFmt = Number(ethers.utils.formatUnits(pbjBal, decimals)).toFixed(0);
        document.getElementById('pbjBalanceHeader').textContent = pbjFmt;
        document.getElementById('pbjBalanceGame').textContent = pbjFmt;
      } catch(e){
        // silent
      }
    }

    // Presale countdown
    function updateCountdown(){
      const now = Date.now();
      const elapsed = now - presaleStart;
      const remaining = PRESALE_DURATION_MS - elapsed;
      const cdEl = document.getElementById('presale-countdown');
      const bar = document.getElementById('presale-progress');
      if(remaining <= 0){
        cdEl.textContent = 'Presale ended';
        bar.style.width = '100%';
        return;
      }
      const pct = (elapsed / PRESALE_DURATION_MS) * 100;
      bar.style.width = pct.toFixed(2) + '%';
      const days = Math.floor(remaining / (24*60*60*1000));
      const hours = Math.floor((remaining % (24*60*60*1000)) / (60*60*1000));
      const mins = Math.floor((remaining % (60*60*1000)) / (60*1000));
      const secs = Math.floor((remaining % (60*1000)) / 1000);
      cdEl.textContent = `${days}d ${hours}h ${mins}m ${secs}s`;
    }

    setInterval(updateCountdown, 1000);
    updateCountdown();

    // Sync ETH -> PBJ fields
    const ethAmountEl = document.getElementById('ethAmount');
    const pbjAmountEl = document.getElementById('pbjAmount');

    ethAmountEl.addEventListener('input', ()=>{
      const v = parseFloat(ethAmountEl.value || '0');
      if(v >= 0){
        pbjAmountEl.value = Math.floor(v * rate);
      }
    });

    pbjAmountEl.addEventListener('input', ()=>{
      const v = parseFloat(pbjAmountEl.value || '0');
      if(v >= 0){
        ethAmountEl.value = (v / rate).toFixed(6);
      }
    });

    // Quick chips
    document.querySelectorAll('.quick-chip').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const val = parseFloat(btn.dataset.eth);
        ethAmountEl.value = val;
        pbjAmountEl.value = Math.floor(val * rate);
      });
    });
    document.getElementById('maxEthBtn').addEventListener('click', async ()=>{
      if(!provider || !userAddress) return;
      const bal = await provider.getBalance(userAddress);
      const ethFmt = parseFloat(ethers.utils.formatEther(bal));
      const spendable = ethFmt * 0.95;
      ethAmountEl.value = spendable.toFixed(4);
      pbjAmountEl.value = Math.floor(spendable * rate);
    });

    // Buy button
    document.getElementById('buyButton').addEventListener('click', async ()=>{
      if(!signer) return showStatus('Connect wallet first', false);
      const okNet = await ensureBaseNetwork();
      if(!okNet) return;
      try {
        const value = ethers.utils.parseEther(ethAmountEl.value);
        const tx = await presaleContract.buyTokens({ value });
        showStatus('Tx sent: ' + tx.hash);
        await tx.wait();
        showStatus('Purchase successful!');
        await refreshBalances();
      } catch(e){
        showStatus('Purchase failed', false);
      }
    });

    // Connect buttons
    document.getElementById('connectButton').addEventListener('click', async ()=>{
      provider = await connectInjected();
      if(provider){
        await ensureBaseNetwork();
        await afterConnected();
      } else {
        showStatus('No injected wallet found', false);
      }
    });

    document.getElementById('wcButton').addEventListener('click', async ()=>{
      provider = await connectWalletConnect();
      if(provider){
        await ensureBaseNetwork();
        await afterConnected();
      }
    });

    /* Voting (simple in-memory) */
    const votes = {};
    document.querySelectorAll('.emoji-vote-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const emoji = btn.dataset.emoji;
        votes[emoji] = (votes[emoji] || 0) + 1;
        const container = document.getElementById('vote-results');
        container.innerHTML = '';
        Object.keys(votes).forEach(k=>{
          const span = document.createElement('span');
            span.textContent = k + ' ' + votes[k];
          container.appendChild(span);
        });
      });
    });

    /* Blackjack placeholder logic (simplified) */
    let gameActive = false;
    let playerCards = [];
    let dealerCards = [];
    const dealBtn = document.getElementById('dealBtn');
    const hitBtn = document.getElementById('hitBtn');
    const standBtn = document.getElementById('standBtn');
    const doubleBtn = document.getElementById('doubleBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const playerArea = document.getElementById('playerArea');
    const dealerArea = document.getElementById('dealerArea');
    const dealerScoreEl = document.getElementById('dealerScore');
    const playerScoreEl = document.getElementById('playerScore');
    const gameStateEl = document.getElementById('gameState');
    const resultMsg = document.getElementById('resultMsg');
    const activeBetDisplay = document.getElementById('activeBetDisplay');
    const betInput = document.getElementById('betAmountPBJ');

    function calcScore(cards){
      let total = 0;
      let aces = 0;
      cards.forEach(c=>{
        let v = c.value;
        if(['J','Q','K'].includes(v)) total += 10;
        else if(v === 'A'){ total += 11; aces++; }
        else total += parseInt(v);
      });
      while(total > 21 && aces > 0){
        total -= 10;
        aces--;
      }
      return total;
    }

    function drawCard(){
      const values = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
      const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
      const v = values[Math.floor(Math.random()*values.length)];
      const s = suits[Math.floor(Math.random()*suits.length)];
      return { value:v, suit:s };
    }

    function renderHands(){
      dealerArea.innerHTML = '';
      playerArea.innerHTML = '';
      dealerCards.forEach(c=>{
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `<div class="corner top-left">${c.value}<br>${c.suit}</div>
                         <div>${c.value}${c.suit}</div>
                         <div class="corner bottom-right">${c.value}<br>${c.suit}</div>`;
        if(c.suit === '‚ô•' || c.suit === '‚ô¶') div.classList.add('red'); else div.classList.add('black');
        dealerArea.appendChild(div);
      });
      playerCards.forEach(c=>{
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `<div class="corner top-left">${c.value}<br>${c.suit}</div>
                         <div>${c.value}${c.suit}</div>
                         <div class="corner bottom-right">${c.value}<br>${c.suit}</div>`;
        if(c.suit === '‚ô•' || c.suit === '‚ô¶') div.classList.add('red'); else div.classList.add('black');
        playerArea.appendChild(div);
      });
      dealerScoreEl.textContent = calcScore(dealerCards);
      playerScoreEl.textContent = calcScore(playerCards);
    }

    function resetGame(){
      gameActive = false;
      playerCards = [];
      dealerCards = [];
      renderHands();
      hitBtn.disabled = true;
      standBtn.disabled = true;
      doubleBtn.disabled = true;
      cancelBtn.disabled = true;
      dealBtn.disabled = false;
      gameStateEl.textContent = 'Idle';
      resultMsg.textContent = '';
      resultMsg.className = 'result-banner';
      activeBetDisplay.textContent = '0';
    }

    dealBtn.addEventListener('click', ()=>{
      const bet = parseInt(betInput.value);
      if(isNaN(bet) || bet <= 0){
        showStatus('Invalid bet', false);
        return;
      }
      activeBetDisplay.textContent = bet;
      gameActive = true;
      playerCards = [drawCard(), drawCard()];
      dealerCards = [drawCard(), drawCard()];
      renderHands();
      gameStateEl.textContent = 'Playing';
      dealBtn.disabled = true;
      hitBtn.disabled = false;
      standBtn.disabled = false;
      doubleBtn.disabled = false;
      cancelBtn.disabled = false;
      resultMsg.textContent = '';
      resultMsg.className = 'result-banner';
    });

    hitBtn.addEventListener('click', ()=>{
      if(!gameActive) return;
      playerCards.push(drawCard());
      renderHands();
      const score = calcScore(playerCards);
      if(score > 21){
        endGame(false, 'Bust! You lose.');
      }
    });

    standBtn.addEventListener('click', ()=>{
      if(!gameActive) return;
      while(calcScore(dealerCards) < 17){
        dealerCards.push(drawCard());
      }
      renderHands();
      const p = calcScore(playerCards);
      const d = calcScore(dealerCards);
      if(d > 21 || p > d) endGame(true, 'You win!');
      else if(p === d) endGame(null, 'Push.');
      else endGame(false, 'Dealer wins.');
    });

    doubleBtn.addEventListener('click', ()=>{
      if(!gameActive) return;
      playerCards.push(drawCard());
      renderHands();
      standBtn.click();
    });

    cancelBtn.addEventListener('click', ()=>{
      if(!gameActive) return resetGame();
    });

    function endGame(win, msg){
      gameActive = false;
      hitBtn.disabled = true;
      standBtn.disabled = true;
      doubleBtn.disabled = true;
      cancelBtn.disabled = true;
      dealBtn.disabled = false;
      gameStateEl.textContent = 'Finished';
      resultMsg.textContent = msg;
      if(win === true) resultMsg.className = 'result-banner win';
      else if(win === false) resultMsg.className = 'result-banner lose';
      else resultMsg.className = 'result-banner push';
    }

    resetGame();

    // Simple typewriter (no caret blink)
    const loreText = [
      'Multi-game meme casino.',
      'Fair & fast Base gameplay.',
      'Community-powered jackpots.',
      'Scaling globally.'
    ];
    let loreIndex = 0;
    function cycleLore(){
      const span = document.getElementById('loreType');
      span.textContent = loreText[loreIndex];
      loreIndex = (loreIndex + 1) % loreText.length;
    }
    setInterval(cycleLore, 3000);
    cycleLore();
  </script>
</body>
</html>

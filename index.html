<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
  <title>Pepe Blackjack (PBJ) - The #1 On-Chain Casino</title>
  
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&family=Press+Start+2P&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    :root { --neon: #39ff14; --dark: #050505; --panel: rgba(15, 20, 18, 0.95); }
    body { background: #020202; color: #e0e0e0; font-family: 'Inter', sans-serif; overflow-x: hidden; }
    .pixel { font-family: 'Press Start 2P', cursive; }
    
    /* Effects */
    .glass { background: var(--panel); border: 1px solid rgba(57,255,20,0.2); backdrop-filter: blur(10px); }
    .neon-text { text-shadow: 0 0 10px rgba(57,255,20,0.5); }
    .btn-main { 
        background: linear-gradient(135deg, #22c55e, #15803d); 
        box-shadow: 0 4px 0 #064e3b; transition: transform 0.1s;
    }
    .btn-main:active { transform: translateY(4px); box-shadow: none; }
    
    /* Game Cards */
    .game-card:hover { transform: translateY(-5px); border-color: var(--neon); box-shadow: 0 0 20px rgba(57,255,20,0.15); }
    
    /* Roadmap Cards */
    .roadmap-card {
      position: relative; background: rgba(255,255,255,0.03); 
      border-left: 4px solid #333; padding: 1.5rem; border-radius: 0 12px 12px 0; transition: all 0.3s;
    }
    .roadmap-card:hover { border-left-color: var(--neon); background: rgba(34,197,94,0.05); transform: translateX(5px); }
    .roadmap-card::before {
        content: ""; position: absolute; left: -11px; top: 20px; width: 18px; height: 18px;
        background: #000; border: 4px solid #333; border-radius: 50%; transition: border-color 0.3s;
    }
    .roadmap-card:hover::before { border-color: var(--neon); }

    /* Pie Chart */
    .pie-chart {
      width: 200px; height: 200px; border-radius: 50%;
      background: conic-gradient(#22c55e 0% 40%, #3b82f6 40% 65%, #a855f7 65% 85%, #f59e0b 85% 95%, #ef4444 95% 100%);
      position: relative; box-shadow: 0 0 20px rgba(34, 197, 94, 0.1); transition: transform 0.3s;
    }
    .pie-chart:hover { transform: scale(1.05); }
    .pie-chart::after {
      content: "1B SUPPLY"; position: absolute; inset: 30%; background: #020202; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; font-size: 12px; color: white; font-weight: bold; text-align: center;
    }

    /* Modal */
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; align-items: center; justify-content: center; }
    .modal.active { display: flex; animation: fadeIn 0.2s; }
    @keyframes fadeIn { from {opacity:0} to {opacity:1} }

    /* Animations */
    @keyframes flash { 0%,100%{border-color: #eab308} 50%{border-color: white} }
    .flash-border { animation: flash 1.5s infinite; border: 2px solid #eab308; }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- TOASTS -->
  <div id="toast-container" class="fixed bottom-5 right-5 z-50 flex flex-col gap-2"></div>

  <!-- GAME MODAL (Universal) -->
  <div id="gameModal" class="modal">
    <div class="glass w-full max-w-2xl p-6 rounded-2xl relative mx-4 border-2 border-green-900">
        <button onclick="closeGame()" class="absolute top-4 right-4 text-gray-500 hover:text-white text-xl">‚úï</button>
        
        <div class="flex items-center gap-3 mb-6 border-b border-gray-800 pb-4">
            <div class="w-10 h-10 bg-green-500 rounded flex items-center justify-center text-black font-bold text-xl pixel" id="modalIcon">?</div>
            <div>
                <h2 id="modalTitle" class="text-xl text-white pixel">GAME TITLE</h2>
                <p class="text-xs text-gray-400">Provably Fair ‚Ä¢ On-Chain</p>
            </div>
        </div>

        <div id="gameContent" class="min-h-[200px] flex flex-col items-center justify-center text-center mb-6"></div>

        <div class="bg-black/50 p-4 rounded-xl border border-gray-800">
            <div class="flex justify-between text-xs text-gray-400 mb-2">
                <span>Wager Amount</span>
                <span>Bal: <span id="modalBalance" class="text-green-400">0</span> PBJ</span>
            </div>
            <div class="flex gap-2">
                <input type="number" id="gameBetInput" value="1000" class="bg-black border border-gray-700 rounded px-4 py-3 w-full text-white font-mono focus:border-green-500 outline-none" placeholder="Bet Amount">
                <button id="gameActionBtn" class="btn-main text-white px-8 py-3 rounded font-bold pixel text-xs whitespace-nowrap">PLAY</button>
            </div>
            <div id="gameExtraControls" class="mt-3 flex gap-2 justify-center hidden"></div>
        </div>
        
        <div id="gameStatus" class="text-center mt-4 text-xs text-yellow-500 font-mono h-4"></div>
    </div>
  </div>

  <!-- TERMS MODAL -->
  <div id="termsModal" class="modal">
    <div class="glass p-8 rounded-xl max-w-md relative">
        <button onclick="document.getElementById('termsModal').classList.remove('active')" class="absolute top-4 right-4 text-gray-500 hover:text-white">X</button>
        <h2 class="text-xl pixel text-green-400 mb-4">PARTNER TERMS</h2>
        <div class="text-xs text-gray-300 space-y-2 font-mono">
            <p>1. 30% to 50% RevShare on Net Revenue.</p>
            <p>2. No Negative Carryover (Resets monthly).</p>
            <p>3. Weekly Payouts (Monday).</p>
        </div>
    </div>
  </div>

  <!-- HEADER -->
  <nav class="sticky top-0 z-40 bg-black/90 backdrop-blur border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 bg-green-600 rounded-full shadow-[0_0_15px_#22c55e]"></div>
        <span class="text-green-400 text-lg pixel hidden md:block">PBJ CASINO</span>
      </div>
      
      <div class="hidden lg:flex gap-6">
        <a href="#presale" class="text-xs hover:text-green-400 font-bold">BUY PBJ</a>
        <a href="#partners" class="text-xs hover:text-green-400 font-bold">PARTNERS</a>
        <a href="#games" class="text-xs hover:text-green-400 font-bold">GAMES</a>
        <a href="#shop" class="text-xs hover:text-green-400 font-bold">NFTs</a>
        <a href="#staking" class="text-xs hover:text-green-400 font-bold">STAKING</a>
      </div>

      <div class="flex items-center gap-3">
        <div id="walletDisplay" class="hidden flex-col text-right mr-2">
            <span class="text-[10px] text-gray-400">BALANCE</span>
            <span class="text-sm text-green-400 font-bold font-mono"><span id="headerBalance">0</span> PBJ</span>
        </div>
        <button id="connectBtn" class="btn-main px-5 py-2 rounded text-xs text-white font-bold pixel shadow-lg">CONNECT</button>
      </div>
    </div>
  </nav>

  <main class="flex-grow max-w-6xl mx-auto w-full px-4 py-8 space-y-20">

    <!-- PRESALE SECTION -->
    <section id="presale" class="grid md:grid-cols-2 gap-8 items-center relative pt-4">
      <div>
        <div class="flex items-center gap-3 mb-4">
            <span class="bg-green-900/50 text-green-400 text-[10px] font-bold px-3 py-1 rounded border border-green-500/30">PRESALE LIVE</span>
            <div class="flex gap-1 font-mono text-xs text-gray-300" id="countdown">
                <span id="d">00</span>d <span id="h">00</span>h <span id="m">00</span>m <span id="s">00</span>s
            </div>
        </div>
        <h1 class="text-4xl md:text-6xl text-white mb-4 pixel leading-tight">OWN THE <span class="text-green-500">CASINO</span></h1>
        <p class="text-gray-400 text-sm mb-6">Buy $PBJ tokens now. Stake for daily profits or play to win big.</p>
        
        <div class="glass p-6 rounded-xl flash-border relative overflow-hidden">
            <div id="flashBadge" class="absolute top-0 right-0 bg-yellow-500 text-black text-[9px] font-bold px-3 py-1 rounded-bl">
                üî• +50% BONUS: 01:59:59
            </div>
            
            <div class="space-y-3 mt-2">
                <div>
                    <div class="flex justify-between text-[10px] text-gray-400 mb-1"><span>PAY (ETH)</span><span id="ethBal">Bal: 0.00</span></div>
                    <div class="flex items-center bg-black border border-gray-700 rounded px-3 py-2">
                        <input type="number" id="buyInput" placeholder="0.1" class="bg-transparent w-full text-white outline-none font-mono">
                        <span class="text-xs font-bold text-gray-500">ETH</span>
                    </div>
                </div>
                <div class="flex justify-center"><span class="text-gray-600">‚Üì</span></div>
                <div>
                    <div class="flex justify-between text-[10px] text-gray-400 mb-1"><span>GET (PBJ)</span><span class="text-yellow-400">Rate: 1.5M/ETH</span></div>
                    <div class="flex items-center bg-black border border-gray-700 rounded px-3 py-2">
                        <input type="number" id="receiveInput" readonly class="bg-transparent w-full text-green-400 font-bold outline-none font-mono">
                        <span class="text-xs font-bold text-green-600">PBJ</span>
                    </div>
                </div>
                <button id="buyBtn" class="w-full btn-main py-3 rounded text-white font-bold pixel text-xs mt-2">BUY NOW</button>
            </div>
        </div>
      </div>
      <div class="hidden md:block relative group">
        <div class="absolute inset-0 bg-green-500 blur-[100px] opacity-20 group-hover:opacity-30 transition"></div>
        <img src="/prevent.png" class="relative z-10 rounded-xl border border-gray-800 shadow-2xl transform group-hover:scale-105 transition duration-500" alt="Pepe Casino">
      </div>
    </section>

    <!-- PARTNERS PROGRAM -->
    <section id="partners" class="border-t border-gray-800 pt-10">
        <div class="text-center mb-10">
            <h2 class="text-2xl text-white pixel mb-2">PARTNER PROGRAM</h2>
            <p class="text-sm text-gray-400">Earn up to <span class="text-green-500 font-bold">50% RevShare</span>. No Negative Carryover.</p>
        </div>

        <div class="grid md:grid-cols-12 gap-6">
            <!-- Dashboard -->
            <div class="md:col-span-7 glass p-6 rounded-xl">
                <div id="partner-locked" class="text-center py-10">
                    <p class="text-gray-400 text-sm mb-4">Connect wallet to access your dashboard.</p>
                    <button onclick="alert('Click Connect Top Right')" class="btn-main px-6 py-2 rounded text-xs text-white font-bold">CONNECT WALLET</button>
                </div>

                <div id="partner-unlocked" class="hidden space-y-6">
                    <div>
                        <label class="text-[10px] text-gray-500 font-bold">YOUR REFERRAL LINK</label>
                        <div class="flex gap-2 mt-2">
                            <input type="text" id="refLinkInput" readonly class="w-full bg-black/50 border border-gray-700 rounded p-3 text-white font-mono text-xs focus:border-green-500 outline-none">
                            <button onclick="copyRefLink()" class="bg-gray-800 hover:bg-gray-700 text-white px-4 rounded font-bold text-xs border border-gray-600">COPY</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-black/40 p-3 rounded border border-gray-800">
                            <p class="text-[10px] text-gray-500">Tier</p>
                            <p class="text-lg text-white font-bold">Scout</p>
                            <p class="text-[9px] text-green-400">30% Share</p>
                        </div>
                        <div class="bg-black/40 p-3 rounded border border-gray-800">
                            <p class="text-[10px] text-gray-500">Referred</p>
                            <p class="text-lg text-white font-bold">0</p>
                            <p class="text-[9px] text-gray-500">Players</p>
                        </div>
                        <div class="bg-black/40 p-3 rounded border border-gray-800">
                            <p class="text-[10px] text-gray-500">Earnings</p>
                            <p class="text-lg text-green-400 font-bold font-mono">0.00</p>
                            <p class="text-[9px] text-gray-500">$PBJ</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Info -->
            <div class="md:col-span-5 space-y-4">
                <div class="bg-gradient-to-br from-gray-900 to-black border border-gray-800 rounded-xl p-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 bg-green-600 text-black text-[9px] font-bold px-2 py-1 rounded-bl">TIERS</div>
                    <h3 class="text-white font-bold pixel text-sm mb-4">COMMISSION</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between text-xs border-b border-gray-800 pb-2"><span class="text-gray-400">Tier 1 (Scout)</span><span class="text-white font-bold">30%</span></div>
                        <div class="flex justify-between text-xs border-b border-gray-800 pb-2"><span class="text-gray-400">Tier 2 (Captain)</span><span class="text-white font-bold">40%</span></div>
                        <div class="flex justify-between text-xs"><span class="text-gray-400">Tier 3 (Whale)</span><span class="text-green-400 font-bold">50%</span></div>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="document.getElementById('termsModal').classList.add('active')" class="flex-1 bg-gray-800 hover:bg-gray-700 text-white py-3 rounded text-xs font-bold">TERMS</button>
                    <a href="https://t.me/VortexDev21" target="_blank" class="flex-1 bg-[#229ED9] hover:bg-[#1d88bd] text-white py-3 rounded text-xs font-bold text-center">CONTACT</a>
                </div>
            </div>
        </div>
    </section>

    <!-- GAMES GRID -->
    <section id="games">
        <h2 class="text-2xl text-white mb-6 pixel border-l-4 border-green-500 pl-4">GAMES LOBBY</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            
            <!-- Blackjack -->
            <div onclick="openGame('blackjack')" class="game-card glass p-4 rounded-xl cursor-pointer group relative overflow-hidden">
                <div class="absolute inset-0 bg-green-900/20 group-hover:bg-green-900/40 transition"></div>
                <div class="relative z-10 text-center py-6">
                    <div class="text-4xl mb-2">‚ô†Ô∏è</div>
                    <h3 class="text-white font-bold pixel text-xs">BLACKJACK</h3>
                    <p class="text-[10px] text-gray-400 mt-1">Live Dealer</p>
                </div>
            </div>

            <!-- Slots -->
            <div onclick="openGame('slots')" class="game-card glass p-4 rounded-xl cursor-pointer group relative overflow-hidden">
                <div class="absolute inset-0 bg-purple-900/20 group-hover:bg-purple-900/40 transition"></div>
                <div class="relative z-10 text-center py-6">
                    <div class="text-4xl mb-2">üé∞</div>
                    <h3 class="text-white font-bold pixel text-xs">SLOTS</h3>
                    <p class="text-[10px] text-gray-400 mt-1">Jackpot 10x</p>
                </div>
            </div>

            <!-- Roulette -->
            <div onclick="openGame('roulette')" class="game-card glass p-4 rounded-xl cursor-pointer group relative overflow-hidden">
                <div class="absolute inset-0 bg-red-900/20 group-hover:bg-red-900/40 transition"></div>
                <div class="relative z-10 text-center py-6">
                    <div class="text-4xl mb-2">üé°</div>
                    <h3 class="text-white font-bold pixel text-xs">ROULETTE</h3>
                    <p class="text-[10px] text-gray-400 mt-1">Double or Nothing</p>
                </div>
            </div>

            <!-- Crash -->
            <div onclick="openGame('crash')" class="game-card glass p-4 rounded-xl cursor-pointer group relative overflow-hidden">
                <div class="absolute inset-0 bg-yellow-900/20 group-hover:bg-yellow-900/40 transition"></div>
                <div class="relative z-10 text-center py-6">
                    <div class="text-4xl mb-2">üöÄ</div>
                    <h3 class="text-white font-bold pixel text-xs">CRASH</h3>
                    <p class="text-[10px] text-gray-400 mt-1">To The Moon</p>
                </div>
            </div>

            <!-- Plinko -->
            <div onclick="openGame('plinko')" class="game-card glass p-4 rounded-xl cursor-pointer group relative overflow-hidden">
                <div class="absolute inset-0 bg-pink-900/20 group-hover:bg-pink-900/40 transition"></div>
                <div class="relative z-10 text-center py-6">
                    <div class="text-4xl mb-2">üîª</div>
                    <h3 class="text-white font-bold pixel text-xs">PLINKO</h3>
                    <p class="text-[10px] text-gray-400 mt-1">High Volatility</p>
                </div>
            </div>

            <!-- Mines -->
            <div onclick="openGame('mines')" class="game-card glass p-4 rounded-xl cursor-pointer group relative overflow-hidden">
                <div class="absolute inset-0 bg-blue-900/20 group-hover:bg-blue-900/40 transition"></div>
                <div class="relative z-10 text-center py-6">
                    <div class="text-4xl mb-2">üí£</div>
                    <h3 class="text-white font-bold pixel text-xs">MINES</h3>
                    <p class="text-[10px] text-gray-400 mt-1">Don't Explode</p>
                </div>
            </div>

            <!-- Dice -->
            <div onclick="openGame('dice')" class="game-card glass p-4 rounded-xl cursor-pointer group relative overflow-hidden">
                <div class="absolute inset-0 bg-orange-900/20 group-hover:bg-orange-900/40 transition"></div>
                <div class="relative z-10 text-center py-6">
                    <div class="text-4xl mb-2">üé≤</div>
                    <h3 class="text-white font-bold pixel text-xs">DICE</h3>
                    <p class="text-[10px] text-gray-400 mt-1">Roll Under</p>
                </div>
            </div>

            <!-- Keno -->
            <div onclick="openGame('keno')" class="game-card glass p-4 rounded-xl cursor-pointer group relative overflow-hidden">
                <div class="absolute inset-0 bg-indigo-900/20 group-hover:bg-indigo-900/40 transition"></div>
                <div class="relative z-10 text-center py-6">
                    <div class="text-4xl mb-2">üé±</div>
                    <h3 class="text-white font-bold pixel text-xs">KENO</h3>
                    <p class="text-[10px] text-gray-400 mt-1">Classic Lottery</p>
                </div>
            </div>

        </div>
    </section>

    <!-- NFT SHOP -->
    <section id="shop" class="border-t border-gray-800 pt-10">
      <div class="text-center mb-8">
        <h2 class="text-2xl text-white pixel mb-2">MINT & STAKE</h2>
        <p class="text-xs text-gray-400">Own a piece of the casino. Stake for daily $PBJ rewards.</p>
      </div>

      <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
        <!-- Tier 0 -->
        <div class="glass p-3 text-center rounded-xl border border-gray-700">
          <img src="nft1.jpg" alt="Common" class="w-full h-24 object-cover rounded mb-2 opacity-70" onerror="this.src='https://placehold.co/200x200?text=Common'">
          <h3 class="text-xs font-bold text-gray-300">COMMON</h3>
          <p class="text-[9px] text-green-400 my-1">Cost: 5k | Earn: 50/d</p>
          <button onclick="mintNFT(0)" class="w-full bg-gray-800 hover:bg-green-600 hover:text-black text-[10px] py-1 rounded font-bold transition">MINT</button>
        </div>
        <!-- Tier 1 -->
        <div class="glass p-3 text-center rounded-xl border border-blue-900/50">
          <img src="nft2.jpg" alt="Uncommon" class="w-full h-24 object-cover rounded mb-2 opacity-70" onerror="this.src='https://placehold.co/200x200?text=Uncommon'">
          <h3 class="text-xs font-bold text-blue-300">UNCOMMON</h3>
          <p class="text-[9px] text-green-400 my-1">Cost: 10k | Earn: 120/d</p>
          <button onclick="mintNFT(1)" class="w-full bg-gray-800 hover:bg-blue-600 hover:text-black text-[10px] py-1 rounded font-bold transition">MINT</button>
        </div>
        <!-- Tier 2 -->
        <div class="glass p-3 text-center rounded-xl border border-purple-900/50">
          <img src="nft3.jpg" alt="Rare" class="w-full h-24 object-cover rounded mb-2 opacity-70" onerror="this.src='https://placehold.co/200x200?text=Rare'">
          <h3 class="text-xs font-bold text-purple-300">RARE</h3>
          <p class="text-[9px] text-green-400 my-1">Cost: 25k | Earn: 350/d</p>
          <button onclick="mintNFT(2)" class="w-full bg-gray-800 hover:bg-purple-600 hover:text-black text-[10px] py-1 rounded font-bold transition">MINT</button>
        </div>
        <!-- Tier 3 -->
        <div class="glass p-3 text-center rounded-xl border border-yellow-900/50">
          <img src="nft4.jpg" alt="Epic" class="w-full h-24 object-cover rounded mb-2 opacity-70" onerror="this.src='https://placehold.co/200x200?text=Epic'">
          <h3 class="text-xs font-bold text-yellow-300">EPIC</h3>
          <p class="text-[9px] text-green-400 my-1">Cost: 50k | Earn: 800/d</p>
          <button onclick="mintNFT(3)" class="w-full bg-gray-800 hover:bg-yellow-600 hover:text-black text-[10px] py-1 rounded font-bold transition">MINT</button>
        </div>
        <!-- Tier 4 -->
        <div class="glass p-3 text-center rounded-xl border border-red-900/50">
          <img src="nft5.png" alt="Legend" class="w-full h-24 object-cover rounded mb-2 opacity-70" onerror="this.src='https://placehold.co/200x200?text=Legend'">
          <h3 class="text-xs font-bold text-red-400">LEGEND</h3>
          <p class="text-[9px] text-green-400 my-1">Cost: 100k | Earn: 2k/d</p>
          <button onclick="mintNFT(4)" class="w-full bg-gray-800 hover:bg-red-600 hover:text-black text-[10px] py-1 rounded font-bold transition">MINT</button>
        </div>
      </div>
    </section>

    <!-- STAKING DASHBOARD -->
    <section id="staking" class="grid md:grid-cols-2 gap-8 pt-8 border-t border-gray-800">
      <!-- VAULT -->
      <div class="glass p-6 border-t-4 border-t-green-500 rounded-xl">
        <h2 class="text-lg text-white pixel mb-6">YOUR VAULT</h2>
        <div class="flex justify-between items-center bg-black/40 p-4 rounded-lg mb-4 border border-gray-800">
          <div><p class="text-xs text-gray-400">Total Staked</p><p id="total-staked" class="text-xl text-white font-mono">0 NFT</p></div>
          <div><p class="text-xs text-gray-400">Daily Yield</p><p id="daily-yield" class="text-xl text-green-400 font-mono">0 PBJ</p></div>
        </div>
        <div class="text-center mb-6">
          <p class="text-xs text-gray-500 mb-1">Unclaimed Rewards</p>
          <p id="pending-rewards" class="text-3xl font-mono text-green-400 animate-pulse">0.0000</p>
          <p class="text-[10px] text-gray-600">Updates live</p>
        </div>
        <button onclick="claimRewards()" class="w-full btn-main text-white font-bold py-3 rounded pixel text-xs">CLAIM REWARDS</button>
      </div>

      <!-- INVENTORY -->
      <div class="glass p-6 flex flex-col rounded-xl">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg text-white pixel">INVENTORY</h2>
          <button onclick="loadUserData()" class="text-[10px] text-green-400 hover:text-white">‚Üª Refresh</button>
        </div>
        <div id="inventory-list" class="space-y-2 max-h-[300px] overflow-y-auto pr-2">
          <p class="text-xs text-gray-500 text-center mt-10">Connect wallet to view NFTs.</p>
        </div>
      </div>
    </section>

    <!-- TOKENOMICS & ROADMAP (ADDED BACK) -->
    <section id="tokenomics" class="grid md:grid-cols-2 gap-12 pt-16 pb-10 border-t border-gray-800">
      <!-- Tokenomics -->
      <div class="flex flex-col items-center justify-center">
        <h2 class="text-2xl text-white mb-8 pixel">DISTRIBUTION</h2>
        <div class="flex flex-col md:flex-row items-center gap-8">
            <div class="pie-chart"></div>
            <div class="space-y-3 text-xs">
                <div class="flex items-center gap-2"><div class="w-3 h-3 bg-green-500 rounded-sm"></div><span class="text-gray-300">40% Presale (Liquidity)</span></div>
                <div class="flex items-center gap-2"><div class="w-3 h-3 bg-blue-500 rounded-sm"></div><span class="text-gray-300">25% Rewards Pool</span></div>
                <div class="flex items-center gap-2"><div class="w-3 h-3 bg-purple-500 rounded-sm"></div><span class="text-gray-300">20% Marketing & CEX</span></div>
                <div class="flex items-center gap-2"><div class="w-3 h-3 bg-yellow-500 rounded-sm"></div><span class="text-gray-300">10% Team (Locked)</span></div>
                <div class="flex items-center gap-2"><div class="w-3 h-3 bg-red-500 rounded-sm"></div><span class="text-gray-300">5% Airdrop</span></div>
            </div>
        </div>
      </div>

      <!-- Roadmap -->
      <div class="space-y-6">
        <h2 class="text-2xl text-white mb-4 pixel text-center md:text-left">ROADMAP</h2>
        <div class="border-l-2 border-gray-800 pl-6 space-y-6 ml-4">
          
          <!-- Q1 Card -->
          <div class="roadmap-card">
            <h4 class="text-green-400 text-sm font-bold pixel mb-2">PHASE 1: LAUNCH</h4>
            <ul class="list-disc pl-4 text-[10px] text-gray-400 space-y-1">
                <li>Smart Contract Audit</li>
                <li>Website & Blackjack Live</li>
                <li>Token Presale (Live Now)</li>
                <li>DEX Listing (Uniswap/Aerodrome)</li>
            </ul>
          </div>

          <!-- Q2 Card -->
          <div class="roadmap-card">
            <h4 class="text-blue-400 text-sm font-bold pixel mb-2">PHASE 2: EXPANSION</h4>
            <ul class="list-disc pl-4 text-[10px] text-gray-400 space-y-1">
                <li>NFT Mint & Staking Dashboard</li>
                <li>Slots & Roulette Integration</li>
                <li>Partner/Affiliate Program Scale-up</li>
                <li>CoinGecko/CMC Listing</li>
            </ul>
          </div>

          <!-- Q3 Card -->
          <div class="roadmap-card">
            <h4 class="text-purple-400 text-sm font-bold pixel mb-2">PHASE 3: DOMINATION</h4>
            <ul class="list-disc pl-4 text-[10px] text-gray-400 space-y-1">
                <li>Mobile App (iOS/Android)</li>
                <li>Tier 1 CEX Listings</li>
                <li>Live Dealer Games</li>
                <li>Revenue Share Buyback Burn</li>
            </ul>
          </div>

        </div>
      </div>
    </section>

  </main>

  <footer class="border-t border-white/10 bg-black/80 py-8 mt-12">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <div class="flex justify-center gap-4 text-gray-400 text-xs mb-4">
        <a href="#" class="hover:text-green-400">Smart Contract</a>
        <a href="#" class="hover:text-green-400">Twitter</a>
        <a href="#" class="hover:text-green-400">Telegram</a>
      </div>
      <p class="text-[10px] text-gray-700 font-mono">¬© 2025 PBJ CASINO. Not financial advice.</p>
    </div>
  </footer>

  <!-- LOGIC -->
  <script type="module">
    import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js";

    // --- CONFIGURATION ---
    const ADDR = {
        TOKEN: "0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5",
        PRESALE: "0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5", 
        BLACKJACK: "0xbe0b8099B707e3c0bA278583C6b5561D82E77f3E",
        INSTANT: "0xbcF9DFfcDaDeC818F7B653aF1a7Ff287F3e7011f",
        NFT: "0xDE05dAf2cbF59ce9094979d639393ADED494e920"
    };

    const ABIS = {
        TOKEN: ["function approve(address,uint)","function balanceOf(address) view returns(uint)","function allowance(address,address) view returns(uint)"],
        PRESALE: ["function buyTokens() payable"],
        BLACKJACK: [
            "function placeBet(uint256) external",
            "event GameFinished(address indexed player, bool won, uint256 payout, uint256 dealerScore, uint256 playerScore)"
        ],
        INSTANT: [
            "function playSlots(uint256) external",
            "function playRoulette(uint256, uint256) external",
            "function playDice(uint256, uint256) external",
            "function playPlinko(uint256) external",
            "function playCrash(uint256, uint256) external",
            "function playMines(uint256, uint256) external",
            "function playKeno(uint256) external",
            "function playTower(uint256, uint256) external",
            "event SlotsPlayed(address,uint,uint,uint[3])",
            "event RoulettePlayed(address,uint,uint,uint,string)",
            "event DicePlayed(address,uint,uint,uint,uint)",
            "event PlinkoPlayed(address,uint,uint,uint)",
            "event CrashPlayed(address,uint,uint,uint,uint)",
            "event MinesPlayed(address,uint,uint,bool)",
            "event KenoPlayed(address,uint,uint,uint)",
            "event TowerPlayed(address,uint,uint,uint)"
        ],
        NFT: [
            "function mint(uint256 id, uint256 amount) external",
            "function stake(uint256 id, uint256 amount) external",
            "function unstake(uint256 id, uint256 amount) external",
            "function claim() external",
            "function getPendingRewards(address user) view returns (uint256)",
            "function getStakedBalance(address user, uint256 id) view returns (uint256)",
            "function balanceOf(address account, uint256 id) view returns (uint256)",
            "function setApprovalForAll(address operator, bool approved) external",
            "function isApprovedForAll(address account, address operator) view returns (bool)",
            "function tierInfo(uint256 id) view returns (uint256 price, uint256 rewardPerSec, bool active)"
        ]
    };

    let provider, signer, address;
    let contracts = {};

    // --- WALLET CONNECTION ---
    document.getElementById('connectBtn').addEventListener('click', async () => {
        if(!window.ethereum) return alert("Install Metamask");
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        address = await signer.getAddress();
        
        // Init Contracts
        contracts.token = new ethers.Contract(ADDR.TOKEN, ABIS.TOKEN, signer);
        contracts.presale = new ethers.Contract(ADDR.PRESALE, ABIS.PRESALE, signer);
        contracts.blackjack = new ethers.Contract(ADDR.BLACKJACK, ABIS.BLACKJACK, signer);
        contracts.instant = new ethers.Contract(ADDR.INSTANT, ABIS.INSTANT, signer);
        contracts.nft = new ethers.Contract(ADDR.NFT, ABIS.NFT, signer);

        updateUI();
        loadUserData(); // Load NFTs & Staking
        unlockPartners(); // Unlock Dashboard
        listenForWins();
    });

    async function updateUI() {
        document.getElementById('connectBtn').innerText = address.substring(0,6)+"...";
        const bal = await contracts.token.balanceOf(address);
        const fmt = Math.floor(parseFloat(ethers.utils.formatUnits(bal, 18)));
        document.getElementById('headerBalance').innerText = fmt.toLocaleString();
        document.getElementById('modalBalance').innerText = fmt.toLocaleString();
        document.getElementById('walletDisplay').style.display = 'flex';
    }

    // --- PARTNER LOGIC ---
    function unlockPartners() {
        document.getElementById('partner-locked').classList.add('hidden');
        document.getElementById('partner-unlocked').classList.remove('hidden');
        
        const url = window.location.origin + window.location.pathname;
        document.getElementById('refLinkInput').value = `${url}?ref=${address}`;
    }

    window.copyRefLink = () => {
        const t = document.getElementById("refLinkInput");
        t.select();
        navigator.clipboard.writeText(t.value);
        alert("Link Copied!");
    };

    // Check referral on load
    const urlParams = new URLSearchParams(window.location.search);
    const refParam = urlParams.get('ref');
    if(refParam) localStorage.setItem('referrer', refParam);

    // --- NFT & STAKING LOGIC ---
    window.mintNFT = async (id) => {
        if(!signer) return alert("Connect Wallet");
        try {
            const info = await contracts.nft.tierInfo(id);
            const allow = await contracts.token.allowance(address, ADDR.NFT);
            if(allow.lt(info.price)) {
                await (await contracts.token.approve(ADDR.NFT, ethers.constants.MaxUint256)).wait();
            }
            await (await contracts.nft.mint(id, 1)).wait();
            alert("Mint Successful!"); loadUserData();
        } catch(e) { alert("Mint Failed"); console.error(e); }
    };

    window.stakeNFT = async (id) => {
        try {
            const isApproved = await contracts.nft.isApprovedForAll(address, ADDR.NFT);
            if(!isApproved) await (await contracts.nft.setApprovalForAll(ADDR.NFT, true)).wait();
            await (await contracts.nft.stake(id, 1)).wait();
            loadUserData();
        } catch(e) { alert("Error Staking"); }
    };

    window.unstakeNFT = async (id) => {
        try { await (await contracts.nft.unstake(id, 1)).wait(); loadUserData(); }
        catch(e) { alert("Error Unstaking"); }
    };

    window.claimRewards = async () => {
        try { await (await contracts.nft.claim()).wait(); alert("Claimed!"); loadUserData(); }
        catch(e) { alert("Nothing to claim"); }
    };

    window.loadUserData = async () => {
        if(!signer) return;
        const list = document.getElementById('inventory-list');
        list.innerHTML = '<p class="text-xs text-gray-500 text-center">Loading...</p>';
        
        let html = '', totalStaked = 0, dailyYield = 0;
        const tiers = ["COMMON", "UNCOMMON", "RARE", "EPIC", "LEGEND"];
        const rates = [50, 120, 350, 800, 2000];

        for(let i=0; i<5; i++) {
            const bal = parseInt(await contracts.nft.balanceOf(address, i));
            const staked = parseInt(await contracts.nft.getStakedBalance(address, i));
            totalStaked += staked; dailyYield += (staked * rates[i]);
            if(bal > 0) html += `<div class="bg-gray-900 p-3 rounded border border-gray-700 flex justify-between items-center mb-2"><div><p class="text-xs text-white font-bold">${tiers[i]} (${bal})</p></div><button onclick="stakeNFT(${i})" class="bg-green-600 text-black text-[10px] px-3 py-1 rounded font-bold">STAKE</button></div>`;
            if(staked > 0) html += `<div class="bg-green-900/20 p-3 rounded border border-green-600/50 flex justify-between items-center mb-2"><div><p class="text-xs text-green-300 font-bold">STAKED: ${tiers[i]} (${staked})</p></div><button onclick="unstakeNFT(${i})" class="bg-gray-700 text-white text-[10px] px-3 py-1 rounded">UNSTAKE</button></div>`;
        }
        list.innerHTML = html || '<p class="text-xs text-gray-500 text-center">No NFTs found.</p>';
        document.getElementById('total-staked').textContent = totalStaked + " NFT";
        document.getElementById('daily-yield').textContent = dailyYield + " PBJ/day";
        
        const pending = await contracts.nft.getPendingRewards(address);
        document.getElementById('pending-rewards').textContent = parseFloat(ethers.utils.formatUnits(pending, 18)).toFixed(4);
    };

    // --- UNIVERSAL GAME HANDLER ---
    window.openGame = (game) => {
        const m = document.getElementById('gameModal');
        const c = document.getElementById('gameContent');
        const t = document.getElementById('modalTitle');
        const i = document.getElementById('modalIcon');
        const btn = document.getElementById('gameActionBtn');
        const extra = document.getElementById('gameExtraControls');
        const status = document.getElementById('gameStatus');

        m.classList.add('active');
        extra.innerHTML = ''; 
        extra.classList.add('hidden');
        status.innerText = "Ready to play";
        btn.onclick = () => executeGame(game);

        if (game === 'slots') {
            t.innerText = "PEPE SLOTS"; i.innerText = "üé∞";
            c.innerHTML = `<div class="text-6xl border p-4 rounded bg-black tracking-widest font-mono" id="slotRes">üçí üçã üçá</div>`;
        } 
        else if (game === 'blackjack') {
            t.innerText = "BLACKJACK (LIVE)"; i.innerText = "‚ô†Ô∏è";
            c.innerHTML = `<div class="text-center"><div id="bjDealer" class="text-gray-500 mb-2">Dealer: ?</div><div class="flex gap-2 justify-center text-4xl mb-4">üÉè üÇ†</div><div id="bjPlayer" class="text-white">You: ?</div></div>`;
        }
        else if (game === 'roulette') {
            t.innerText = "ROULETTE"; i.innerText = "üé°";
            c.innerHTML = `<div class="text-6xl font-bold mb-2" id="rouletteRes">0</div>`;
            extra.classList.remove('hidden');
            extra.innerHTML = `
                <button onclick="selRoulette(0)" class="flex-1 bg-red-600 p-2 rounded text-xs font-bold border-2 border-transparent hover:border-white focus:border-white sel-btn">RED</button>
                <button onclick="selRoulette(1)" class="flex-1 bg-gray-800 p-2 rounded text-xs font-bold border-2 border-transparent hover:border-white focus:border-white sel-btn">BLACK</button>
            `;
            window.rouletteChoice = 0; 
        }
        else if (game === 'crash') {
            t.innerText = "CRASH"; i.innerText = "üöÄ";
            c.innerHTML = `<div class="text-6xl font-bold text-green-400 font-mono" id="crashRes">1.00x</div>`;
            extra.classList.remove('hidden');
            extra.innerHTML = `<input type="number" id="crashOut" value="2.00" step="0.1" class="bg-black border border-gray-600 rounded p-2 w-24 text-center text-white" placeholder="Cashout">`;
        }
        else {
            t.innerText = game.toUpperCase(); i.innerText = "üéÆ";
            c.innerHTML = `<div class="text-4xl text-gray-500">Game Ready</div>`;
        }
    };

    window.closeGame = () => document.getElementById('gameModal').classList.remove('active');
    window.selRoulette = (c) => window.rouletteChoice = c;

    // --- GAME EXECUTION ---
    async function executeGame(game) {
        if(!signer) return alert("Connect Wallet first!");
        const betInput = document.getElementById('gameBetInput').value;
        const bet = ethers.utils.parseUnits(betInput, 18);
        const status = document.getElementById('gameStatus');
        const btn = document.getElementById('gameActionBtn');

        btn.disabled = true; btn.innerText = "APPROVING...";
        status.innerText = "Check wallet...";

        try {
            const spender = game === 'blackjack' ? ADDR.BLACKJACK : ADDR.INSTANT;
            const allow = await contracts.token.allowance(address, spender);
            if(allow.lt(bet)) {
                const tx = await contracts.token.approve(spender, ethers.constants.MaxUint256);
                await tx.wait();
            }

            btn.innerText = "SENDING...";
            let tx;

            if (game === 'slots') tx = await contracts.instant.playSlots(bet);
            else if (game === 'blackjack') tx = await contracts.blackjack.placeBet(bet);
            else if (game === 'roulette') tx = await contracts.instant.playRoulette(bet, window.rouletteChoice || 0);
            else if (game === 'dice') tx = await contracts.instant.playDice(bet, 50); 
            else if (game === 'plinko') tx = await contracts.instant.playPlinko(bet);
            else if (game === 'mines') tx = await contracts.instant.playMines(bet, 3); 
            else if (game === 'crash') {
                const out = document.getElementById('crashOut').value;
                const mult = Math.floor(parseFloat(out) * 100);
                tx = await contracts.instant.playCrash(bet, mult);
            }
            else if (game === 'keno') tx = await contracts.instant.playKeno(bet);

            status.innerText = "Waiting for result...";
            await tx.wait(); 
            
            if(game !== 'blackjack') {
                status.innerText = "Result on chain!";
                updateUI();
            } else {
                status.innerText = "Waiting for Dealer...";
            }

        } catch(e) {
            console.error(e);
            status.innerText = "Error: " + (e.reason || "Tx Failed");
            btn.disabled = false; btn.innerText = "PLAY";
        }
    }

    // --- LISTENERS ---
    function listenForWins() {
        contracts.instant.on("SlotsPlayed", (p,b,pay,out) => { if(p==address) showRes(pay, `üé∞ Symbols: ${out.join('-')}`); });
        contracts.instant.on("RoulettePlayed", (p,b,pay,r,c) => { if(p==address) showRes(pay, `üé° Result: ${r} (${c})`, 'rouletteRes', r); });
        contracts.instant.on("CrashPlayed", (p,b,pay,crash,target) => { if(p==address) showRes(pay, `üí• Crashed @ ${(crash/100).toFixed(2)}x`, 'crashRes', (crash/100).toFixed(2)+"x"); });
        contracts.instant.on("PlinkoPlayed", (p,b,pay,slot) => { if(p==address) showRes(pay, `üîª Bucket: ${slot}`); });
        contracts.instant.on("DicePlayed", (p,b,pay,roll,pred) => { if(p==address) showRes(pay, `üé≤ Rolled: ${roll}`); });
        contracts.instant.on("MinesPlayed", (p,b,pay,boom) => { if(p==address) showRes(pay, boom ? "üí£ BOOM!" : "üíé SAFE"); });
        
        contracts.blackjack.on("GameFinished", (p, won, pay, dScore, pScore) => {
            if(p == address) {
                document.getElementById('bjDealer').innerText = `Dealer: ${dScore}`;
                document.getElementById('bjPlayer').innerText = `You: ${pScore}`;
                showRes(pay, won ? "YOU WON!" : "DEALER WINS");
            }
        });
    }

    function showRes(payout, text, elemId = null, elemVal = null) {
        const btn = document.getElementById('gameActionBtn');
        const status = document.getElementById('gameStatus');
        btn.disabled = false; btn.innerText = "PLAY AGAIN";
        
        const won = payout.gt(0);
        status.innerText = text;
        status.className = "text-center mt-4 text-xs font-mono h-4 " + (won ? "text-green-400" : "text-red-500");

        if(elemId && elemVal) document.getElementById(elemId).innerText = elemVal;

        if(won) {
            confetti();
            updateUI(); 
        }
    }

    // --- PRESALE ---
    document.getElementById('buyInput').addEventListener('input', (e) => {
        const eth = e.target.value;
        if(eth) document.getElementById('receiveInput').value = (eth * 1500000).toFixed(0);
    });

    document.getElementById('buyBtn').addEventListener('click', async () => {
        if(!signer) return alert("Connect Wallet");
        const eth = document.getElementById('buyInput').value;
        try {
            const tx = await contracts.presale.buyTokens({ value: ethers.utils.parseEther(eth) });
            await tx.wait();
            alert("Purchase Successful!");
            updateUI();
        } catch(e) { alert("Error Buying"); }
    });

    // --- TIMERS ---
    let target = localStorage.getItem('pEnd');
    if(!target || new Date(target) < new Date()) {
        target = new Date().getTime() + (172800000); // 2 days
        localStorage.setItem('pEnd', target);
    }
    setInterval(() => {
        const diff = target - new Date().getTime();
        if(diff > 0) {
            document.getElementById('d').innerText = Math.floor(diff/(1000*60*60*24));
            document.getElementById('h').innerText = Math.floor((diff%(1000*60*60*24))/(1000*60*60));
            document.getElementById('m').innerText = Math.floor((diff%(1000*60*60))/(1000*60));
            document.getElementById('s').innerText = Math.floor((diff%(1000*60))/1000);
        }
    }, 1000);

    setInterval(() => {
        const ms = 7200000; // 2h
        const rem = ms - (new Date().getTime() % ms);
        const h = Math.floor(rem/(1000*60*60));
        const m = Math.floor((rem%(1000*60*60))/(1000*60));
        const s = Math.floor((rem%(1000*60))/1000);
        document.getElementById('flashBadge').innerText = `üî• +50% BONUS: 0${h}:${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
    }, 1000);

    // Fake Live Ticker
    const users = ['0x4...2a', 'PepeKing', 'DegenGod', '0x9...ff'];
    const gms = ['Slots', 'Blackjack', 'Crash'];
    setInterval(() => {
        const u = users[Math.floor(Math.random()*users.length)];
        const g = gms[Math.floor(Math.random()*gms.length)];
        const a = Math.floor(Math.random()*5000)+100;
        const t = document.getElementById('ticker');
        t.style.opacity = 0;
        setTimeout(() => {
            t.innerHTML = `<span class="text-green-400">WIN:</span> ${u} won ${a} PBJ in ${g}`;
            t.style.opacity = 1;
        }, 500);
    }, 4000);

  </script>
</body>
</html>

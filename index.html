<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
  <title>Pepe Blackjack (PBJ) - Cyber Casino</title>
  <meta name="description" content="The #1 Meme Casino on Base. Play Blackjack, Slots, Plinko. Stake NFTs." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Press+Start+2P&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet" />

  <!-- Frameworks -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            pixel: ['"Press Start 2P"', 'cursive'],
            tech: ['"Rajdhani"', 'sans-serif'],
            sans: ['"Inter"', 'sans-serif'],
          },
          colors: {
            neon: '#39ff14',
            dark: '#050505',
            panel: '#0a0f0c',
          }
        }
      }
    }
  </script>

  <style>
    :root {
      --neon-green: #39ff14;
      --neon-shadow: 0 0 10px rgba(57, 255, 20, 0.5), 0 0 20px rgba(57, 255, 20, 0.3);
      --glass-bg: rgba(10, 15, 12, 0.85);
      --glass-border: rgba(57, 255, 20, 0.3);
    }

    body { background-color: #020202; color: #e0e0e0; overflow-x: hidden; font-family: 'Rajdhani', sans-serif; }

    /* --- CYBERPUNK BACKGROUND --- */
    .cyber-grid {
      position: fixed; inset: 0; z-index: -2;
      background: 
        linear-gradient(transparent 0%, rgba(0,0,0,0.9) 100%),
        linear-gradient(90deg, rgba(57, 255, 20, 0.05) 1px, transparent 1px),
        linear-gradient(rgba(57, 255, 20, 0.05) 1px, transparent 1px);
      background-size: 40px 40px;
      transform: perspective(500px) rotateX(60deg) scale(2);
      transform-origin: top center;
      animation: gridMove 20s linear infinite;
      pointer-events: none;
    }
    @keyframes gridMove { 0% { background-position: 0 0; } 100% { background-position: 0 400px; } }

    .scanlines {
      position: fixed; inset: 0; z-index: 9999; pointer-events: none;
      background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
      background-size: 100% 2px, 3px 100%;
      opacity: 0.4;
    }

    /* --- UI COMPONENTS --- */
    .glass-panel {
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--glass-border);
      box-shadow: 0 0 15px rgba(0,0,0,0.8), inset 0 0 20px rgba(0,0,0,0.5);
      border-radius: 4px;
      position: relative;
    }
    .glass-panel::before {
        content: ''; position: absolute; top: -1px; left: -1px; right: -1px; bottom: -1px;
        border-radius: 4px; padding: 1px; 
        background: linear-gradient(45deg, transparent, var(--neon-green), transparent);
        -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor; mask-composite: exclude;
        opacity: 0.5;
    }

    /* GLITCH TEXT EFFECT */
    .glitch-text {
      position: relative; color: white;
      text-shadow: 2px 2px var(--neon-green);
    }
    .glitch-text::before, .glitch-text::after {
      content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.8;
    }
    .glitch-text::before { color: #ff00ff; z-index: -1; animation: glitch-anim-1 2s infinite linear alternate-reverse; }
    .glitch-text::after { color: #00ffff; z-index: -2; animation: glitch-anim-2 3s infinite linear alternate-reverse; }
    
    @keyframes glitch-anim-1 { 0% { clip-path: inset(20% 0 80% 0); transform: translate(-2px, 1px); } 100% { clip-path: inset(60% 0 10% 0); transform: translate(2px, -1px); } }
    @keyframes glitch-anim-2 { 0% { clip-path: inset(10% 0 50% 0); transform: translate(2px, -1px); } 100% { clip-path: inset(80% 0 5% 0); transform: translate(-2px, 1px); } }

    /* BUTTONS */
    .action-btn {
      background: linear-gradient(90deg, #000, #064e3b);
      border: 1px solid var(--neon-green);
      color: var(--neon-green);
      text-transform: uppercase;
      font-family: 'Press Start 2P', cursive;
      font-size: 10px;
      padding: 12px 24px;
      clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
      transition: all 0.3s;
      cursor: pointer;
      box-shadow: 0 0 5px var(--neon-green);
    }
    .action-btn:hover:not(:disabled) {
      background: var(--neon-green); color: black;
      box-shadow: 0 0 20px var(--neon-green);
      text-shadow: none;
    }
    .action-btn:disabled { border-color: #555; color: #555; background: #111; box-shadow: none; cursor: not-allowed; }

    /* GAME CARDS */
    .game-card {
      position: relative; overflow: hidden; border-radius: 8px;
      border: 1px solid #333; background: #000;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .game-card:hover {
      transform: translateY(-10px) scale(1.02);
      border-color: var(--neon-green);
      box-shadow: 0 0 30px rgba(57, 255, 20, 0.2);
      z-index: 10;
    }
    .game-card img { width: 100%; height: 180px; object-fit: cover; filter: grayscale(0.8) contrast(1.2); transition: 0.3s; }
    .game-card:hover img { filter: grayscale(0) contrast(1); }
    
    .card-tag {
        position: absolute; top: 10px; right: 10px; 
        background: rgba(0,0,0,0.8); border: 1px solid var(--neon-green);
        color: var(--neon-green); font-size: 9px; padding: 2px 6px; 
        font-family: 'Press Start 2P'; border-radius: 2px;
    }

    /* INPUTS */
    .cyber-input {
        background: rgba(0,0,0,0.6); border: 1px solid #333;
        color: white; font-family: 'Rajdhani', sans-serif; font-weight: bold;
        transition: 0.3s; width: 100%;
    }
    .cyber-input:focus { border-color: var(--neon-green); box-shadow: 0 0 10px rgba(57,255,20,0.2); outline: none; }

    /* MODALS */
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9990; display: none; align-items: center; justify-content: center; }
    .modal-content { 
        background: #050505; border: 1px solid var(--neon-green); 
        box-shadow: 0 0 50px rgba(57,255,20,0.15), inset 0 0 20px rgba(57,255,20,0.05);
        padding: 2rem; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; position: relative;
        clip-path: polygon(20px 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%, 0 20px);
    }

    /* UTILS */
    .text-neon { color: var(--neon-green); text-shadow: 0 0 10px rgba(57,255,20,0.6); }
    .border-neon { border-color: var(--neon-green); }
    
    /* Animations */
    @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 10px var(--neon-green); } 50% { box-shadow: 0 0 25px var(--neon-green); } }
    .glow-active { animation: pulse-glow 2s infinite; }

    /* Standard Game Anim */
    @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }
    .shaking { animation: shake 0.5s infinite; }
    .blur-anim { filter: blur(2px); transition: filter 0.1s; }

    /* Pie Chart */
    .pie-chart {
      width: 200px; height: 200px; border-radius: 50%;
      background: conic-gradient(#39ff14 0% 40%, #0ea5e9 40% 65%, #a855f7 65% 85%, #f59e0b 85% 95%, #ef4444 95% 100%);
      position: relative; box-shadow: 0 0 30px rgba(57, 255, 20, 0.2);
    }
    .pie-chart::after {
      content: "1B SUPPLY"; position: absolute; inset: 30%; background: #020202; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; font-size: 12px; color: white; font-weight: bold; text-align: center; border: 2px solid #333;
    }

    /* Blackjack Cards */
    .card-visual {
        width: 50px; height: 75px; background: #fff; border-radius: 4px;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        font-weight: bold; font-family: 'Inter'; font-size: 20px; line-height: 1;
        box-shadow: 2px 2px 5px rgba(0,0,0,0.8); animation: slideIn 0.3s;
    }
    .card-red { color: #ef4444; } .card-black { color: #171717; }
    @keyframes slideIn { from { transform: translateY(-20px) scale(0.8); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
  </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

  <div class="scanlines"></div>
  <div class="cyber-grid"></div>
  
  <div id="toast-container" class="fixed bottom-5 right-5 z-50 flex flex-col gap-2"></div>

  <!-- GAME MODAL -->
  <div id="gameModal" class="modal-backdrop">
    <div class="modal-content relative">
        <button onclick="closeGame()" class="absolute top-4 right-4 text-gray-500 hover:text-neon font-pixel">X</button>
        
        <div class="flex items-center gap-4 mb-6 border-b border-gray-800 pb-4">
            <div class="text-4xl filter drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]" id="modalIcon">üé∞</div>
            <div>
                <h2 id="modalTitle" class="text-xl text-white font-pixel text-neon">GAME TITLE</h2>
                <p class="text-xs text-gray-400 font-mono tracking-widest">PROVABLY FAIR ‚Ä¢ ON-CHAIN</p>
            </div>
        </div>

        <!-- Game Content -->
        <div id="gameContent" class="min-h-[180px] flex flex-col items-center justify-center text-center mb-6 py-6 border border-gray-800 rounded bg-black/50 relative overflow-hidden">
            <!-- Background texture for game area -->
            <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(#39ff14 1px, transparent 1px); background-size: 10px 10px;"></div>
            <div class="relative z-10 w-full" id="innerGameContent"></div>
        </div>

        <!-- Controls -->
        <div class="bg-gray-900/80 p-5 border border-gray-700 rounded-sm">
            <div class="flex justify-between text-xs text-gray-400 mb-2 font-mono uppercase">
                <span>Bet Amount</span>
                <span>Bal: <span id="modalBalance" class="text-neon">0</span> PBJ</span>
            </div>
            <div class="flex gap-3">
                <div class="relative w-full">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
                    <input type="number" id="gameBetInput" value="1000" class="cyber-input px-6 py-3 rounded-sm text-lg font-mono focus:text-neon" placeholder="1000">
                </div>
                <button id="gameActionBtn" class="action-btn whitespace-nowrap">PLAY</button>
            </div>
            <div id="gameExtraControls" class="mt-3 flex gap-2 justify-center hidden"></div>
        </div>
        
        <div id="gameStatus" class="text-center mt-4 text-xs text-yellow-400 font-mono h-4 uppercase tracking-widest"></div>
    </div>
  </div>

  <!-- HEADER -->
  <nav class="sticky top-0 z-50 bg-black/90 backdrop-blur-md border-b border-neon/30 shadow-[0_0_20px_rgba(57,255,20,0.1)]">
    <div class="max-w-7xl mx-auto px-4 py-4 flex flex-wrap items-center justify-between gap-4">
      <div class="flex items-center gap-3 group cursor-pointer">
        <div class="w-10 h-10 bg-gradient-to-tr from-green-600 to-neon rounded-lg shadow-[0_0_15px_var(--neon-green)] group-hover:animate-pulse"></div>
        <div class="flex flex-col">
            <span class="text-neon text-lg font-pixel leading-none tracking-tighter">PBJ</span>
            <span class="text-[10px] text-gray-400 tracking-[0.3em] font-bold">CASINO</span>
        </div>
      </div>
      
      <div class="hidden lg:flex gap-8 items-center">
        <a href="#presale" class="text-xs font-bold hover:text-neon transition tracking-widest">PRESALE</a>
        <a href="#games" class="text-xs font-bold hover:text-neon transition tracking-widest">LOBBY</a>
        <a href="#staking" class="text-xs font-bold hover:text-neon transition tracking-widest">STAKING</a>
        <a href="#partners" class="text-xs font-bold hover:text-neon transition tracking-widest">AFFILIATE</a>
      </div>

      <div class="flex items-center gap-4 ml-auto md:ml-0">
        <div class="hidden md:flex items-center gap-2 px-4 py-1.5 bg-gray-900 border border-gray-700 text-[10px] text-gray-300 clip-path-slant">
            <span class="w-2 h-2 bg-neon rounded-full animate-ping"></span>
            <span id="ticker" class="font-mono text-neon w-32 truncate">Live Wins...</span>
        </div>

        <div id="walletDisplay" class="hidden flex-col text-right mr-1">
            <span class="text-[9px] text-gray-500 uppercase tracking-wider">Balance</span>
            <span class="text-sm text-white font-bold font-mono"><span id="headerBalance" class="text-neon">0</span> PBJ</span>
        </div>
        <button id="connectBtn" class="action-btn py-2 px-4 text-[10px]">
          CONNECT
        </button>
      </div>
    </div>
  </nav>

  <main class="flex-grow max-w-6xl mx-auto w-full px-4 py-12 space-y-24 relative z-10">

    <!-- PRESALE HERO -->
    <section id="presale" class="grid md:grid-cols-2 gap-16 items-center pt-8">
      <div class="space-y-8 relative">
        <div class="absolute -top-10 -left-10 w-40 h-40 bg-neon blur-[100px] opacity-20 pointer-events-none"></div>
        
        <div class="flex flex-col md:flex-row items-start md:items-center gap-4">
            <div class="px-3 py-1 border border-neon bg-neon/10 text-neon text-[10px] font-bold tracking-widest animate-pulse">
                ‚óè LIVE PRESALE
            </div>
            <div class="flex gap-2 font-mono text-neon text-xs">
                <span id="d">00</span>d : <span id="h">00</span>h : <span id="m">00</span>m : <span id="s">00</span>s
            </div>
        </div>

        <h1 class="text-4xl md:text-6xl leading-none font-pixel glitch-text" data-text="PEPE BLACKJACK">
          PEPE BLACKJACK
        </h1>
        <p class="text-gray-400 text-sm md:text-base font-tech leading-relaxed max-w-md border-l-2 border-neon pl-4">
          The First Provably Fair Cyber-Casino on Base Chain. <br>
          <span class="text-white font-bold">Stake PBJ. Earn ETH. Play Forever.</span>
        </p>

        <div class="glass-panel p-1 glow-active max-w-md">
          <div class="bg-black/80 p-6 space-y-4">
              <div class="flex justify-between items-end mb-2">
                  <span class="text-xs text-neon font-bold tracking-wider">BUY $PBJ</span>
                  <span class="text-[10px] text-yellow-400 animate-pulse">üî• +50% BONUS ACTIVE</span>
              </div>
              
              <div class="space-y-2">
                <div class="flex items-center bg-gray-900 border border-gray-700 p-2">
                    <input type="number" id="buyInput" class="bg-transparent text-white text-lg w-full outline-none font-mono px-2" placeholder="0.1">
                    <span class="text-xs font-bold text-gray-500 px-2">ETH</span>
                </div>
                <div class="flex justify-center text-gray-600 text-xs">‚ñº</div>
                <div class="flex items-center bg-gray-900 border border-gray-700 p-2">
                    <input type="number" id="receiveInput" class="bg-transparent text-neon text-lg w-full outline-none font-mono px-2" readonly placeholder="0">
                    <span class="text-xs font-bold text-gray-500 px-2">PBJ</span>
                </div>
              </div>

              <button id="buyBtn" class="w-full action-btn text-xs py-4 font-bold mt-2">INITIALIZE SWAP</button>
          </div>
        </div>
      </div>
      <div class="relative hidden md:flex justify-center items-center">
         <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent z-10"></div>
         <div class="w-80 h-80 rounded-full bg-neon blur-[120px] opacity-20 absolute"></div>
         <img src="/prevent.png" alt="Pepe Cyber" class="relative z-0 w-full max-w-md drop-shadow-[0_0_30px_rgba(57,255,20,0.3)] grayscale-[0.3] hover:grayscale-0 transition duration-500" onerror="this.style.display='none'; this.parentElement.innerHTML='<div class=\'text-neon font-pixel text-4xl text-center\'>CYBER<br>PEPE</div>'">
      </div>
    </section>

    <!-- PARTNERS TERMINAL -->
    <section id="partners" class="glass-panel p-1 mx-auto max-w-4xl">
        <div class="bg-black/90 p-8 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-neon"></div>
            <div class="text-center mb-8">
                <h2 class="text-2xl text-white font-pixel mb-2">AFFILIATE TERMINAL</h2>
                <p class="text-sm text-gray-400 font-mono">Earn <span class="text-neon">50% RevShare</span> instantly.</p>
            </div>
            
            <div id="partner-locked" class="text-center py-8 border border-dashed border-gray-800">
                <p class="text-gray-500 text-sm font-mono animate-pulse">&lt; ENCRYPTED: CONNECT WALLET TO ACCESS &gt;</p>
            </div>
            
            <div id="partner-unlocked" class="hidden space-y-6">
                <div>
                    <label class="text-[10px] text-neon font-bold tracking-widest mb-1 block">YOUR REF LINK</label>
                    <div class="flex gap-0">
                        <input type="text" id="refLinkInput" readonly class="w-full bg-gray-900 border border-gray-700 border-r-0 p-3 text-white font-mono text-xs outline-none">
                        <button onclick="copyRefLink()" class="bg-gray-800 hover:bg-gray-700 text-white px-6 text-xs font-bold border border-gray-700">COPY</button>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div class="bg-gray-900/50 p-3 border border-gray-800 text-center"><div class="text-[9px] text-gray-500 uppercase">Rank</div><div class="text-white font-bold font-pixel text-xs mt-1">SCOUT</div></div>
                    <div class="bg-gray-900/50 p-3 border border-gray-800 text-center"><div class="text-[9px] text-gray-500 uppercase">Users</div><div class="text-white font-bold font-pixel text-xs mt-1">0</div></div>
                    <div class="bg-gray-900/50 p-3 border border-gray-800 text-center"><div class="text-[9px] text-gray-500 uppercase">Earnings</div><div class="text-neon font-bold font-pixel text-xs mt-1">0.00</div></div>
                </div>
            </div>
        </div>
    </section>

    <!-- GAMES GRID -->
    <section id="games">
      <div class="flex items-end justify-between mb-8 border-b border-gray-800 pb-4">
          <h2 class="text-3xl text-white font-pixel flex items-center gap-3">
            <span class="text-neon">‚ñ∫</span> GAMES LOBBY
          </h2>
          <span class="text-xs text-gray-500 font-mono hidden md:block">STATUS: ONLINE (8 GAMES)</span>
      </div>

      <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
        <!-- Card Template -->
        <div onclick="openGame('blackjack')" class="game-card group cursor-pointer">
          <div class="card-tag">LIVE</div>
          <img src="games/media/blackjack.jpg" alt="Blackjack" onerror="this.src='https://placehold.co/400x300/000/39ff14?text=BLACKJACK&font=roboto'">
          <div class="p-4 bg-gradient-to-t from-neon/10 to-transparent border-t border-gray-800 relative">
            <h3 class="text-sm text-white font-bold font-pixel group-hover:text-neon transition">BLACKJACK</h3>
            <p class="text-[10px] text-gray-400 font-mono mt-1">Return: 99.5%</p>
          </div>
        </div>

        <div onclick="openGame('slots')" class="game-card group cursor-pointer">
          <div class="card-tag">HOT</div>
          <img src="games/media/slots.jpg" alt="Slots" onerror="this.src='https://placehold.co/400x300/000/a855f7?text=SLOTS&font=roboto'">
          <div class="p-4 bg-gradient-to-t from-purple-900/20 to-transparent border-t border-gray-800">
            <h3 class="text-sm text-white font-bold font-pixel group-hover:text-purple-400 transition">PEPE SLOTS</h3>
            <p class="text-[10px] text-gray-400 font-mono mt-1">Max Win: 1000x</p>
          </div>
        </div>

        <div onclick="openGame('crash')" class="game-card group cursor-pointer">
          <img src="games/media/crash.jpg" alt="Crash" onerror="this.src='https://placehold.co/400x300/000/f59e0b?text=CRASH&font=roboto'">
          <div class="p-4 bg-gradient-to-t from-yellow-900/20 to-transparent border-t border-gray-800">
            <h3 class="text-sm text-white font-bold font-pixel group-hover:text-yellow-400 transition">CRASH</h3>
            <p class="text-[10px] text-gray-400 font-mono mt-1">To The Moon</p>
          </div>
        </div>

        <div onclick="openGame('roulette')" class="game-card group cursor-pointer">
          <img src="games/media/ruleta.jpg" alt="Roulette" onerror="this.src='https://placehold.co/400x300/000/ef4444?text=ROULETTE&font=roboto'">
          <div class="p-4 bg-gradient-to-t from-red-900/20 to-transparent border-t border-gray-800">
            <h3 class="text-sm text-white font-bold font-pixel group-hover:text-red-400 transition">ROULETTE</h3>
            <p class="text-[10px] text-gray-400 font-mono mt-1">Classic</p>
          </div>
        </div>

        <div onclick="openGame('plinko')" class="game-card group cursor-pointer">
          <img src="games/media/plinko.jpg" alt="Plinko" onerror="this.src='https://placehold.co/400x300/000/ec4899?text=PLINKO&font=roboto'">
          <div class="p-4 bg-gradient-to-t from-pink-900/20 to-transparent border-t border-gray-800">
            <h3 class="text-sm text-white font-bold font-pixel group-hover:text-pink-400 transition">PLINKO</h3>
            <p class="text-[10px] text-gray-400 font-mono mt-1">High Volatility</p>
          </div>
        </div>
        
        <div onclick="openGame('mines')" class="game-card group cursor-pointer">
          <img src="games/media/minas.jpg" alt="Mines" onerror="this.src='https://placehold.co/400x300/000/6b7280?text=MINES&font=roboto'">
          <div class="p-4 bg-gradient-to-t from-gray-800/40 to-transparent border-t border-gray-800">
            <h3 class="text-sm text-white font-bold font-pixel group-hover:text-gray-300 transition">MINES</h3>
            <p class="text-[10px] text-gray-400 font-mono mt-1">Strategic</p>
          </div>
        </div>

        <div onclick="openGame('dice')" class="game-card group cursor-pointer">
          <img src="games/media/dados.jpg" alt="Dice" onerror="this.src='https://placehold.co/400x300/000/3b82f6?text=DICE&font=roboto'">
          <div class="p-4 bg-gradient-to-t from-blue-900/20 to-transparent border-t border-gray-800">
            <h3 class="text-sm text-white font-bold font-pixel group-hover:text-blue-400 transition">DICE</h3>
            <p class="text-[10px] text-gray-400 font-mono mt-1">Fast Paced</p>
          </div>
        </div>

        <div onclick="openGame('keno')" class="game-card group cursor-pointer">
          <img src="games/media/keno.jpg" alt="Keno" onerror="this.src='https://placehold.co/400x300/000/8b5cf6?text=KENO&font=roboto'">
          <div class="p-4 bg-gradient-to-t from-purple-900/20 to-transparent border-t border-gray-800">
            <h3 class="text-sm text-white font-bold font-pixel group-hover:text-purple-400 transition">KENO</h3>
            <p class="text-[10px] text-gray-400 font-mono mt-1">Lottery</p>
          </div>
        </div>
      </div>
    </section>

    <!-- NFT & STAKING -->
    <section id="shop" class="space-y-8 pt-10 border-t border-gray-800/50">
      <div class="text-center mb-10">
        <h2 class="text-3xl text-white font-pixel mb-2">NFT MINT</h2>
        <div class="w-24 h-1 bg-neon mx-auto shadow-[0_0_10px_var(--neon-green)]"></div>
        <p class="text-sm text-gray-400 mt-4 font-mono">Mint Cards. Stake for Revenue Share.</p>
      </div>
      <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
        <!-- NFT Card Common -->
        <div class="glass-panel p-3 text-center group hover:border-neon transition">
            <div class="relative mb-3 overflow-hidden rounded">
                <img src="nft1.jpg" class="w-full opacity-80 group-hover:scale-110 transition duration-500" onerror="this.src='https://placehold.co/150/111/fff?text=?'">
                <div class="absolute bottom-0 left-0 right-0 bg-black/70 py-1 text-[9px] text-white">LEVEL 1</div>
            </div>
            <h3 class="text-xs text-white font-bold mb-2">COMMON</h3>
            <button onclick="mintNFT(0)" class="action-btn w-full py-2 text-[8px]">MINT</button>
        </div>
        <!-- Uncommon -->
        <div class="glass-panel p-3 text-center group hover:border-blue-400 transition">
            <div class="relative mb-3 overflow-hidden rounded">
                <img src="nft2.jpg" class="w-full opacity-80 group-hover:scale-110 transition duration-500" onerror="this.src='https://placehold.co/150/111/3b82f6?text=?'">
                <div class="absolute bottom-0 left-0 right-0 bg-blue-900/70 py-1 text-[9px] text-white">LEVEL 2</div>
            </div>
            <h3 class="text-xs text-blue-400 font-bold mb-2">UNCOMMON</h3>
            <button onclick="mintNFT(1)" class="action-btn w-full py-2 text-[8px]" style="--neon-green: #60a5fa">MINT</button>
        </div>
        <!-- Rare -->
        <div class="glass-panel p-3 text-center group hover:border-purple-400 transition">
             <div class="relative mb-3 overflow-hidden rounded">
                <img src="nft3.jpg" class="w-full opacity-80 group-hover:scale-110 transition duration-500" onerror="this.src='https://placehold.co/150/111/a855f7?text=?'">
                <div class="absolute bottom-0 left-0 right-0 bg-purple-900/70 py-1 text-[9px] text-white">LEVEL 3</div>
            </div>
            <h3 class="text-xs text-purple-400 font-bold mb-2">RARE</h3>
            <button onclick="mintNFT(2)" class="action-btn w-full py-2 text-[8px]" style="--neon-green: #c084fc">MINT</button>
        </div>
        <!-- Epic -->
        <div class="glass-panel p-3 text-center group hover:border-yellow-400 transition">
             <div class="relative mb-3 overflow-hidden rounded">
                <img src="nft4.jpg" class="w-full opacity-80 group-hover:scale-110 transition duration-500" onerror="this.src='https://placehold.co/150/111/facc15?text=?'">
                <div class="absolute bottom-0 left-0 right-0 bg-yellow-900/70 py-1 text-[9px] text-white">LEVEL 4</div>
            </div>
            <h3 class="text-xs text-yellow-400 font-bold mb-2">EPIC</h3>
            <button onclick="mintNFT(3)" class="action-btn w-full py-2 text-[8px]" style="--neon-green: #facc15">MINT</button>
        </div>
        <!-- Legend -->
        <div class="glass-panel p-3 text-center group hover:border-red-500 transition shadow-[0_0_15px_rgba(239,68,68,0.1)]">
             <div class="relative mb-3 overflow-hidden rounded">
                <img src="nft5.png" class="w-full opacity-80 group-hover:scale-110 transition duration-500" onerror="this.src='https://placehold.co/150/111/ef4444?text=?'">
                <div class="absolute bottom-0 left-0 right-0 bg-red-900/70 py-1 text-[9px] text-white">MAX LEVEL</div>
            </div>
            <h3 class="text-xs text-red-500 font-bold mb-2">LEGEND</h3>
            <button onclick="mintNFT(4)" class="action-btn w-full py-2 text-[8px]" style="--neon-green: #ef4444">MINT</button>
        </div>
      </div>
    </section>

    <!-- STAKING VAULT -->
    <section id="staking" class="grid md:grid-cols-2 gap-8">
      <div class="glass-panel p-8 relative overflow-hidden">
        <div class="absolute -right-10 -bottom-10 w-32 h-32 bg-neon blur-[80px] opacity-10"></div>
        <h2 class="text-xl text-white font-pixel mb-6 flex items-center gap-2">
            <span class="text-neon">üîí</span> VAULT
        </h2>
        
        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="bg-black/40 p-4 border-l-2 border-gray-700">
                <p class="text-[10px] text-gray-500 uppercase">Total Staked</p>
                <p id="total-staked" class="text-2xl text-white font-mono">0 NFT</p>
            </div>
            <div class="bg-black/40 p-4 border-l-2 border-neon">
                <p class="text-[10px] text-gray-500 uppercase">Daily Yield</p>
                <p id="daily-yield" class="text-2xl text-neon font-mono">0 PBJ</p>
            </div>
        </div>
        
        <div class="text-center mb-8 py-4 bg-gradient-to-r from-transparent via-green-900/20 to-transparent">
          <p class="text-[10px] text-gray-400 uppercase tracking-widest mb-1">Pending Rewards</p>
          <p id="pending-rewards" class="text-4xl font-mono text-white drop-shadow-[0_0_5px_rgba(255,255,255,0.5)]">0.0000</p>
        </div>
        <button onclick="claimRewards()" class="w-full action-btn">CLAIM REWARDS</button>
      </div>

      <div class="glass-panel p-6 flex flex-col">
        <div class="flex justify-between items-center mb-4 border-b border-gray-800 pb-2">
          <h2 class="text-lg text-white font-pixel">INVENTORY</h2>
          <button onclick="loadUserData()" class="text-xs text-neon hover:text-white font-mono">[REFRESH]</button>
        </div>
        <div id="inventory-list" class="space-y-2 max-h-[300px] overflow-y-auto pr-2 custom-scrollbar">
          <div class="h-full flex items-center justify-center flex-col text-gray-600 py-10">
              <span class="text-2xl mb-2">üï∏Ô∏è</span>
              <p class="text-xs font-mono">Wallet not connected</p>
          </div>
        </div>
      </div>
    </section>

    <!-- TOKENOMICS & ROADMAP -->
    <section id="tokenomics" class="grid md:grid-cols-2 gap-12 pt-10 pb-20 border-t border-gray-800/50">
      <div class="flex flex-col items-center justify-center relative">
        <h2 class="text-2xl text-white mb-8 font-pixel">TOKENOMICS</h2>
        <div class="pie-chart animate-[spin_20s_linear_infinite]"></div>
        <!-- Legend -->
        <div class="flex flex-wrap justify-center gap-4 mt-8 text-[10px] font-mono text-gray-400">
            <span class="flex items-center gap-1"><span class="w-2 h-2 bg-neon rounded-full"></span>Presale</span>
            <span class="flex items-center gap-1"><span class="w-2 h-2 bg-blue-500 rounded-full"></span>Liquidity</span>
            <span class="flex items-center gap-1"><span class="w-2 h-2 bg-purple-500 rounded-full"></span>Team</span>
        </div>
      </div>
      
      <div class="space-y-6">
        <h2 class="text-2xl text-white mb-4 font-pixel text-right">ROADMAP</h2>
        
        <div class="relative pl-8 border-l border-gray-800 space-y-8">
            <div class="relative">
                <div class="absolute -left-[37px] top-1 w-4 h-4 bg-neon rounded-full border-4 border-black shadow-[0_0_10px_var(--neon-green)]"></div>
                <h4 class="text-neon text-sm font-bold font-pixel">PHASE 1: GENESIS</h4>
                <p class="text-xs text-gray-400 mt-1">Contract Deployment, Website Launch, Presale Start, Community Building.</p>
            </div>
            <div class="relative opacity-70">
                <div class="absolute -left-[37px] top-1 w-4 h-4 bg-blue-500 rounded-full border-4 border-black"></div>
                <h4 class="text-blue-500 text-sm font-bold font-pixel">PHASE 2: EXPANSION</h4>
                <p class="text-xs text-gray-400 mt-1">Casino Live, NFT Staking Enabled, Marketing Campaign, First Buybacks.</p>
            </div>
            <div class="relative opacity-50">
                <div class="absolute -left-[37px] top-1 w-4 h-4 bg-purple-500 rounded-full border-4 border-black"></div>
                <h4 class="text-purple-500 text-sm font-bold font-pixel">PHASE 3: DOMINATION</h4>
                <p class="text-xs text-gray-400 mt-1">CEX Listings, Multiplayer Poker, Revenue Share Increase.</p>
            </div>
        </div>
      </div>
    </section>

  </main>

  <footer class="border-t border-gray-900 bg-black py-8 relative z-10">
    <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4 text-[10px] text-gray-600 font-mono uppercase">
      <p>¬© 2025 PBJ CASINO. DECENTRALIZED GAMBLING.</p>
      <div class="flex gap-4">
          <a href="#" class="hover:text-neon">Smart Contract</a>
          <a href="#" class="hover:text-neon">Audit</a>
          <a href="#" class="hover:text-neon">Telegram</a>
      </div>
    </div>
  </footer>

  <script type="module">
    // COPIA EXACTA DE TU SCRIPT JS ORIGINAL (SIN CAMBIOS EN LA L√ìGICA)
    import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js";

    // --- CONFIGURACI√ìN ---
    const ADDR = {
        TOKEN: "0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5",
        PRESALE: "0xff4b4f2076F39550e2C5fD44cb2024Eb06B944E5", 
        BLACKJACK: "0xbe0b8099B707e3c0bA278583C6b5561D82E77f3E",
        INSTANT: "0xbcF9DFfcDaDeC818F7B653aF1a7Ff287F3e7011f",
        NFT: "0xDE05dAf2cbF59ce9094979d639393ADED494e920"
    };

    const ABIS = {
        TOKEN: [
            "function approve(address spender, uint256 amount) external returns (bool)",
            "function balanceOf(address account) external view returns (uint256)",
            "function allowance(address owner, address spender) external view returns (uint256)"
        ],
        PRESALE: [
            "function buyTokens() payable"
        ],
        BLACKJACK: [
            "function placeBet(uint256 amount) external",
            "event GameFinished(address indexed player, bool won, uint256 payout, uint256 dealerScore, uint256 playerScore)"
        ],
        INSTANT: [
            "function playSlots(uint256 _bet) external",
            "function playRoulette(uint256 _bet, uint256 _choice) external",
            "function playDice(uint256 _bet, uint256 _rollUnder) external",
            "function playPlinko(uint256 _bet) external",
            "function playCrash(uint256 _bet, uint256 _cashoutX) external",
            "function playMines(uint256 _bet, uint256 _minesCount) external",
            "function playKeno(uint256 _bet) external",
            "event SlotsPlayed(address indexed player, uint256 bet, uint256 payout, uint256[3] outcome)",
            "event RoulettePlayed(address indexed player, uint256 bet, uint256 payout, uint256 roll, string color)",
            "event DicePlayed(address indexed player, uint256 bet, uint256 payout, uint256 rolled, uint256 prediction)",
            "event PlinkoPlayed(address indexed player, uint256 bet, uint256 payout, uint256 slot)",
            "event CrashPlayed(address indexed player, uint256 bet, uint256 payout, uint256 crashPoint, uint256 cashoutPoint)",
            "event MinesPlayed(address indexed player, uint256 bet, uint256 payout, bool exploded)",
            "event KenoPlayed(address indexed player, uint256 bet, uint256 payout, uint256 matches)"
        ],
        NFT: [
            "function mint(uint256 id, uint256 amount) external",
            "function stake(uint256 id, uint256 amount) external",
            "function unstake(uint256 id, uint256 amount) external",
            "function claim() external",
            "function getPendingRewards(address user) view returns (uint256)",
            "function getStakedBalance(address user, uint256 id) view returns (uint256)",
            "function balanceOf(address account, uint256 id) view returns (uint256)",
            "function tierInfo(uint256 id) view returns (uint256 price, uint256 rewardPerSec, bool active)"
        ]
    };

    let provider, signer, address;
    let contracts = {};
    let animInterval = null;

    const toast = (msg, type='success') => {
        const c = document.getElementById('toast-container');
        const t = document.createElement('div');
        t.className = `toast ${type} px-4 py-3 text-xs font-mono uppercase bg-black border border-${type==='error'?'red-500':'green-500'} text-white shadow-[0_0_10px_rgba(0,0,0,0.5)] slide-in`;
        t.innerText = `> ${msg}`;
        c.appendChild(t);
        setTimeout(() => t.remove(), 3000);
    };

    document.getElementById('connectBtn').addEventListener('click', async () => {
        if(!window.ethereum) return alert("Install Metamask");
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        address = await signer.getAddress();
        
        contracts.token = new ethers.Contract(ADDR.TOKEN, ABIS.TOKEN, signer);
        contracts.presale = new ethers.Contract(ADDR.PRESALE, ABIS.PRESALE, signer);
        contracts.blackjack = new ethers.Contract(ADDR.BLACKJACK, ABIS.BLACKJACK, signer);
        contracts.instant = new ethers.Contract(ADDR.INSTANT, ABIS.INSTANT, signer);
        contracts.nft = new ethers.Contract(ADDR.NFT, ABIS.NFT, signer);

        updateUI();
        loadUserData();
        unlockPartners();
        listenForWins();
        toast("SYSTEM ONLINE: Wallet Connected");
    });

    async function updateUI() {
        document.getElementById('connectBtn').innerText = address.substring(0,6)+"..."+address.substring(38);
        const bal = await contracts.token.balanceOf(address);
        const fmt = Math.floor(parseFloat(ethers.utils.formatUnits(bal, 18)));
        document.getElementById('headerBalance').innerText = fmt.toLocaleString();
        document.getElementById('modalBalance').innerText = fmt.toLocaleString();
        document.getElementById('walletDisplay').style.display = 'flex';
    }

    function unlockPartners() {
        document.getElementById('partner-locked').classList.add('hidden');
        document.getElementById('partner-unlocked').classList.remove('hidden');
        const url = window.location.origin + window.location.pathname;
        document.getElementById('refLinkInput').value = `${url}?ref=${address}`;
    }
    window.copyRefLink = () => {
        const t = document.getElementById("refLinkInput"); t.select();
        navigator.clipboard.writeText(t.value); toast("LINK COPIED TO CLIPBOARD");
    };

    function startAnimation(game) {
        if(animInterval) clearInterval(animInterval);
        const status = document.getElementById('gameStatus');
        status.innerText = ">>> EXECUTING SMART CONTRACT...";
        status.className = "text-center mt-4 text-xs text-neon font-mono h-4 animate-pulse";

        if (game === 'slots') {
            const emojis = ['üçí','üçã','üçá','üçâ','üîî','üíé','7Ô∏è‚É£'];
            const el = document.getElementById('slotRes');
            el.classList.add('blur-anim');
            animInterval = setInterval(() => {
                el.innerText = `${emojis[Math.floor(Math.random()*7)]} ${emojis[Math.floor(Math.random()*7)]} ${emojis[Math.floor(Math.random()*7)]}`;
            }, 80);
        }
        else if (game === 'dice') {
            const el = document.getElementById('diceRes');
            el.classList.add('shaking');
            animInterval = setInterval(() => { el.innerText = Math.floor(Math.random() * 100); }, 50);
        }
        else if (game === 'crash') {
            const el = document.getElementById('crashRes');
            let val = 1.00;
            animInterval = setInterval(() => { 
                val += 0.05; 
                el.innerText = val.toFixed(2) + "x"; 
                el.style.color = "#39ff14";
            }, 100);
        }
        else if (game === 'roulette') {
            const el = document.getElementById('rouletteRes');
            const colors = ['text-red-500', 'text-white'];
            el.classList.add('shaking');
            animInterval = setInterval(() => { 
                el.innerText = Math.floor(Math.random() * 37); 
                el.className = `text-6xl font-bold mb-2 ${colors[Math.floor(Math.random()*2)]}`;
            }, 80);
        }
    }

    function stopAnimation() {
        if(animInterval) clearInterval(animInterval);
        const els = document.querySelectorAll('.blur-anim, .shaking');
        els.forEach(e => e.classList.remove('blur-anim', 'shaking'));
    }

    window.openGame = (game) => {
        const m = document.getElementById('gameModal');
        const c = document.getElementById('innerGameContent');
        const t = document.getElementById('modalTitle');
        const i = document.getElementById('modalIcon');
        const btn = document.getElementById('gameActionBtn');
        const extra = document.getElementById('gameExtraControls');
        const status = document.getElementById('gameStatus');

        m.style.display = 'flex';
        extra.innerHTML = ''; 
        extra.classList.add('hidden');
        status.innerText = "READY TO PLAY";
        status.className = "text-center mt-4 text-xs text-gray-500 font-mono h-4 uppercase tracking-wider";
        btn.onclick = () => executeGame(game);

        if (game === 'slots') {
            t.innerText = "PEPE SLOTS"; i.innerText = "üé∞";
            c.innerHTML = `<div class="text-6xl font-mono tracking-widest text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.8)]" id="slotRes">üçí üçã üçá</div>`;
        } 
        else if (game === 'dice') {
            t.innerText = "DICE"; i.innerText = "üé≤";
            c.innerHTML = `<div class="text-6xl font-bold text-white font-mono" id="diceRes">50</div><div class="text-xs text-neon mt-2 font-mono">&lt; ROLL UNDER 50 &gt;</div>`;
        }
        else if (game === 'blackjack') {
            t.innerText = "SPEED BLACKJACK"; i.innerText = "‚ö°";
            c.innerHTML = `
                <div class="flex flex-col gap-6 w-full p-4">
                    <div class="text-center">
                        <p class="text-[10px] text-gray-500 mb-1 uppercase">Dealer Hand</p>
                        <div id="bjDealer" class="min-h-[80px] flex items-center justify-center">
                            <div class="card-visual card-black bg-gray-800 border-2 border-gray-600">?</div>
                            <div class="card-visual card-red ml-[-20px]">?</div>
                        </div>
                    </div>
                    <div class="text-center">
                        <div id="bjPlayer" class="min-h-[80px] flex items-center justify-center">
                            <div class="text-2xl animate-pulse text-gray-500 font-pixel">WAITING DEAL...</div>
                        </div>
                        <p class="text-[10px] text-gray-500 mt-1 uppercase">Player Hand</p>
                    </div>
                </div>`;
        }
        else if (game === 'roulette') {
            t.innerText = "ROULETTE"; i.innerText = "üé°";
            c.innerHTML = `<div class="text-6xl font-bold mb-2 text-white font-mono" id="rouletteRes">0</div>`;
            extra.classList.remove('hidden');
            extra.innerHTML = `
                <button onclick="window.rouletteChoice=0" class="bg-red-600 hover:bg-red-500 text-white p-2 rounded text-xs font-bold flex-1 border border-transparent">RED</button>
                <button onclick="window.rouletteChoice=1" class="bg-gray-800 hover:bg-gray-700 text-white p-2 rounded text-xs font-bold flex-1 border border-transparent">BLACK</button>
            `;
            window.rouletteChoice = 0; 
        }
        else if (game === 'crash') {
            t.innerText = "CRASH"; i.innerText = "üöÄ";
            c.innerHTML = `<div class="text-6xl font-bold text-neon font-mono drop-shadow-[0_0_10px_rgba(57,255,20,0.8)]" id="crashRes">1.00x</div>`;
            extra.classList.remove('hidden');
            extra.innerHTML = `<input type="number" id="crashOut" value="2.00" step="0.1" class="bg-black border border-gray-600 rounded p-2 w-24 text-center text-white outline-none font-mono" placeholder="2.0">`;
        }
        else {
            t.innerText = game.toUpperCase(); i.innerText = "üéÆ";
            c.innerHTML = `<div class="text-4xl text-gray-500 font-pixel">READY</div>`;
        }
    };

    window.closeGame = () => {
        document.getElementById('gameModal').style.display = 'none';
        stopAnimation();
    };

    async function executeGame(game) {
        if(!signer) return toast("CONNECT WALLET REQUIRED", "error");
        const betInput = document.getElementById('gameBetInput').value;
        const bet = ethers.utils.parseUnits(betInput, 18);
        const status = document.getElementById('gameStatus');
        const btn = document.getElementById('gameActionBtn');

        btn.disabled = true; btn.innerText = "AUTH...";
        status.innerText = "CHECKING ALLOWANCE...";

        try {
            const spender = game === 'blackjack' ? ADDR.BLACKJACK : ADDR.INSTANT;
            const allow = await contracts.token.allowance(address, spender);
            if(allow.lt(bet)) {
                const tx = await contracts.token.approve(spender, ethers.constants.MaxUint256);
                await tx.wait();
            }

            btn.innerText = "TX PENDING...";
            let tx;

            if (game === 'slots') tx = await contracts.instant.playSlots(bet);
            else if (game === 'blackjack') tx = await contracts.blackjack.placeBet(bet);
            else if (game === 'roulette') tx = await contracts.instant.playRoulette(bet, window.rouletteChoice || 0);
            else if (game === 'dice') tx = await contracts.instant.playDice(bet, 50); 
            else if (game === 'plinko') tx = await contracts.instant.playPlinko(bet);
            else if (game === 'mines') tx = await contracts.instant.playMines(bet, 3); 
            else if (game === 'crash') {
                const out = document.getElementById('crashOut').value;
                const mult = Math.floor(parseFloat(out) * 100);
                tx = await contracts.instant.playCrash(bet, mult);
            }
            else if (game === 'keno') tx = await contracts.instant.playKeno(bet);

            if (game !== 'blackjack') startAnimation(game);
            
            status.innerText = "WAITING FOR BLOCKCHAIN CONFIRMATION...";
            const receipt = await tx.wait(); 
            
            stopAnimation();

            if(game !== 'blackjack') {
                const event = receipt.events.find(e => e.event); 
                if (event) {
                    const args = event.args;
                    if(game === 'dice') showRes(args.payout, `ROLLED: ${args.rolled}`, 'diceRes', args.rolled);
                    else if(game === 'slots') showRes(args.payout, `SYMBOLS: ${args.outcome.join('-')}`, 'slotRes', `${emoji(args.outcome[0])} ${emoji(args.outcome[1])} ${emoji(args.outcome[2])}`);
                    else if(game === 'roulette') showRes(args.payout, `RESULT: ${args.roll} (${args.color.toUpperCase()})`, 'rouletteRes', args.roll);
                    else if(game === 'plinko') showRes(args.payout, `BUCKET: ${args.slot}`);
                    else if(game === 'crash') { const c = (args.crashPoint/100).toFixed(2); showRes(args.payout, `CRASHED @ ${c}x`, 'crashRes', c+"x"); }
                    else if(game === 'mines') showRes(args.payout, args.exploded ? "BOOM!" : "SAFE");
                    else if(game === 'keno') showRes(args.payout, `MATCHES: ${args.matches}`);
                }
                updateUI();
            } else {
                status.innerText = "WAITING FOR DEALER...";
            }

        } catch(e) {
            console.error(e);
            stopAnimation();
            status.innerText = "ERROR: TRANSACTION FAILED";
            status.className = "text-center mt-4 text-xs text-red-500 font-mono h-4 uppercase tracking-wider";
            btn.disabled = false; btn.innerText = "PLAY";
        }
    }

    function generateHandFromScore(targetScore) {
        const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
        const cards = [];
        let currentSum = 0;
        if (targetScore === 21) return [{val:'A', s:suits[0]}, {val:'K', s:suits[1]}];
        if (targetScore > 21) return [{val:'10', s:suits[2]}, {val:'10', s:suits[3]}, {val:'5', s:suits[0]}];

        while(currentSum < targetScore) {
            let diff = targetScore - currentSum;
            let val = diff > 10 ? 10 : diff;
            if (currentSum === 0 && diff > 10) val = Math.floor(Math.random() * 9) + 2;
            if (currentSum + val > targetScore) val = targetScore - currentSum;
            currentSum += val;
            let displayVal = val.toString();
            if (val === 1 || val === 11) displayVal = 'A';
            if (val === 10) displayVal = ['10', 'J', 'Q', 'K'][Math.floor(Math.random()*4)];
            cards.push({ val: displayVal, s: suits[Math.floor(Math.random() * 4)] });
        }
        return cards;
    }

    function renderCards(elementId, score) {
        const container = document.getElementById(elementId);
        const hand = generateHandFromScore(score);
        let html = `<div class="flex gap-2 justify-center">`;
        hand.forEach(c => {
            const isRed = (c.s === '‚ô•' || c.s === '‚ô¶');
            const colorClass = isRed ? 'card-red' : 'card-black';
            html += `<div class="card-visual ${colorClass}"><span>${c.val}</span><span class="text-xs">${c.s}</span></div>`;
        });
        html += `</div><div class="text-xs mt-2 text-gray-400 font-mono">SCORE: ${score}</div>`;
        container.innerHTML = html;
    }

    function listenForWins() {
        contracts.blackjack.on("GameFinished", (p, won, pay, dScore, pScore) => {
            if(p == address) {
                renderCards('bjDealer', dScore);
                renderCards('bjPlayer', pScore);
                showRes(pay, won ? "YOU WON!" : "DEALER WINS");
            }
        });
    }

    function emoji(num) {
        const map = ['üçí','üçã','üçá','üçâ','üîî','üíé','7Ô∏è‚É£','üé±','üëë','ü™ô'];
        return map[num] || num;
    }

    function showRes(payout, text, elemId = null, elemVal = null) {
        stopAnimation();
        const btn = document.getElementById('gameActionBtn');
        const status = document.getElementById('gameStatus');
        btn.disabled = false; btn.innerText = "PLAY AGAIN";
        
        const payVal = ethers.BigNumber.from(payout);
        const won = payVal.gt(0);
        const profit = ethers.utils.formatUnits(payVal, 18);
        
        status.innerText = text + (won ? ` (+${parseFloat(profit).toFixed(0)} PBJ)` : "");
        status.className = "text-center mt-4 text-xs font-mono h-4 uppercase tracking-widest " + (won ? "text-neon" : "text-red-500");

        if(elemId && elemVal) document.getElementById(elemId).innerText = elemVal;

        if(won) {
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#39ff14', '#ffffff'] });
            updateUI(); 
        }
    }

    window.mintNFT = async (id) => {
        if(!signer) return toast("Connect Wallet", "error");
        try {
            const info = await contracts.nft.tierInfo(id);
            const allow = await contracts.token.allowance(address, ADDR.NFT);
            if(allow.lt(info.price)) await (await contracts.token.approve(ADDR.NFT, ethers.constants.MaxUint256)).wait();
            await (await contracts.nft.mint(id, 1)).wait();
            toast("MINT SUCCESSFUL"); loadUserData(); updateUI();
        } catch(e) { toast("MINT FAILED", "error"); }
    };
    window.stakeNFT = async (id) => { try { await (await contracts.nft.stake(id, 1)).wait(); loadUserData(); toast("STAKED SUCCESSFULLY"); } catch(e){} };
    window.unstakeNFT = async (id) => { try { await (await contracts.nft.unstake(id, 1)).wait(); loadUserData(); toast("UNSTAKED SUCCESSFULLY"); } catch(e){} };
    window.claimRewards = async () => { try { await (await contracts.nft.claim()).wait(); toast("REWARDS CLAIMED"); loadUserData(); } catch(e){} };

    window.loadUserData = async () => {
        if(!signer) return;
        const list = document.getElementById('inventory-list');
        list.innerHTML = '';
        let totalStaked = 0, dailyYield = 0;
        const tiers = ["COMMON", "UNCOMMON", "RARE", "EPIC", "LEGEND"];
        const rates = [50, 120, 350, 800, 2000];

        for(let i=0; i<5; i++) {
            const bal = await contracts.nft.balanceOf(address, i);
            const staked = await contracts.nft.getStakedBalance(address, i);
            totalStaked += parseInt(staked);
            dailyYield += parseInt(staked) * rates[i];

            if(bal > 0) list.innerHTML += `<div class="flex justify-between bg-gray-900 p-2 rounded mb-1 border-l-2 border-gray-600"><span class="text-xs text-white">${tiers[i]} (${bal})</span><button onclick="stakeNFT(${i})" class="text-[10px] text-neon hover:text-white">STAKE >></button></div>`;
            if(staked > 0) list.innerHTML += `<div class="flex justify-between bg-green-900/20 p-2 rounded mb-1 border-l-2 border-neon"><span class="text-xs text-neon">${tiers[i]} (STAKED)</span><button onclick="unstakeNFT(${i})" class="text-[10px] text-white hover:text-red-400"><< UNSTAKE</button></div>`;
        }
        document.getElementById('total-staked').innerText = totalStaked + " NFT";
        document.getElementById('daily-yield').innerText = dailyYield + " PBJ/d";
        const rew = await contracts.nft.getPendingRewards(address);
        document.getElementById('pending-rewards').innerText = parseFloat(ethers.utils.formatUnits(rew, 18)).toFixed(2);
    };

    document.getElementById('buyInput').addEventListener('input', (e) => {
        const v = e.target.value;
        if(v) document.getElementById('receiveInput').value = (v * 1000000).toFixed(0);
    });
    document.getElementById('buyBtn').addEventListener('click', async () => {
        if(!signer) return alert("Connect");
        try { await (await contracts.presale.buyTokens({value:ethers.utils.parseEther(document.getElementById('buyInput').value)})).wait(); alert("Bought!"); updateUI(); } catch(e){}
    });

    let target = localStorage.getItem('pEnd');
    if(!target || new Date(target) < new Date()) { target = Date.now() + 172800000; localStorage.setItem('pEnd', target); }
    setInterval(() => {
        const d = target - Date.now();
        if(d>0) {
            document.getElementById('d').innerText = Math.floor(d/86400000);
            document.getElementById('h').innerText = Math.floor((d%86400000)/3600000);
            document.getElementById('m').innerText = Math.floor((d%3600000)/60000);
            document.getElementById('s').innerText = Math.floor((d%60000)/1000);
        }
    }, 1000);
  </script>
</body>
</html>

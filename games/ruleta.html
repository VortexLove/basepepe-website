<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
  <title>Pepe Roulette - PBJ Casino</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Press+Start+2P&display=swap" rel="stylesheet" />

  <!-- CSS Frameworks -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    :root {
      --neon-green: #39ff14;
      --panel-bg: rgba(5, 10, 8, 0.9);
      --glass-border: rgba(57, 255, 20, 0.2);
      --felt-green: #0f5e38;
    }

    body { font-family: 'Inter', sans-serif; background-color: #020202; color: #e0e0e0; overflow-x: hidden; }
    .pixel-font { font-family: 'Press Start 2P', cursive; }

    /* Backgrounds */
    body::before {
      content: ""; position: fixed; inset: 0; pointer-events: none; z-index: -2;
      background: radial-gradient(circle at 50% 0%, rgba(34, 197, 94, 0.1), transparent 50%);
    }
    body::after {
      content: ""; position: fixed; inset: 0; pointer-events: none; z-index: -2;
      background-image: linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    /* Glass Panels */
    .glass-panel {
      background: var(--panel-bg);
      backdrop-filter: blur(12px);
      border: 1px solid var(--glass-border);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
    }

    /* THE WHEEL (CSS ONLY) */
    .wheel-container {
      position: relative; width: 280px; height: 280px; margin: 0 auto;
      border-radius: 50%; border: 8px solid #1a1a1a;
      box-shadow: 0 0 30px rgba(0,0,0,0.8), inset 0 0 20px rgba(0,0,0,0.5);
      overflow: hidden; transition: transform 4s cubic-bezier(0.1, 0.8, 0.1, 1);
    }
    
    @media(min-width: 768px) { .wheel-container { width: 350px; height: 350px; } }

    .wheel {
      width: 100%; height: 100%; border-radius: 50%;
      background: conic-gradient(
        #0ea5e9 0deg 9.7deg,   /* 0 Green/Blue placeholder */
        #ef4444 9.7deg 19.4deg, /* Red */
        #111 19.4deg 29.1deg,   /* Black */
        #ef4444 29.1deg 38.8deg,
        #111 38.8deg 48.5deg,
        #ef4444 48.5deg 58.2deg,
        #111 58.2deg 67.9deg,
        #ef4444 67.9deg 77.6deg,
        #111 77.6deg 87.3deg,
        #ef4444 87.3deg 97deg,
        #111 97deg 106.7deg,
        #ef4444 106.7deg 116.4deg,
        #111 116.4deg 126.1deg,
        #ef4444 126.1deg 135.8deg,
        #111 135.8deg 145.5deg,
        #ef4444 145.5deg 155.2deg,
        #111 155.2deg 164.9deg,
        #ef4444 164.9deg 174.6deg,
        #111 174.6deg 184.3deg,
        #ef4444 184.3deg 194deg,
        #111 194deg 203.7deg,
        #ef4444 203.7deg 213.4deg,
        #111 213.4deg 223.1deg,
        #ef4444 223.1deg 232.8deg,
        #111 232.8deg 242.5deg,
        #ef4444 242.5deg 252.2deg,
        #111 252.2deg 261.9deg,
        #ef4444 261.9deg 271.6deg,
        #111 271.6deg 281.3deg,
        #ef4444 281.3deg 291deg,
        #111 291deg 300.7deg,
        #ef4444 300.7deg 310.4deg,
        #111 310.4deg 320.1deg,
        #ef4444 320.1deg 329.8deg,
        #111 329.8deg 339.5deg,
        #ef4444 339.5deg 349.2deg,
        #111 349.2deg 360deg
      );
      position: relative;
    }
    
    .wheel::after {
      content: ""; position: absolute; inset: 15%; border-radius: 50%;
      background: #111; border: 2px solid #333;
      display: flex; align-items: center; justify-content: center;
      background-image: url('https://placehold.co/100x100/111/39ff14?text=PBJ');
      background-size: cover;
    }

    .ball {
      position: absolute; top: 0; left: 50%; width: 12px; height: 12px;
      background: white; border-radius: 50%; transform: translateX(-50%);
      box-shadow: 0 0 10px white; z-index: 10; margin-top: 5px;
    }
    
    .marker {
      position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
      width: 0; height: 0; 
      border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 15px solid var(--neon-green);
      z-index: 20; filter: drop-shadow(0 0 5px var(--neon-green));
    }

    /* THE BOARD */
    .roulette-board {
      display: grid; grid-template-columns: 40px repeat(3, 1fr); gap: 4px;
      background: var(--felt-green); padding: 10px; border-radius: 8px;
      border: 8px solid #3d2314; margin-top: 20px;
    }
    .cell {
      position: relative;
      height: 45px; display: flex; align-items: center; justify-content: center;
      border: 1px solid rgba(255,255,255,0.2); color: white; font-weight: bold; cursor: pointer;
      transition: background 0.2s; font-family: 'Inter'; user-select: none;
    }
    .cell:hover { background: rgba(255,255,255,0.1); }
    .cell.red { background-color: #ef4444; }
    .cell.black { background-color: #171717; }
    .cell.green { background-color: #0ea5e9; grid-row: span 12; writing-mode: vertical-rl; }
    .cell.zero { grid-row: 1 / -1; } /* 0 spans all rows */
    
    /* Chips */
    .chip-on-board {
      position: absolute; width: 20px; height: 20px; border-radius: 50%;
      background: var(--neon-green); border: 2px dashed #000;
      display: flex; align-items: center; justify-content: center;
      font-size: 8px; color: black; font-weight: bold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.5); pointer-events: none;
      animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }

    /* Action Buttons */
    .chip-btn {
      width: 40px; height: 40px; border-radius: 50%; border: 2px dashed white;
      display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer;
      transition: transform 0.2s;
    }
    .chip-btn:hover { transform: scale(1.1); }
    .chip-btn.selected { border-color: var(--neon-green); box-shadow: 0 0 10px var(--neon-green); transform: scale(1.1); }
    .bg-10 { background: #3b82f6; } .bg-50 { background: #a855f7; } .bg-100 { background: #f59e0b; } .bg-500 { background: #ef4444; }

    /* Toast */
    .toast {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.9); border: 1px solid var(--neon-green); color: white;
      padding: 10px 20px; border-radius: 20px; z-index: 100; opacity: 0; pointer-events: none;
      transition: opacity 0.3s;
    }
    .toast.show { opacity: 1; }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- Header -->
  <nav class="bg-black/80 border-b border-white/10 p-4 flex justify-between items-center sticky top-0 z-50 backdrop-blur">
    <div class="flex items-center gap-2">
      <a href="../index.html" class="text-gray-400 hover:text-white text-xs">‚Üê BACK</a>
      <span class="text-green-400 pixel-font ml-2">ROULETTE</span>
    </div>
    <div class="bg-green-900/20 border border-green-800 px-3 py-1 rounded-full text-xs text-green-400 flex items-center gap-2">
      <span>$PBJ</span>
      <span id="balance" class="font-mono font-bold">10,000</span>
    </div>
  </nav>

  <main class="flex-grow p-4 flex flex-col items-center gap-8 max-w-5xl mx-auto w-full">
    
    <!-- Game Area -->
    <div class="w-full grid md:grid-cols-2 gap-8 items-start">
      
      <!-- Left: Wheel & History -->
      <div class="flex flex-col items-center gap-6">
        <div class="marker"></div>
        <div class="wheel-container">
          <div class="wheel" id="wheel"></div>
        </div>
        
        <!-- Last Results -->
        <div class="glass-panel p-3 w-full max-w-xs">
          <p class="text-[10px] text-gray-500 uppercase text-center mb-2">Last Results</p>
          <div class="flex justify-center gap-2" id="history">
            <div class="w-8 h-8 rounded bg-gray-800 flex items-center justify-center text-xs text-gray-500">-</div>
            <div class="w-8 h-8 rounded bg-gray-800 flex items-center justify-center text-xs text-gray-500">-</div>
            <div class="w-8 h-8 rounded bg-gray-800 flex items-center justify-center text-xs text-gray-500">-</div>
            <div class="w-8 h-8 rounded bg-gray-800 flex items-center justify-center text-xs text-gray-500">-</div>
            <div class="w-8 h-8 rounded bg-gray-800 flex items-center justify-center text-xs text-gray-500">-</div>
          </div>
        </div>

        <div id="result-display" class="h-10 flex items-center justify-center">
           <span class="text-white text-xl pixel-font animate-pulse">PLACE YOUR BETS</span>
        </div>
      </div>

      <!-- Right: Board & Controls -->
      <div class="w-full">
        
        <!-- Betting Board -->
        <div class="relative overflow-x-auto">
          <div class="roulette-board min-w-[300px]" id="board">
            <!-- Generated via JS -->
          </div>
        </div>

        <!-- Side Bets -->
        <div class="grid grid-cols-2 gap-2 mt-2">
          <button class="cell red rounded h-10" onclick="placeSideBet('red')">RED</button>
          <button class="cell black rounded h-10" onclick="placeSideBet('black')">BLACK</button>
          <button class="cell bg-gray-800 rounded h-10 hover:bg-gray-700" onclick="placeSideBet('even')">EVEN</button>
          <button class="cell bg-gray-800 rounded h-10 hover:bg-gray-700" onclick="placeSideBet('odd')">ODD</button>
        </div>

        <!-- Controls -->
        <div class="glass-panel p-4 mt-6">
          <div class="flex justify-between items-center mb-4">
             <div class="text-xs text-gray-400">Current Bet: <span id="current-bet" class="text-white font-bold">0</span></div>
             <button onclick="clearBets()" class="text-[10px] text-red-400 hover:text-red-300 border border-red-900 px-2 py-1 rounded">CLEAR</button>
          </div>
          
          <div class="flex justify-center gap-4 mb-6">
            <div class="chip-btn bg-10 selected" onclick="selectChip(10, this)">10</div>
            <div class="chip-btn bg-50" onclick="selectChip(50, this)">50</div>
            <div class="chip-btn bg-100" onclick="selectChip(100, this)">100</div>
            <div class="chip-btn bg-500" onclick="selectChip(500, this)">500</div>
          </div>

          <button id="spin-btn" onclick="spin()" class="w-full bg-green-600 hover:bg-green-500 text-black font-bold py-4 rounded pixel-font text-sm shadow-[0_4px_0_#064e3b] active:translate-y-1 active:shadow-none transition-all">
            SPIN WHEEL
          </button>
        </div>

      </div>
    </div>
  </main>

  <div id="toast" class="toast">Message</div>

  <script>
    /* --- CONFIG --- */
    const WHEEL_NUMBERS = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
    // Map numbers to standard roulette colors
    const RED_NUMBERS = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
    
    let balance = 10000;
    let currentBets = {}; // { "17": 100, "red": 50 }
    let totalBet = 0;
    let selectedChip = 10;
    let isSpinning = false;

    /* --- INIT BOARD --- */
    const board = document.getElementById('board');
    
    // 0 Cell (Vertical span)
    const zero = document.createElement('div');
    zero.className = "cell green zero";
    zero.textContent = "0";
    zero.onclick = () => placeBet("0", zero);
    board.appendChild(zero);

    // Numbers 1-36
    // Roulette grid logic: Column 1 = 1,4,7... Column 2 = 2,5,8...
    // But HTML Grid fills row by row. We need 3 columns.
    // Row 1: 3, 6, 9 ... 36 (Top row in physical board usually)
    // Row 2: 2, 5, 8 ... 35
    // Row 3: 1, 4, 7 ... 34
    // To make it simple for HTML Grid (Left to Right, Top to Bottom):
    // We will just render 1-36 sequentially but styled as 3 columns.
    // Actually, standard HTML grid flows 1, 2, 3 then new row.
    // Let's do standard: 1, 2, 3.
    
    for(let i=1; i<=36; i++) {
      const cell = document.createElement('div');
      cell.className = `cell ${RED_NUMBERS.includes(i) ? 'red' : 'black'}`;
      cell.textContent = i;
      cell.onclick = () => placeBet(i.toString(), cell);
      board.appendChild(cell);
    }

    /* --- GAME LOGIC --- */
    function selectChip(val, el) {
      selectedChip = val;
      document.querySelectorAll('.chip-btn').forEach(b => b.classList.remove('selected'));
      el.classList.add('selected');
    }

    function placeBet(key, element) {
      if(isSpinning) return;
      
      if(balance < selectedChip) {
        showToast("Insufficient Funds!", "error");
        return;
      }

      // Logic
      balance -= selectedChip;
      totalBet += selectedChip;
      currentBets[key] = (currentBets[key] || 0) + selectedChip;
      
      // UI Update
      updateUI();
      
      // Visual Chip
      addChipVisual(element);
    }

    function placeSideBet(type) {
      // Find button visual later if needed, for now just logic
      if(isSpinning) return;
      if(balance < selectedChip) return showToast("No money!", "error");
      
      balance -= selectedChip;
      totalBet += selectedChip;
      currentBets[type] = (currentBets[type] || 0) + selectedChip;
      updateUI();
      showToast(`Bet ${selectedChip} on ${type.toUpperCase()}`);
    }

    function addChipVisual(target) {
      // Remove existing chip visual to prevent stacking overflow visually
      const old = target.querySelector('.chip-on-board');
      if(old) old.remove();

      const chip = document.createElement('div');
      chip.className = "chip-on-board";
      chip.textContent = currentBets[target.textContent];
      target.appendChild(chip);
    }

    function clearBets() {
      if(isSpinning) return;
      // Refund
      balance += totalBet;
      totalBet = 0;
      currentBets = {};
      updateUI();
      document.querySelectorAll('.chip-on-board').forEach(c => c.remove());
    }

    function updateUI() {
      document.getElementById('balance').textContent = balance.toLocaleString();
      document.getElementById('current-bet').textContent = totalBet.toLocaleString();
    }

    /* --- SPINNING --- */
    function spin() {
      if(isSpinning) return;
      if(totalBet === 0) return showToast("Place a bet first!");

      isSpinning = true;
      document.getElementById('spin-btn').disabled = true;
      document.getElementById('spin-btn').classList.add('opacity-50');
      document.getElementById('result-display').innerHTML = '<span class="text-yellow-400 pixel-font">SPINNING...</span>';

      // 1. Determine Winner
      const randomIndex = Math.floor(Math.random() * WHEEL_NUMBERS.length);
      const winningNumber = WHEEL_NUMBERS[randomIndex];
      
      // 2. Calculate Rotation
      // Each slice is 360 / 37 = ~9.73 degrees
      const sliceDeg = 360 / 37;
      // We want the winning number at the TOP (Marker).
      // Current index 0 (0) is at 0deg.
      // To get index N to top, we rotate backwards (or negative) by N * sliceDeg.
      // Add extra rotations for effect (e.g., 5 full spins = 1800deg).
      const extraSpins = 360 * 5; 
      const targetRotation = extraSpins + (randomIndex * sliceDeg);
      
      // Apply CSS Transform
      // Note: We rotate NEGATIVE to simulate clockwise spin of wheel vs marker
      const wheel = document.getElementById('wheel');
      wheel.style.transition = "transform 4s cubic-bezier(0.1, 0.8, 0.1, 1)";
      wheel.style.transform = `rotate(-${targetRotation}deg)`;

      // 3. End Game Trigger
      setTimeout(() => {
        resolveGame(winningNumber);
      }, 4000);
    }

    function resolveGame(winNum) {
      isSpinning = false;
      document.getElementById('spin-btn').disabled = false;
      document.getElementById('spin-btn').classList.remove('opacity-50');

      // Reset wheel visual (trick to prevent infinite rotation buildup)
      const wheel = document.getElementById('wheel');
      wheel.style.transition = "none";
      const sliceDeg = 360 / 37;
      const finalPos = WHEEL_NUMBERS.indexOf(winNum) * sliceDeg;
      wheel.style.transform = `rotate(-${finalPos}deg)`;

      // Calculate Winnings
      let winnings = 0;
      const winColor = winNum === 0 ? 'green' : RED_NUMBERS.includes(winNum) ? 'red' : 'black';
      const winEven = winNum !== 0 && winNum % 2 === 0;
      const winOdd = winNum !== 0 && winNum % 2 !== 0;

      // Bets Loop
      for (const [key, amount] of Object.entries(currentBets)) {
        // Straight up
        if (key === winNum.toString()) winnings += amount * 36; // 35:1 + stake returned logic (simplified 36)
        
        // Colors
        if (key === 'red' && winColor === 'red') winnings += amount * 2;
        if (key === 'black' && winColor === 'black') winnings += amount * 2;

        // Even/Odd
        if (key === 'even' && winEven) winnings += amount * 2;
        if (key === 'odd' && winOdd) winnings += amount * 2;
      }

      // Result Display
      const colorClass = winColor === 'red' ? 'text-red-500' : winColor === 'black' ? 'text-gray-400' : 'text-green-500';
      document.getElementById('result-display').innerHTML = `<span class="${colorClass} text-2xl pixel-font font-bold">${winNum}</span>`;

      if (winnings > 0) {
        balance += winnings;
        showToast(`YOU WON ${winnings} PBJ!`);
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
      } else {
        showToast("No luck this time.");
      }

      // Update History
      addToHistory(winNum, winColor);
      
      // Clear Board visual (bets stay in memory? usually casino clears table. let's clear)
      currentBets = {};
      totalBet = 0;
      document.querySelectorAll('.chip-on-board').forEach(c => c.remove());
      updateUI();
    }

    function addToHistory(num, color) {
      const container = document.getElementById('history');
      const el = document.createElement('div');
      el.className = `w-8 h-8 rounded flex items-center justify-center text-xs font-bold shrink-0 text-white ${color === 'red' ? 'bg-red-600' : color === 'black' ? 'bg-gray-800' : 'bg-green-600'}`;
      el.textContent = num;
      
      // Add to front, remove last
      container.prepend(el);
      if(container.children.length > 5) container.lastElementChild.remove();
    }

    function showToast(msg, type="neutral") {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.style.borderColor = type === "error" ? "#ef4444" : "#39ff14";
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 3000);
    }

    // Init UI
    updateUI();

  </script>
</body>
</html>

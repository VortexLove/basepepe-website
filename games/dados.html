<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
  <title>Pepe Dice - PBJ Casino</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Press+Start+2P&display=swap" rel="stylesheet" />

  <!-- Frameworks -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    :root {
      --neon-green: #39ff14;
      --panel-bg: rgba(8, 12, 10, 0.95);
      --glass-border: rgba(57, 255, 20, 0.2);
      --track-bg: #1f2937;
    }

    body { font-family: 'Inter', sans-serif; background-color: #020202; color: #e0e0e0; overflow-x: hidden; }
    .pixel-font { font-family: 'Press Start 2P', cursive; }

    /* Background */
    body::before {
      content: ""; position: fixed; inset: 0; pointer-events: none; z-index: -2;
      background: radial-gradient(circle at 80% 20%, rgba(34, 197, 94, 0.08), transparent 50%),
                  radial-gradient(circle at 20% 80%, rgba(37, 99, 235, 0.08), transparent 50%);
    }

    /* Glass Panels */
    .glass-panel {
      background: var(--panel-bg);
      backdrop-filter: blur(12px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
    }

    /* CUSTOM SLIDER */
    .dice-track-container {
      position: relative; height: 60px; width: 100%;
      background: #111; border-radius: 8px;
      padding: 4px; border: 1px solid #333;
      overflow: hidden;
    }
    
    .dice-track {
      position: relative; height: 100%; width: 100%;
      background: #222; border-radius: 6px;
      overflow: hidden;
    }

    /* The Win/Lose Areas */
    .zone-win {
      position: absolute; height: 100%; top: 0;
      background: var(--neon-green); opacity: 0.2; transition: all 0.2s;
    }
    .zone-lose {
      position: absolute; height: 100%; top: 0;
      background: #ef4444; opacity: 0.2; transition: all 0.2s;
    }

    /* The Draggable Handle */
    .slider-handle {
      position: absolute; top: 0; bottom: 0; width: 20px;
      background: #fff; border-radius: 4px;
      box-shadow: 0 0 15px rgba(255,255,255,0.5);
      cursor: grab; z-index: 20; transform: translateX(-50%);
      display: flex; align-items: center; justify-content: center;
    }
    .slider-handle::after {
      content: "↔"; color: #000; font-size: 10px; font-weight: bold;
    }
    .slider-handle:active { cursor: grabbing; background: var(--neon-green); }

    /* The Result Dice Icon */
    .dice-result {
      position: absolute; top: 50%; transform: translate(-50%, -50%);
      width: 40px; height: 40px; background: #fff;
      border: 3px solid #000; border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-weight: bold; color: #000; z-index: 15;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      transition: left 0.5s cubic-bezier(0.25, 1, 0.5, 1), opacity 0.2s;
      opacity: 0;
    }
    .dice-result.show { opacity: 1; }
    .dice-result.win { background: var(--neon-green); border-color: #fff; box-shadow: 0 0 20px var(--neon-green); }
    .dice-result.lose { background: #ef4444; border-color: #fff; color: white; }

    /* Controls */
    .action-btn {
      background: linear-gradient(135deg, #22c55e 0%, #15803d 100%);
      box-shadow: 0 4px 0 #064e3b; transition: all 0.1s;
    }
    .action-btn:active { transform: translateY(4px); box-shadow: 0 0 0 transparent; }
    .action-btn:disabled { filter: grayscale(1); opacity: 0.6; cursor: not-allowed; }

    .toggle-btn {
      background: #1f2937; border: 1px solid #374151; color: #9ca3af;
    }
    .toggle-btn.active {
      background: #064e3b; border-color: var(--neon-green); color: var(--neon-green);
    }

    /* History Bar */
    .history-pill {
      width: 50px; text-align: center; padding: 4px 0; border-radius: 4px; font-size: 10px; font-family: monospace;
      background: #1f2937; color: #9ca3af; transition: transform 0.2s;
    }
    .history-pill.win { background: rgba(57, 255, 20, 0.1); color: var(--neon-green); border: 1px solid rgba(57, 255, 20, 0.3); }
    .history-pill.lose { background: rgba(239, 68, 68, 0.1); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.3); }
    
    /* Toast */
    .toast {
      position: fixed; top: 100px; right: 20px; z-index: 99;
      background: rgba(0,0,0,0.9); border-left: 4px solid var(--neon-green);
      padding: 10px 20px; border-radius: 4px; opacity: 0; pointer-events: none;
      transition: opacity 0.3s;
    }
    .toast.show { opacity: 1; }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- Header -->
  <nav class="bg-black/90 border-b border-white/10 p-3 flex justify-between items-center sticky top-0 z-50 backdrop-blur">
    <div class="flex items-center gap-2">
      <a href="../index.html" class="text-gray-400 hover:text-white text-xs pixel-font">← BACK</a>
      <span class="text-green-400 pixel-font ml-2 text-xs md:text-sm">CYBER DICE</span>
    </div>
    <div class="bg-green-900/20 border border-green-800 px-3 py-1 rounded-full text-xs text-green-400 flex items-center gap-2">
      <span>$PBJ</span>
      <span id="balance" class="font-mono font-bold">10,000</span>
    </div>
  </nav>

  <main class="flex-grow p-4 flex flex-col items-center justify-center gap-8 w-full max-w-4xl mx-auto">

    <!-- Game Display -->
    <div class="w-full glass-panel p-6 md:p-10 relative">
      
      <!-- Main Number -->
      <div class="text-center mb-8 relative">
        <div id="main-display" class="text-6xl md:text-8xl font-bold text-white font-mono tracking-tighter">50.00</div>
        <div class="text-xs text-gray-500 mt-2 pixel-font">ROLL RESULT</div>
      </div>

      <!-- The Slider Track -->
      <div class="dice-track-container mb-4" id="track-container">
        <div class="dice-track">
           <!-- Zones are width-controlled by JS -->
           <div id="zone-left" class="zone-lose" style="width: 50%; left: 0;"></div>
           <div id="zone-right" class="zone-win" style="width: 50%; right: 0;"></div>
           
           <!-- Rulers -->
           <div class="absolute bottom-0 w-full flex justify-between px-2 text-[9px] text-gray-500 font-mono pointer-events-none">
             <span>0</span><span>25</span><span>50</span><span>75</span><span>100</span>
           </div>

           <!-- Handle -->
           <div id="slider-handle" class="slider-handle" style="left: 50%;"></div>
           
           <!-- Result Ball -->
           <div id="result-ball" class="dice-result">00</div>
        </div>
      </div>

      <!-- Stats Row -->
      <div class="grid grid-cols-3 gap-4 bg-black/40 rounded-lg p-4 border border-gray-800">
        <div class="text-center">
          <p class="text-[10px] text-gray-500 uppercase">Multiplier</p>
          <p id="stat-multiplier" class="text-xl font-bold text-green-400">2.00x</p>
        </div>
        <div class="text-center border-x border-gray-700">
          <p class="text-[10px] text-gray-500 uppercase">Roll <span id="stat-direction">Over</span></p>
          <p id="stat-target" class="text-xl font-bold text-white">50.00</p>
        </div>
        <div class="text-center">
          <p class="text-[10px] text-gray-500 uppercase">Win Chance</p>
          <p id="stat-chance" class="text-xl font-bold text-blue-400">49.5%</p>
        </div>
      </div>

    </div>

    <!-- Controls -->
    <div class="w-full glass-panel p-5 flex flex-col gap-5">
      
      <!-- Top Row: Bet & Direction -->
      <div class="grid md:grid-cols-2 gap-5">
        
        <!-- Bet Input -->
        <div class="bg-black/60 border border-gray-700 rounded-lg p-1 flex items-center">
           <span class="text-xs text-gray-500 px-3 font-bold">BET</span>
           <input type="number" id="betAmount" value="100" class="bg-transparent text-white w-full h-10 outline-none font-mono font-bold">
           <div class="flex gap-1 pr-1">
             <button onclick="adjustBet(0.5)" class="bg-gray-800 hover:bg-gray-700 text-gray-300 text-[10px] px-2 py-1 rounded">½</button>
             <button onclick="adjustBet(2)" class="bg-gray-800 hover:bg-gray-700 text-gray-300 text-[10px] px-2 py-1 rounded">2x</button>
           </div>
        </div>

        <!-- Roll Mode Toggle -->
        <div class="flex bg-black/60 border border-gray-700 rounded-lg p-1">
           <button onclick="setMode('under')" id="btn-under" class="toggle-btn flex-1 rounded py-2 text-xs font-bold transition-all">ROLL UNDER</button>
           <button onclick="setMode('over')" id="btn-over" class="toggle-btn active flex-1 rounded py-2 text-xs font-bold transition-all">ROLL OVER</button>
        </div>
      </div>
      
      <!-- Profit Preview -->
      <div class="flex justify-between items-center text-xs px-2">
        <span class="text-gray-400">Profit on Win</span>
        <span id="profit-display" class="text-green-400 font-bold font-mono text-sm">+100.00 PBJ</span>
      </div>

      <!-- Roll Button -->
      <button id="roll-btn" class="action-btn w-full py-4 rounded-xl text-white font-bold text-sm pixel-font tracking-widest shadow-lg active:shadow-none active:translate-y-1">
        ROLL DICE
      </button>
    </div>

    <!-- History -->
    <div class="w-full overflow-hidden">
      <div class="flex gap-2 overflow-x-auto pb-2" id="history-bar">
        <!-- History items injected here -->
        <div class="history-pill">Start</div>
      </div>
    </div>

  </main>

  <div id="toast" class="toast">Message</div>

  <script>
    /* --- CONFIG --- */
    let balance = 10000;
    let bet = 100;
    let target = 50; // 0 to 100
    let mode = 'over'; // 'over' or 'under'
    let isRolling = false;
    const HOUSE_EDGE = 1; // 1%

    /* --- UI REFERENCES --- */
    const els = {
      balance: document.getElementById('balance'),
      mainDisplay: document.getElementById('main-display'),
      betInput: document.getElementById('betAmount'),
      handle: document.getElementById('slider-handle'),
      track: document.getElementById('track-container'),
      zoneLeft: document.getElementById('zone-left'),
      zoneRight: document.getElementById('zone-right'),
      ball: document.getElementById('result-ball'),
      btnOver: document.getElementById('btn-over'),
      btnUnder: document.getElementById('btn-under'),
      rollBtn: document.getElementById('roll-btn'),
      stats: {
        mult: document.getElementById('stat-multiplier'),
        target: document.getElementById('stat-target'),
        chance: document.getElementById('stat-chance'),
        dir: document.getElementById('stat-direction')
      },
      profit: document.getElementById('profit-display'),
      history: document.getElementById('history-bar')
    };

    /* --- INITIALIZATION --- */
    function init() {
      updateMath();
      setupSlider();
      updateUI();
    }

    /* --- LOGIC & MATH --- */
    function updateMath() {
      // 1. Calculate Win Chance
      let winChance;
      if (mode === 'over') {
        // Roll Over X. Range is 0-100.
        // If target is 50, we win on 50.01 - 100.
        // Chance = 100 - target
        winChance = 100 - target;
      } else {
        // Roll Under X.
        // If target is 50, we win on 0 - 49.99.
        // Chance = target
        winChance = target;
      }
      
      // Clamp chance for safety (house limits usually 2% - 98%)
      if(winChance < 2) winChance = 2;
      if(winChance > 98) winChance = 98;

      // 2. Calculate Multiplier
      // Standard Formula: (100 - Edge) / Chance
      const multiplier = (100 - HOUSE_EDGE) / winChance;
      
      // 3. Calculate Profit
      bet = parseFloat(els.betInput.value) || 0;
      const profit = (bet * multiplier) - bet;

      // Update Text
      els.stats.mult.textContent = multiplier.toFixed(4) + "x";
      els.stats.chance.textContent = winChance.toFixed(2) + "%";
      els.stats.target.textContent = target.toFixed(0); // Using Int for cleaner UI slider
      els.stats.dir.textContent = mode === 'over' ? "Over" : "Under";
      els.profit.textContent = `+${profit.toFixed(2)} PBJ`;
      
      // Update Slider Colors
      // Slider represents 0 to 100. Target is the split point.
      const pct = target + "%";
      els.handle.style.left = pct;
      
      if (mode === 'over') {
        // Left is Lose (Red), Right is Win (Green)
        els.zoneLeft.className = "zone-lose"; els.zoneLeft.style.width = pct;
        els.zoneRight.className = "zone-win"; els.zoneRight.style.width = (100 - target) + "%";
      } else {
        // Left is Win (Green), Right is Lose (Red)
        els.zoneLeft.className = "zone-win"; els.zoneLeft.style.width = pct;
        els.zoneRight.className = "zone-lose"; els.zoneRight.style.width = (100 - target) + "%";
      }
    }

    function setMode(newMode) {
      mode = newMode;
      if(mode === 'over') {
        els.btnOver.classList.add('active');
        els.btnUnder.classList.remove('active');
      } else {
        els.btnUnder.classList.add('active');
        els.btnOver.classList.remove('active');
      }
      // Flip target for UX? e.g. if on 80 over (20% chance), switch to 20 under (20% chance)?
      // For now, keep target static, just flip logic.
      updateMath();
    }

    function adjustBet(factor) {
      let val = parseFloat(els.betInput.value);
      val = val * factor;
      if(val < 1) val = 1;
      els.betInput.value = val.toFixed(0);
      updateMath();
    }

    /* --- SLIDER INTERACTION --- */
    function setupSlider() {
      let isDragging = false;

      const onMove = (clientX) => {
        if (!isDragging) return;
        const rect = els.track.getBoundingClientRect();
        let x = clientX - rect.left;
        let pct = (x / rect.width) * 100;
        
        // Clamp 2-98
        if (pct < 2) pct = 2;
        if (pct > 98) pct = 98;
        
        target = Math.round(pct); // Integer steps
        updateMath();
      };

      const onStart = (e) => { isDragging = true; onMove(e.touches ? e.touches[0].clientX : e.clientX); };
      const onEnd = () => { isDragging = false; };

      els.track.addEventListener('mousedown', onStart);
      els.track.addEventListener('mousemove', e => onMove(e.clientX));
      document.addEventListener('mouseup', onEnd);

      els.track.addEventListener('touchstart', onStart);
      els.track.addEventListener('touchmove', e => onMove(e.touches[0].clientX));
      document.addEventListener('touchend', onEnd);
    }

    els.betInput.addEventListener('input', updateMath);

    /* --- GAMEPLAY --- */
    els.rollBtn.addEventListener('click', rollDice);

    function rollDice() {
      if(isRolling) return;
      if(balance < bet) return showToast("Insufficient Funds!", "error");

      // Deduct
      balance -= bet;
      isRolling = true;
      updateUI();
      
      // Visuals
      els.rollBtn.disabled = true;
      els.ball.classList.remove('show', 'win', 'lose'); // Hide ball
      
      // Scramble Number Effect
      let scrambleCount = 0;
      const interval = setInterval(() => {
        els.mainDisplay.textContent = (Math.random() * 100).toFixed(2);
        scrambleCount++;
        if(scrambleCount > 15) {
          clearInterval(interval);
          finalizeRoll();
        }
      }, 40);
    }

    function finalizeRoll() {
      // Generate Result (0.00 to 100.00)
      const result = (Math.random() * 100);
      const resultFixed = result.toFixed(2);
      
      // Determine Win
      let isWin = false;
      if (mode === 'over') isWin = result > target;
      else isWin = result < target;

      // Calculate Payout
      let payout = 0;
      if (isWin) {
        const multiplier = parseFloat(els.stats.mult.textContent);
        payout = bet * multiplier;
        balance += payout;
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors:['#39ff14','#fff'] });
        showToast(`WIN: +${payout.toFixed(2)} PBJ`, "success");
      }

      // Update Visuals
      els.mainDisplay.textContent = resultFixed;
      els.mainDisplay.style.color = isWin ? "#39ff14" : "#ef4444";
      
      // Move Ball
      els.ball.style.left = result + "%";
      els.ball.textContent = Math.floor(result);
      els.ball.className = `dice-result show ${isWin ? 'win' : 'lose'}`;

      // Reset State
      isRolling = false;
      els.rollBtn.disabled = false;
      updateUI();
      addToHistory(resultFixed, isWin);
    }

    /* --- HISTORY --- */
    function addToHistory(val, win) {
      const pill = document.createElement('div');
      pill.className = `history-pill ${win ? 'win' : 'lose'} shrink-0 animate-pulse`;
      pill.textContent = val;
      
      // Remove anim class after render
      setTimeout(() => pill.classList.remove('animate-pulse'), 500);
      
      els.history.prepend(pill);
      if(els.history.children.length > 20) els.history.lastElementChild.remove();
    }

    /* --- UTILS --- */
    function updateUI() {
      els.balance.textContent = Math.floor(balance).toLocaleString();
    }

    function showToast(msg, type="neutral") {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.style.borderColor = type === "error" ? "#ef4444" : "#39ff14";
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 2000);
    }

    // Start
    init();

  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
  <title>Pepe Keno - PBJ Casino</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Press+Start+2P&display=swap" rel="stylesheet" />

  <!-- Frameworks -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    :root {
      --neon-green: #39ff14;
      --neon-purple: #a855f7;
      --panel-bg: rgba(5, 10, 8, 0.95);
      --glass-border: rgba(57, 255, 20, 0.2);
      --tile-bg: #1f2937;
    }

    body { font-family: 'Inter', sans-serif; background-color: #020202; color: #e0e0e0; overflow-x: hidden; }
    .pixel-font { font-family: 'Press Start 2P', cursive; }

    /* Background */
    body::before {
      content: ""; position: fixed; inset: 0; pointer-events: none; z-index: -2;
      background: radial-gradient(circle at 80% 20%, rgba(168, 85, 247, 0.08), transparent 50%),
                  radial-gradient(circle at 20% 80%, rgba(34, 197, 94, 0.08), transparent 50%);
    }

    /* Glass Panels */
    .glass-panel {
      background: var(--panel-bg);
      backdrop-filter: blur(12px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
    }

    /* KENO GRID */
    .keno-grid {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 6px;
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
    }

    .k-tile {
      aspect-ratio: 1/1;
      background: var(--tile-bg);
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; font-weight: bold; color: #9ca3af;
      cursor: pointer; transition: all 0.15s;
      border: 1px solid transparent;
      box-shadow: 0 2px 0 #111827;
    }

    @media(min-width: 640px) { .k-tile { font-size: 14px; gap: 8px; } }

    .k-tile:hover:not(:disabled) { background: #374151; transform: translateY(-2px); }
    
    /* States */
    .k-tile.selected {
      background: #581c87; color: white; border-color: var(--neon-purple);
      box-shadow: 0 0 10px rgba(168, 85, 247, 0.4);
      transform: translateY(-1px);
    }

    .k-tile.hit {
      background: #064e3b; color: var(--neon-green); border-color: var(--neon-green);
      box-shadow: 0 0 15px var(--neon-green);
      animation: pop 0.3s;
    }

    .k-tile.miss {
      opacity: 0.5; background: #333;
    }
    
    .k-tile.drawn-not-selected {
      background: #374151; color: white; border: 1px solid #4b5563;
    }

    @keyframes pop { 0% { transform: scale(0.8); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }

    /* PAYOUT BAR */
    .payout-bar {
      display: flex; gap: 4px; overflow-x: auto; padding: 10px 0;
      mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
    }
    .pay-box {
      min-width: 50px; text-align: center; padding: 6px; background: #111;
      border-radius: 6px; border: 1px solid #333; opacity: 0.5; transition: all 0.3s;
    }
    .pay-box.active {
      opacity: 1; border-color: var(--neon-green); background: #064e3b; transform: scale(1.1);
    }
    .pay-box .x { font-size: 10px; color: #9ca3af; }
    .pay-box .val { font-size: 12px; font-weight: bold; color: white; }

    /* Controls */
    .action-btn {
      background: linear-gradient(135deg, #22c55e 0%, #15803d 100%);
      box-shadow: 0 4px 0 #064e3b; transition: all 0.1s;
    }
    .action-btn:active { transform: translateY(4px); box-shadow: 0 0 0 transparent; }
    .action-btn:disabled { filter: grayscale(1); opacity: 0.6; cursor: not-allowed; }

    .secondary-btn {
      background: #1f2937; border: 1px solid #374151; color: #e5e7eb;
    }
    .secondary-btn:hover { background: #374151; }

    /* Toast */
    .toast {
      position: fixed; top: 100px; right: 20px; z-index: 99;
      background: rgba(0,0,0,0.9); border-left: 4px solid var(--neon-green);
      padding: 10px 20px; border-radius: 4px; opacity: 0; pointer-events: none;
      transition: opacity 0.3s; color: white; font-size: 12px;
    }
    .toast.show { opacity: 1; transform: translateY(10px); }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- Header -->
  <nav class="bg-black/90 border-b border-white/10 p-3 flex justify-between items-center sticky top-0 z-50 backdrop-blur">
    <div class="flex items-center gap-2">
      <a href="../index.html" class="text-gray-400 hover:text-white text-xs pixel-font">← BACK</a>
      <span class="text-purple-400 pixel-font ml-2 text-xs md:text-sm">PEPE KENO</span>
    </div>
    <div class="bg-purple-900/20 border border-purple-800 px-3 py-1 rounded-full text-xs text-purple-400 flex items-center gap-2">
      <span>$PBJ</span>
      <span id="balance" class="font-mono font-bold">10,000</span>
    </div>
  </nav>

  <main class="flex-grow p-4 flex flex-col items-center justify-center gap-6 w-full max-w-5xl mx-auto">

    <div class="w-full grid md:grid-cols-12 gap-8 items-start">
      
      <!-- LEFT: Grid (8 cols) -->
      <div class="md:col-span-8 w-full order-2 md:order-1">
        
        <!-- Live Info -->
        <div class="flex justify-between items-end mb-4 px-2">
          <div>
            <p class="text-[10px] text-gray-500 uppercase">Numbers Selected</p>
            <p class="text-white font-bold"><span id="sel-count">0</span> / 10</p>
          </div>
          <div class="text-right">
            <p class="text-[10px] text-gray-500 uppercase">Potential Win</p>
            <p class="text-green-400 font-bold text-xl" id="max-win">0.00</p>
          </div>
        </div>

        <!-- The Grid -->
        <div class="keno-grid" id="grid">
          <!-- Generated JS -->
        </div>

        <!-- Payout Table -->
        <div class="mt-6">
          <p class="text-[10px] text-gray-500 uppercase mb-2">Payouts (Hits)</p>
          <div class="payout-bar" id="payout-container">
             <div class="text-xs text-gray-600 p-2">Select numbers to see payouts</div>
          </div>
        </div>

      </div>

      <!-- RIGHT: Controls (4 cols) -->
      <div class="md:col-span-4 w-full glass-panel p-5 flex flex-col gap-5 order-1 md:order-2">
        
        <div class="text-center md:text-left">
           <h2 class="text-lg text-white font-bold pixel-font">CONTROLS</h2>
        </div>

        <!-- Risk Select -->
        <div>
          <label class="text-[10px] text-gray-400 uppercase font-bold mb-2 block">Risk Level</label>
          <select id="risk-select" onchange="updatePayouts()" class="w-full bg-black/60 border border-gray-700 text-white text-sm rounded-lg p-2.5 outline-none focus:border-purple-500">
            <option value="classic">Classic</option>
            <option value="low">Low Risk</option>
            <option value="high">High Risk</option>
          </select>
        </div>

        <!-- Bet Input -->
        <div class="bg-black/60 border border-gray-700 rounded-lg p-2 flex items-center">
           <span class="text-[10px] text-gray-500 uppercase font-bold w-10">Bet</span>
           <input type="number" id="betAmount" value="100" class="bg-transparent text-white w-full outline-none font-mono font-bold text-sm">
           <div class="flex gap-1">
             <button onclick="adjustBet(0.5)" class="bg-gray-800 text-[10px] px-2 rounded hover:bg-gray-700 text-gray-300">½</button>
             <button onclick="adjustBet(2)" class="bg-gray-800 text-[10px] px-2 rounded hover:bg-gray-700 text-gray-300">2x</button>
           </div>
        </div>

        <!-- Quick Pick Buttons -->
        <div class="grid grid-cols-2 gap-2">
          <button onclick="autoPick()" class="secondary-btn py-2 rounded text-xs font-bold">AUTO PICK</button>
          <button onclick="clearSelection()" class="secondary-btn py-2 rounded text-xs font-bold text-red-400">CLEAR</button>
        </div>

        <!-- Play Button -->
        <button id="play-btn" class="action-btn w-full py-4 rounded-xl text-white font-bold text-sm pixel-font tracking-widest shadow-lg active:shadow-none active:translate-y-1">
          PLAY KENO
        </button>

      </div>

    </div>

  </main>

  <div id="toast" class="toast">Message</div>

  <script>
    /* --- CONFIG --- */
    const NUMBERS_COUNT = 40;
    const DRAW_COUNT = 10;
    const MAX_SELECT = 10;
    
    let balance = 10000;
    let selected = new Set();
    let isPlaying = false;
    
    // Simplified Payout Multipliers (Risk: High/Classic/Low)
    // Index = Number of Hits. 
    // Example: If you pick 3 numbers: index 0, 1, 2, 3 hits.
    const PAYOUTS = {
      classic: {
        1: [0, 3.5],
        2: [0, 1.5, 4.5],
        3: [0, 1, 2.5, 15],
        4: [0, 0, 2, 5, 25],
        5: [0, 0, 1.5, 4, 12, 50],
        6: [0, 0, 0, 3, 9, 30, 100],
        7: [0, 0, 0, 1, 6, 15, 60, 200],
        8: [0, 0, 0, 0, 4, 10, 35, 100, 400],
        9: [0, 0, 0, 0, 2, 8, 20, 80, 300, 800],
        10:[0, 0, 0, 0, 0, 5, 15, 50, 150, 500, 1000]
      },
      high: {
        // Volatile: pay 0 for low hits, massive for high
        10:[0,0,0,0,0,0,10,80,300,1000,5000] 
        // (Simplified for demo, falls back to classic if key missing)
      },
      low: {
        // Safer: pays back bet easier
        10:[0,0,1,1,2,3,5,10,30,100,200]
      }
    };

    /* --- UI ELEMENTS --- */
    const ui = {
      grid: document.getElementById('grid'),
      count: document.getElementById('sel-count'),
      payouts: document.getElementById('payout-container'),
      btn: document.getElementById('play-btn'),
      bet: document.getElementById('betAmount'),
      risk: document.getElementById('risk-select'),
      balance: document.getElementById('balance'),
      maxWin: document.getElementById('max-win')
    };

    /* --- INIT --- */
    function init() {
      ui.grid.innerHTML = '';
      for(let i=1; i<=NUMBERS_COUNT; i++) {
        const tile = document.createElement('div');
        tile.className = 'k-tile';
        tile.id = `tile-${i}`;
        tile.textContent = i;
        tile.onclick = () => toggleNum(i);
        ui.grid.appendChild(tile);
      }
      updateBalance();
    }

    /* --- GAMEPLAY LOGIC --- */
    function toggleNum(n) {
      if(isPlaying) return;
      
      const tile = document.getElementById(`tile-${n}`);
      if(selected.has(n)) {
        selected.delete(n);
        tile.classList.remove('selected');
      } else {
        if(selected.size >= MAX_SELECT) return showToast("Max 10 numbers", "error");
        selected.add(n);
        tile.classList.add('selected');
      }
      updateUI();
    }

    function autoPick() {
      if(isPlaying) return;
      clearSelection();
      const count = Math.floor(Math.random() * 6) + 4; // 4 to 10 random numbers
      while(selected.size < count) {
        const n = Math.floor(Math.random() * NUMBERS_COUNT) + 1;
        if(!selected.has(n)) toggleNum(n);
      }
    }

    function clearSelection() {
      if(isPlaying) return;
      selected.forEach(n => document.getElementById(`tile-${n}`).classList.remove('selected'));
      selected.clear();
      updateUI();
    }

    function updateUI() {
      ui.count.textContent = selected.size;
      updatePayouts();
    }

    function updatePayouts() {
      const risk = ui.risk.value;
      const count = selected.size;
      const betVal = parseFloat(ui.bet.value) || 0;
      
      ui.payouts.innerHTML = '';
      
      if(count === 0) {
        ui.payouts.innerHTML = '<div class="text-xs text-gray-600 p-2">Pick numbers...</div>';
        ui.maxWin.textContent = "0.00";
        return;
      }

      // Get Table (Fallback to classic if risk table missing for specific count)
      let table = (PAYOUTS[risk] && PAYOUTS[risk][count]) ? PAYOUTS[risk][count] : PAYOUTS['classic'][count];
      if(!table) table = PAYOUTS['classic'][count]; // Safety

      // Render Bar
      table.forEach((mult, hits) => {
        const box = document.createElement('div');
        box.className = 'pay-box';
        box.id = `pay-${hits}`;
        box.innerHTML = `<div class="x">${hits}x</div><div class="val">${mult}x</div>`;
        ui.payouts.appendChild(box);
      });
      
      const maxMult = table[table.length-1];
      ui.maxWin.textContent = (betVal * maxMult).toFixed(2);
    }

    /* --- PLAY ROUND --- */
    ui.btn.addEventListener('click', playRound);

    async function playRound() {
      if(isPlaying) return;
      if(selected.size === 0) return showToast("Pick at least 1 number", "error");
      const betVal = parseFloat(ui.bet.value);
      if(balance < betVal) return showToast("Insufficient funds", "error");

      // Start
      balance -= betVal;
      updateBalance();
      isPlaying = true;
      ui.btn.disabled = true;
      ui.btn.textContent = "DRAWING...";
      
      // Clear previous styles
      for(let i=1; i<=NUMBERS_COUNT; i++) {
        const t = document.getElementById(`tile-${i}`);
        t.classList.remove('hit', 'miss', 'drawn-not-selected');
        // Keep 'selected' class visually but reset colors? 
        // Actually selected class sets purple. We want to overlay green/red.
      }
      document.querySelectorAll('.pay-box').forEach(b => b.classList.remove('active'));

      // Generate Draw (10 unique numbers)
      const drawn = new Set();
      while(drawn.size < DRAW_COUNT) drawn.add(Math.floor(Math.random() * NUMBERS_COUNT) + 1);
      const drawnArray = Array.from(drawn);

      // Animation Loop
      let hits = 0;
      for(let i=0; i<drawnArray.length; i++) {
        await new Promise(r => setTimeout(r, 200)); // Delay per ball
        const num = drawnArray[i];
        const tile = document.getElementById(`tile-${num}`);
        
        if(selected.has(num)) {
          tile.classList.add('hit'); // Green
          hits++;
          // Highlight payout box
          document.querySelectorAll('.pay-box').forEach(b => b.classList.remove('active'));
          const box = document.getElementById(`pay-${hits}`);
          if(box) box.classList.add('active');
        } else {
          tile.classList.add('drawn-not-selected'); // Grey highlight
        }
      }

      // Finish
      await new Promise(r => setTimeout(r, 300));
      
      // Calculate Win
      const risk = ui.risk.value;
      const count = selected.size;
      let table = (PAYOUTS[risk] && PAYOUTS[risk][count]) ? PAYOUTS[risk][count] : PAYOUTS['classic'][count];
      if(!table) table = PAYOUTS['classic'][count];
      
      const mult = table[hits];
      const win = betVal * mult;

      if(win > 0) {
        balance += win;
        showToast(`WON ${win.toFixed(0)} PBJ!`, "success");
        confetti({ origin: { y: 0.7 } });
      } else {
        // Mark missed user selections
        selected.forEach(n => {
          if(!drawn.has(n)) document.getElementById(`tile-${n}`).classList.add('miss');
        });
      }

      updateBalance();
      isPlaying = false;
      ui.btn.disabled = false;
      ui.btn.textContent = "PLAY KENO";
    }

    /* --- UTILS --- */
    function adjustBet(factor) {
      if(isPlaying) return;
      let v = parseFloat(ui.bet.value);
      v = v * factor;
      if(v < 1) v = 1;
      ui.bet.value = Math.floor(v);
      updateUI(); // Update potential win
    }

    function updateBalance() {
      document.getElementById('balance').textContent = Math.floor(balance).toLocaleString();
    }

    function showToast(msg, type="neutral") {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.style.borderColor = type === 'error' ? '#ef4444' : '#39ff14';
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 2000);
    }

    init();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
  <title>Pepe Video Poker - PBJ Casino</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Press+Start+2P&display=swap" rel="stylesheet" />

  <!-- Frameworks -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    :root {
      --neon-green: #39ff14;
      --neon-blue: #3b82f6;
      --panel-bg: rgba(5, 10, 15, 0.95);
      --glass-border: rgba(59, 130, 246, 0.3);
      --card-bg: #e5e7eb;
      --card-back: #1e3a8a;
    }

    body { font-family: 'Inter', sans-serif; background-color: #020202; color: #e0e0e0; overflow-x: hidden; }
    .pixel-font { font-family: 'Press Start 2P', cursive; }

    /* Background */
    body::before {
      content: ""; position: fixed; inset: 0; pointer-events: none; z-index: -2;
      background: radial-gradient(circle at 50% 0%, rgba(59, 130, 246, 0.15), transparent 60%),
                  radial-gradient(circle at 50% 100%, rgba(168, 85, 247, 0.1), transparent 60%);
    }
    body::after {
      content: ""; position: fixed; inset: 0; pointer-events: none; z-index: -2;
      background-image: linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    /* Glass Panels */
    .glass-panel {
      background: var(--panel-bg);
      backdrop-filter: blur(12px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
    }

    /* PAYTABLE */
    .paytable {
      display: grid; grid-template-columns: 1fr auto; gap: 8px;
      font-size: 10px; text-transform: uppercase; letter-spacing: 1px;
      background: rgba(0,0,0,0.4); padding: 10px; border-radius: 8px;
      border: 1px solid #333;
    }
    .pay-row {
      display: contents; color: #6b7280; transition: color 0.2s;
    }
    .pay-row.active {
      color: var(--neon-green); text-shadow: 0 0 5px var(--neon-green); font-weight: bold;
    }
    .pay-row span:last-child { text-align: right; font-family: monospace; }

    /* CARDS */
    .card-container {
      display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px;
      perspective: 1000px; height: 140px;
    }
    @media(min-width: 768px) { .card-container { height: 200px; gap: 16px; } }

    .poker-card {
      position: relative; width: 100%; height: 100%;
      transform-style: preserve-3d; transition: transform 0.6s; cursor: pointer;
      border-radius: 8px;
    }
    .poker-card.flipped { transform: rotateY(180deg); }
    
    .card-face {
      position: absolute; width: 100%; height: 100%;
      backface-visibility: hidden; border-radius: 8px;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    
    .card-back {
      background: linear-gradient(135deg, #172554, #1e40af);
      border: 2px solid #3b82f6;
      background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDIwIDIwIiBmaWxsPSJub25lIiBzdHJva2U9InJnYmEoMjU1LDI1NSwyNTUsMC4xKSI+PHBhdGggZD0iTTAgMGwyMCAyME0yMCAwbC0yMCAyMCIvPjwvc3ZnPg==');
    }
    
    .card-front {
      background: #e5e7eb; color: #111;
      transform: rotateY(180deg);
      font-family: 'Inter', sans-serif;
      position: relative;
    }
    
    .card-value { position: absolute; top: 4px; left: 6px; font-size: 14px; font-weight: bold; line-height: 1; }
    .card-suit-big { font-size: 36px; }
    .red { color: #ef4444; } .black { color: #171717; }

    /* HOLD Overlay */
    .hold-badge {
      position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
      background: var(--neon-green); color: black;
      font-size: 10px; font-weight: bold; padding: 2px 8px; border-radius: 4px;
      box-shadow: 0 0 10px var(--neon-green); z-index: 10;
      display: none; font-family: 'Press Start 2P', cursive;
    }
    .poker-card.held .hold-badge { display: block; }
    .poker-card.held .card-front { border: 3px solid var(--neon-green); box-shadow: inset 0 0 20px rgba(57, 255, 20, 0.3); }

    /* Controls */
    .action-btn {
      background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
      box-shadow: 0 4px 0 #1e3a8a; transition: all 0.1s;
    }
    .action-btn:active { transform: translateY(4px); box-shadow: 0 0 0 transparent; }
    .action-btn:disabled { filter: grayscale(1); opacity: 0.6; cursor: not-allowed; }
    .deal-btn { background: linear-gradient(135deg, #22c55e 0%, #166534 100%); box-shadow: 0 4px 0 #064e3b; }

    /* Toast */
    .toast {
      position: fixed; top: 100px; right: 20px; z-index: 99;
      background: rgba(0,0,0,0.9); border-left: 4px solid var(--neon-green);
      padding: 10px 20px; border-radius: 4px; opacity: 0; pointer-events: none;
      transition: opacity 0.3s; color: white; font-size: 12px;
    }
    .toast.show { opacity: 1; transform: translateY(10px); }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- Header -->
  <nav class="bg-black/90 border-b border-white/10 p-3 flex justify-between items-center sticky top-0 z-50 backdrop-blur">
    <div class="flex items-center gap-2">
      <a href="../index.html" class="text-gray-400 hover:text-white text-xs pixel-font">← BACK</a>
      <span class="text-blue-400 pixel-font ml-2 text-xs md:text-sm">VIDEO POKER</span>
    </div>
    <div class="bg-blue-900/20 border border-blue-800 px-3 py-1 rounded-full text-xs text-blue-400 flex items-center gap-2">
      <span>$PBJ</span>
      <span id="balance" class="font-mono font-bold">10,000</span>
    </div>
  </nav>

  <main class="flex-grow p-4 flex flex-col items-center justify-center gap-6 w-full max-w-4xl mx-auto">

    <div class="w-full grid md:grid-cols-12 gap-6 items-start">
      
      <!-- LEFT: Paytable (Mobile: Top / Desktop: Side) -->
      <div class="md:col-span-3 w-full order-1 md:order-1">
        <div class="paytable">
          <div class="pay-row" id="row-rf"><span>Royal Flush</span><span id="pay-rf">800x</span></div>
          <div class="pay-row" id="row-sf"><span>Str. Flush</span><span id="pay-sf">50x</span></div>
          <div class="pay-row" id="row-4k"><span>4 of a Kind</span><span id="pay-4k">25x</span></div>
          <div class="pay-row" id="row-fh"><span>Full House</span><span id="pay-fh">9x</span></div>
          <div class="pay-row" id="row-fl"><span>Flush</span><span id="pay-fl">6x</span></div>
          <div class="pay-row" id="row-st"><span>Straight</span><span id="pay-st">4x</span></div>
          <div class="pay-row" id="row-3k"><span>3 of a Kind</span><span id="pay-3k">3x</span></div>
          <div class="pay-row" id="row-2p"><span>Two Pair</span><span id="pay-2p">2x</span></div>
          <div class="pay-row" id="row-jb"><span>Jacks+</span><span id="pay-jb">1x</span></div>
        </div>
      </div>

      <!-- RIGHT: Game Area -->
      <div class="md:col-span-9 w-full order-2 md:order-2 flex flex-col gap-6">
        
        <!-- Status Message -->
        <div class="h-8 flex items-center justify-center">
          <span id="status-msg" class="text-xl pixel-font text-white text-center">PLACE YOUR BET</span>
        </div>

        <!-- Cards -->
        <div class="card-container" id="card-container">
           <!-- 5 Cards Generated by JS -->
           <div class="poker-card">
             <div class="card-face card-back"></div>
           </div>
           <div class="poker-card">
             <div class="card-face card-back"></div>
           </div>
           <div class="poker-card">
             <div class="card-face card-back"></div>
           </div>
           <div class="poker-card">
             <div class="card-face card-back"></div>
           </div>
           <div class="poker-card">
             <div class="card-face card-back"></div>
           </div>
        </div>

        <!-- Controls -->
        <div class="glass-panel p-4 mt-4">
          <div class="flex flex-col md:flex-row items-center justify-between gap-4">
            
            <!-- Bet Adjust -->
            <div class="flex items-center gap-2 w-full md:w-auto">
              <div class="bg-black/60 border border-gray-700 rounded-lg p-2 flex items-center flex-1">
                <span class="text-[10px] text-gray-500 uppercase font-bold mr-2">BET</span>
                <input type="number" id="betAmount" value="100" class="bg-transparent text-white w-20 outline-none font-mono font-bold text-sm">
              </div>
              <button onclick="adjustBet(0.5)" class="bg-gray-800 hover:bg-gray-700 text-gray-300 px-3 py-2 rounded text-xs">½</button>
              <button onclick="adjustBet(2)" class="bg-gray-800 hover:bg-gray-700 text-gray-300 px-3 py-2 rounded text-xs">2x</button>
            </div>

            <!-- Main Button -->
            <button id="main-btn" class="action-btn deal-btn w-full md:w-48 py-4 rounded-xl text-white font-bold text-sm pixel-font tracking-widest shadow-lg active:shadow-none active:translate-y-1">
              DEAL
            </button>

          </div>
        </div>

      </div>
    </div>

  </main>

  <div id="toast" class="toast">Message</div>

  <script>
    /* --- CONFIGURATION --- */
    const SUITS = ['♠', '♥', '♦', '♣'];
    const RANKS = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    const PAYOUTS = {
      'RF': 800, 'SF': 50, '4K': 25, 'FH': 9, 'FL': 6, 'ST': 4, '3K': 3, '2P': 2, 'JB': 1
    };

    let balance = 10000;
    let bet = 100;
    let deck = [];
    let hand = []; // Array of 5 card objects
    let gameState = 'IDLE'; // IDLE, DEAL_DONE, ROUND_OVER

    /* --- UI ELEMENTS --- */
    const ui = {
      balance: document.getElementById('balance'),
      bet: document.getElementById('betAmount'),
      btn: document.getElementById('main-btn'),
      msg: document.getElementById('status-msg'),
      cards: document.getElementById('card-container')
    };

    /* --- DECK LOGIC --- */
    function createDeck() {
      let d = [];
      for(let s of SUITS) {
        for(let r of RANKS) {
          d.push({ suit: s, rank: r, held: false, el: null });
        }
      }
      // Shuffle
      for(let i = d.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [d[i], d[j]] = [d[j], d[i]];
      }
      return d;
    }

    function getCardValue(rank) {
      if (rank === 'A') return 14;
      if (rank === 'K') return 13;
      if (rank === 'Q') return 12;
      if (rank === 'J') return 11;
      return parseInt(rank);
    }

    /* --- RENDERING --- */
    function initUI() {
      ui.cards.innerHTML = '';
      for(let i=0; i<5; i++) {
        // Create Card DOM Structure
        const cardWrap = document.createElement('div');
        cardWrap.className = 'poker-card';
        cardWrap.id = `card-${i}`;
        cardWrap.onclick = () => toggleHold(i);
        
        cardWrap.innerHTML = `
          <div class="hold-badge">HOLD</div>
          <div class="card-face card-back"></div>
          <div class="card-face card-front">
            <span class="card-value"></span>
            <span class="card-suit-big"></span>
          </div>
        `;
        ui.cards.appendChild(cardWrap);
      }
      updateBalance();
    }

    function revealHand(newHand, animateIndices = [0,1,2,3,4]) {
      newHand.forEach((card, i) => {
        if (!animateIndices.includes(i)) return; // Skip held cards visual update (already shown)

        const el = document.getElementById(`card-${i}`);
        el.classList.remove('flipped', 'held'); // Reset
        
        // Update content after small delay for flip effect
        setTimeout(() => {
          const isRed = (card.suit === '♥' || card.suit === '♦');
          const valEl = el.querySelector('.card-value');
          const suitEl = el.querySelector('.card-suit-big');
          
          valEl.textContent = card.rank;
          valEl.className = `card-value ${isRed ? 'red' : 'black'}`;
          
          suitEl.textContent = card.suit;
          suitEl.className = `card-suit-big ${isRed ? 'red' : 'black'}`;
          
          // Reveal
          el.classList.add('flipped');
        }, 200 + (i * 100));
      });
    }

    /* --- GAME FLOW --- */
    ui.btn.addEventListener('click', () => {
      if (gameState === 'IDLE' || gameState === 'ROUND_OVER') {
        deal();
      } else if (gameState === 'DEAL_DONE') {
        draw();
      }
    });

    function deal() {
      bet = parseFloat(ui.bet.value);
      if (balance < bet) return showToast("Insufficient Funds", "error");
      
      balance -= bet;
      updateBalance();
      
      deck = createDeck();
      hand = deck.splice(0, 5);
      
      // Reset UI
      document.querySelectorAll('.poker-card').forEach(c => c.classList.remove('flipped', 'held'));
      document.querySelectorAll('.pay-row').forEach(r => r.classList.remove('active'));
      
      ui.msg.textContent = "GOOD LUCK!";
      ui.btn.disabled = true; // Prevent spam

      // Animation
      setTimeout(() => {
        revealHand(hand);
        gameState = 'DEAL_DONE';
        ui.btn.textContent = "DRAW";
        ui.btn.classList.replace('deal-btn', 'action-btn');
        ui.btn.disabled = false;
        ui.msg.textContent = "SELECT CARDS TO HOLD";
        
        // Auto-Highlight winning combination preview?
        checkHand(hand, true); // Just to highlight paytable hint
      }, 300);
    }

    function toggleHold(index) {
      if (gameState !== 'DEAL_DONE') return;
      
      const cardData = hand[index];
      cardData.held = !cardData.held;
      
      const el = document.getElementById(`card-${index}`);
      el.classList.toggle('held', cardData.held);
    }

    function draw() {
      ui.btn.disabled = true;
      
      const indicesToReplace = [];
      
      // Replace unheld cards
      for (let i = 0; i < 5; i++) {
        if (!hand[i].held) {
          hand[i] = deck.pop(); // New card
          // Visually flip back first?
          const el = document.getElementById(`card-${i}`);
          el.classList.remove('flipped');
          indicesToReplace.push(i);
        }
      }

      setTimeout(() => {
        revealHand(hand, indicesToReplace);
        
        // Evaluate
        setTimeout(() => {
          const result = checkHand(hand);
          if (result.win > 0) {
            const payout = bet * result.win;
            balance += payout;
            ui.msg.innerHTML = `<span class="text-green-400 font-bold">${result.name}! WIN ${payout} PBJ</span>`;
            confetti({ origin: { y: 0.7 } });
            showToast(`WON ${payout} PBJ`, "success");
            
            // Highlight winning cards?
            // Can add class 'winner'
          } else {
            ui.msg.textContent = "GAME OVER";
          }
          
          gameState = 'ROUND_OVER';
          ui.btn.textContent = "DEAL";
          ui.btn.classList.replace('action-btn', 'deal-btn');
          ui.btn.disabled = false;
          updateBalance();
        }, 1000);
      }, 300);
    }

    /* --- HAND EVALUATOR --- */
    function checkHand(currentHand, preview = false) {
      // Reset table
      if(!preview) document.querySelectorAll('.pay-row').forEach(r => r.classList.remove('active'));

      const suits = currentHand.map(c => c.suit);
      const ranks = currentHand.map(c => getCardValue(c.rank)).sort((a, b) => a - b);
      
      const isFlush = suits.every(s => s === suits[0]);
      
      let isStraight = true;
      for (let i = 0; i < 4; i++) {
        if (ranks[i+1] !== ranks[i] + 1) {
          isStraight = false; 
          break;
        }
      }
      // Ace Low Straight check (A, 2, 3, 4, 5) -> Ranks will be 2,3,4,5,14
      if (!isStraight && ranks[0]===2 && ranks[1]===3 && ranks[2]===4 && ranks[3]===5 && ranks[4]===14) {
        isStraight = true;
      }

      const counts = {};
      ranks.forEach(r => counts[r] = (counts[r] || 0) + 1);
      const countsValues = Object.values(counts);

      let winMult = 0;
      let handName = "";
      let rowId = "";

      if (isFlush && isStraight && ranks[0] === 10) { 
        winMult = PAYOUTS.RF; handName = "ROYAL FLUSH"; rowId="row-rf";
      } else if (isFlush && isStraight) {
        winMult = PAYOUTS.SF; handName = "STRAIGHT FLUSH"; rowId="row-sf";
      } else if (countsValues.includes(4)) {
        winMult = PAYOUTS['4K']; handName = "FOUR OF A KIND"; rowId="row-4k";
      } else if (countsValues.includes(3) && countsValues.includes(2)) {
        winMult = PAYOUTS.FH; handName = "FULL HOUSE"; rowId="row-fh";
      } else if (isFlush) {
        winMult = PAYOUTS.FL; handName = "FLUSH"; rowId="row-fl";
      } else if (isStraight) {
        winMult = PAYOUTS.ST; handName = "STRAIGHT"; rowId="row-st";
      } else if (countsValues.includes(3)) {
        winMult = PAYOUTS['3K']; handName = "THREE OF A KIND"; rowId="row-3k";
      } else if (countsValues.filter(c => c === 2).length === 2) {
        winMult = PAYOUTS['2P']; handName = "TWO PAIR"; rowId="row-2p";
      } else if (countsValues.includes(2)) {
        // Jacks or Better check
        const pairs = Object.keys(counts).filter(k => counts[k] === 2);
        // Check if any pair is >= 11 (Jack=11, Q=12, K=13, A=14)
        if (pairs.some(r => parseInt(r) >= 11)) {
          winMult = PAYOUTS.JB; handName = "JACKS OR BETTER"; rowId="row-jb";
        }
      }

      if (rowId) document.getElementById(rowId).classList.add('active');

      return { win: winMult, name: handName };
    }

    /* --- UTILS --- */
    function updateBalance() {
      ui.balance.textContent = Math.floor(balance).toLocaleString();
    }

    function adjustBet(factor) {
      if(gameState === 'DEAL_DONE') return;
      let v = parseFloat(ui.bet.value);
      v = v * factor;
      if(v < 1) v = 1;
      ui.bet.value = Math.floor(v);
    }

    function showToast(msg, type="neutral") {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.style.borderColor = type === 'error' ? '#ef4444' : '#39ff14';
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 2000);
    }

    // Initialize
    initUI();

  </script>
</body>
</html>
